{"remainingRequest":"D:\\vscodeprojects\\vuepress-theme-reco\\myblogs\\node_modules\\babel-loader\\lib\\index.js??ref--3-1!D:\\vscodeprojects\\vuepress-theme-reco\\myblogs\\node_modules\\@vue\\composition-api\\dist\\vue-composition-api.esm.js","dependencies":[{"path":"D:\\vscodeprojects\\vuepress-theme-reco\\myblogs\\node_modules\\@vue\\composition-api\\dist\\vue-composition-api.esm.js","mtime":1619669377000},{"path":"D:\\vscodeprojects\\vuepress-theme-reco\\myblogs\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\vscodeprojects\\vuepress-theme-reco\\myblogs\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF90eXBlb2YgZnJvbSAiRDovdnNjb2RlcHJvamVjdHMvdnVlcHJlc3MtdGhlbWUtcmVjby9teWJsb2dzL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS90eXBlb2YiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZGF0ZS50by1zdHJpbmcuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sLmRlc2NyaXB0aW9uLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVmbGVjdC5vd24ta2V5cy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5kZWZpbmUtcHJvcGVydHkuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5pcy1hcnJheS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnBhcnNlLWZsb2F0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLndlYWstbWFwLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5pdGVyYXRvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLmJpbmQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5mb3ItZWFjaC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN5bWJvbC5pdGVyYXRvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5zZWFsLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmtleXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmlzLWV4dGVuc2libGUuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zcGxpY2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zbGljZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5Lm1hcC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5mcmVlemUuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMubWFwLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc29tZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN5bWJvbC50by1zdHJpbmctdGFnLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuanNvbi50by1zdHJpbmctdGFnLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMubWF0aC50by1zdHJpbmctdGFnLmpzIjsKaW1wb3J0IFZ1ZSBmcm9tICd2dWUnOwoKdmFyIHRvU3RyaW5nID0gZnVuY3Rpb24gdG9TdHJpbmcoeCkgewogIHJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoeCk7Cn07CgpmdW5jdGlvbiBpc05hdGl2ZShDdG9yKSB7CiAgcmV0dXJuIHR5cGVvZiBDdG9yID09PSAnZnVuY3Rpb24nICYmIC9uYXRpdmUgY29kZS8udGVzdChDdG9yLnRvU3RyaW5nKCkpOwp9Cgp2YXIgaGFzU3ltYm9sID0gdHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgaXNOYXRpdmUoU3ltYm9sKSAmJiB0eXBlb2YgUmVmbGVjdCAhPT0gJ3VuZGVmaW5lZCcgJiYgaXNOYXRpdmUoUmVmbGVjdC5vd25LZXlzKTsKCnZhciBub29wRm4gPSBmdW5jdGlvbiBub29wRm4oXykgewogIHJldHVybiBfOwp9OwoKZnVuY3Rpb24gcHJveHkodGFyZ2V0LCBrZXksIF9hKSB7CiAgdmFyIGdldCA9IF9hLmdldCwKICAgICAgc2V0ID0gX2Euc2V0OwogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgewogICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgIGdldDogZ2V0IHx8IG5vb3BGbiwKICAgIHNldDogc2V0IHx8IG5vb3BGbgogIH0pOwp9CgpmdW5jdGlvbiBkZWYob2JqLCBrZXksIHZhbCwgZW51bWVyYWJsZSkgewogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgewogICAgdmFsdWU6IHZhbCwKICAgIGVudW1lcmFibGU6ICEhZW51bWVyYWJsZSwKICAgIHdyaXRhYmxlOiB0cnVlLAogICAgY29uZmlndXJhYmxlOiB0cnVlCiAgfSk7Cn0KCmZ1bmN0aW9uIGhhc093bihvYmosIGtleSkgewogIHJldHVybiBPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSk7Cn0KCmZ1bmN0aW9uIGFzc2VydChjb25kaXRpb24sIG1zZykgewogIGlmICghY29uZGl0aW9uKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoIlt2dWUtY29tcG9zaXRpb24tYXBpXSAiICsgbXNnKTsKICB9Cn0KCmZ1bmN0aW9uIGlzUHJpbWl0aXZlKHZhbHVlKSB7CiAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgfHwgdHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJyB8fCAvLyAkZmxvdy1kaXNhYmxlLWxpbmUKICBfdHlwZW9mKHZhbHVlKSA9PT0gJ3N5bWJvbCcgfHwgdHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbic7Cn0KCmZ1bmN0aW9uIGlzQXJyYXkoeCkgewogIHJldHVybiBBcnJheS5pc0FycmF5KHgpOwp9CgpmdW5jdGlvbiBpc1ZhbGlkQXJyYXlJbmRleCh2YWwpIHsKICB2YXIgbiA9IHBhcnNlRmxvYXQoU3RyaW5nKHZhbCkpOwogIHJldHVybiBuID49IDAgJiYgTWF0aC5mbG9vcihuKSA9PT0gbiAmJiBpc0Zpbml0ZSh2YWwpOwp9CgpmdW5jdGlvbiBpc09iamVjdCh2YWwpIHsKICByZXR1cm4gdmFsICE9PSBudWxsICYmIF90eXBlb2YodmFsKSA9PT0gJ29iamVjdCc7Cn0KCmZ1bmN0aW9uIGlzUGxhaW5PYmplY3QoeCkgewogIHJldHVybiB0b1N0cmluZyh4KSA9PT0gJ1tvYmplY3QgT2JqZWN0XSc7Cn0KCmZ1bmN0aW9uIGlzRnVuY3Rpb24oeCkgewogIHJldHVybiB0eXBlb2YgeCA9PT0gJ2Z1bmN0aW9uJzsKfQoKZnVuY3Rpb24gaXNVbmRlZih2KSB7CiAgcmV0dXJuIHYgPT09IHVuZGVmaW5lZCB8fCB2ID09PSBudWxsOwp9CgpmdW5jdGlvbiB3YXJuJDEobXNnLCB2bSkgewogIFZ1ZS51dGlsLndhcm4obXNnLCB2bSk7Cn0KCmZ1bmN0aW9uIGxvZ0Vycm9yKGVyciwgdm0sIGluZm8pIHsKICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgewogICAgd2FybiQxKCJFcnJvciBpbiAiICsgaW5mbyArICI6IFwiIiArIGVyci50b1N0cmluZygpICsgIlwiIiwgdm0pOwogIH0KCiAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiBjb25zb2xlICE9PSAndW5kZWZpbmVkJykgewogICAgY29uc29sZS5lcnJvcihlcnIpOwogIH0gZWxzZSB7CiAgICB0aHJvdyBlcnI7CiAgfQp9Cgp2YXIgdnVlRGVwZW5kZW5jeSA9IHVuZGVmaW5lZDsKCnRyeSB7CiAgdmFyIHJlcXVpcmVkVnVlID0gcmVxdWlyZSgndnVlJyk7CgogIGlmIChyZXF1aXJlZFZ1ZSAmJiBpc1Z1ZShyZXF1aXJlZFZ1ZSkpIHsKICAgIHZ1ZURlcGVuZGVuY3kgPSByZXF1aXJlZFZ1ZTsKICB9IGVsc2UgaWYgKHJlcXVpcmVkVnVlICYmICdkZWZhdWx0JyBpbiByZXF1aXJlZFZ1ZSAmJiBpc1Z1ZShyZXF1aXJlZFZ1ZVsiZGVmYXVsdCJdKSkgewogICAgdnVlRGVwZW5kZW5jeSA9IHJlcXVpcmVkVnVlWyJkZWZhdWx0Il07CiAgfQp9IGNhdGNoIChfYSkgey8vIG5vdCBhdmFpbGFibGUKfQoKdmFyIHZ1ZUNvbnN0cnVjdG9yID0gbnVsbDsKdmFyIGN1cnJlbnRJbnN0YW5jZSA9IG51bGw7CnZhciBQbHVnaW5JbnN0YWxsZWRGbGFnID0gJ19fY29tcG9zaXRpb25fYXBpX2luc3RhbGxlZF9fJzsKCmZ1bmN0aW9uIGlzVnVlKG9iaikgewogIHJldHVybiBvYmogJiYgdHlwZW9mIG9iaiA9PT0gJ2Z1bmN0aW9uJyAmJiBvYmoubmFtZSA9PT0gJ1Z1ZSc7Cn0KCmZ1bmN0aW9uIGlzVnVlUmVnaXN0ZXJlZChWdWUpIHsKICByZXR1cm4gaGFzT3duKFZ1ZSwgUGx1Z2luSW5zdGFsbGVkRmxhZyk7Cn0KCmZ1bmN0aW9uIGdldFZ1ZUNvbnN0cnVjdG9yKCkgewogIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICBhc3NlcnQodnVlQ29uc3RydWN0b3IsICJtdXN0IGNhbGwgVnVlLnVzZShWdWVDb21wb3NpdGlvbkFQSSkgYmVmb3JlIHVzaW5nIGFueSBmdW5jdGlvbi4iKTsKICB9CgogIHJldHVybiB2dWVDb25zdHJ1Y3RvcjsKfSAvLyByZXR1cm5zIHJlZ2lzdGVyZWQgdnVlIG9yIGB2dWVgIGRlcGVuZGVuY3kKCgpmdW5jdGlvbiBnZXRSZWdpc3RlcmVkVnVlT3JEZWZhdWx0KCkgewogIHZhciBjb25zdHJ1Y3RvciA9IHZ1ZUNvbnN0cnVjdG9yIHx8IHZ1ZURlcGVuZGVuY3k7CgogIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICBhc3NlcnQoY29uc3RydWN0b3IsICJObyB2dWUgZGVwZW5kZW5jeSBmb3VuZC4iKTsKICB9CgogIHJldHVybiBjb25zdHJ1Y3RvcjsKfQoKZnVuY3Rpb24gc2V0VnVlQ29uc3RydWN0b3IoVnVlKSB7CiAgLy8gQHRzLWlnbm9yZQogIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nICYmIHZ1ZUNvbnN0cnVjdG9yICYmIFZ1ZS5fX3Byb3RvX18gIT09IHZ1ZUNvbnN0cnVjdG9yLl9fcHJvdG9fXykgewogICAgd2FybiQxKCdbdnVlLWNvbXBvc2l0aW9uLWFwaV0gYW5vdGhlciBpbnN0YW5jZSBvZiBWdWUgaW5zdGFsbGVkJyk7CiAgfQoKICB2dWVDb25zdHJ1Y3RvciA9IFZ1ZTsKICBPYmplY3QuZGVmaW5lUHJvcGVydHkoVnVlLCBQbHVnaW5JbnN0YWxsZWRGbGFnLCB7CiAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICB3cml0YWJsZTogdHJ1ZSwKICAgIHZhbHVlOiB0cnVlCiAgfSk7Cn0KCmZ1bmN0aW9uIHNldEN1cnJlbnRJbnN0YW5jZSh2bSkgewogIC8vIGN1cnJlbnRJbnN0YW5jZT8uJHNjb3BlZFNsb3RzCiAgY3VycmVudEluc3RhbmNlID0gdm07Cn0KCmZ1bmN0aW9uIGdldEN1cnJlbnRWdWUySW5zdGFuY2UoKSB7CiAgcmV0dXJuIGN1cnJlbnRJbnN0YW5jZTsKfQoKZnVuY3Rpb24gZ2V0Q3VycmVudEluc3RhbmNlKCkgewogIGlmIChjdXJyZW50SW5zdGFuY2UpIHsKICAgIHJldHVybiB0b1Z1ZTNDb21wb25lbnRJbnN0YW5jZShjdXJyZW50SW5zdGFuY2UpOwogIH0KCiAgcmV0dXJuIG51bGw7Cn0KCnZhciBpbnN0YW5jZU1hcENhY2hlID0gbmV3IFdlYWtNYXAoKTsKCmZ1bmN0aW9uIHRvVnVlM0NvbXBvbmVudEluc3RhbmNlKHZ1ZTJJbnN0YW5jZSkgewogIGlmIChpbnN0YW5jZU1hcENhY2hlLmhhcyh2dWUySW5zdGFuY2UpKSB7CiAgICByZXR1cm4gaW5zdGFuY2VNYXBDYWNoZS5nZXQodnVlMkluc3RhbmNlKTsKICB9CgogIHZhciBpbnN0YW5jZSA9IHsKICAgIHByb3h5OiB2dWUySW5zdGFuY2UsCiAgICB1cGRhdGU6IHZ1ZTJJbnN0YW5jZS4kZm9yY2VVcGRhdGUsCiAgICB1aWQ6IHZ1ZTJJbnN0YW5jZS5fdWlkLAogICAgLy8gJGVtaXQgaXMgZGVmaW5lZCBvbiBwcm90b3R5cGUgYW5kIGl0IGV4cGVjdGVkIHRvIGJlIGJvdW5kCiAgICBlbWl0OiB2dWUySW5zdGFuY2UuJGVtaXQuYmluZCh2dWUySW5zdGFuY2UpLAogICAgcGFyZW50OiBudWxsLAogICAgcm9vdDogbnVsbAogIH07IC8vIG1hcCB2bS4kcHJvcHMgPQoKICB2YXIgaW5zdGFuY2VQcm9wcyA9IFsnZGF0YScsICdwcm9wcycsICdhdHRycycsICdyZWZzJywgJ3Zub2RlJywgJ3Nsb3RzJ107CiAgaW5zdGFuY2VQcm9wcy5mb3JFYWNoKGZ1bmN0aW9uIChwcm9wKSB7CiAgICBwcm94eShpbnN0YW5jZSwgcHJvcCwgewogICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICByZXR1cm4gdnVlMkluc3RhbmNlWyIkIiArIHByb3BdOwogICAgICB9CiAgICB9KTsKICB9KTsKICBwcm94eShpbnN0YW5jZSwgJ2lzTW91bnRlZCcsIHsKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIHByaXZhdGUgYXBpCiAgICAgIHJldHVybiB2dWUySW5zdGFuY2UuX2lzTW91bnRlZDsKICAgIH0KICB9KTsKICBwcm94eShpbnN0YW5jZSwgJ2lzVW5tb3VudGVkJywgewogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgcHJpdmF0ZSBhcGkKICAgICAgcmV0dXJuIHZ1ZTJJbnN0YW5jZS5faXNEZXN0cm95ZWQ7CiAgICB9CiAgfSk7CiAgcHJveHkoaW5zdGFuY2UsICdpc0RlYWN0aXZhdGVkJywgewogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgcHJpdmF0ZSBhcGkKICAgICAgcmV0dXJuIHZ1ZTJJbnN0YW5jZS5faW5hY3RpdmU7CiAgICB9CiAgfSk7CiAgcHJveHkoaW5zdGFuY2UsICdlbWl0dGVkJywgewogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgcHJpdmF0ZSBhcGkKICAgICAgcmV0dXJuIHZ1ZTJJbnN0YW5jZS5fZXZlbnRzOwogICAgfQogIH0pOwogIGluc3RhbmNlTWFwQ2FjaGUuc2V0KHZ1ZTJJbnN0YW5jZSwgaW5zdGFuY2UpOwoKICBpZiAodnVlMkluc3RhbmNlLiRwYXJlbnQpIHsKICAgIGluc3RhbmNlLnBhcmVudCA9IHRvVnVlM0NvbXBvbmVudEluc3RhbmNlKHZ1ZTJJbnN0YW5jZS4kcGFyZW50KTsKICB9CgogIGlmICh2dWUySW5zdGFuY2UuJHJvb3QpIHsKICAgIGluc3RhbmNlLnJvb3QgPSB0b1Z1ZTNDb21wb25lbnRJbnN0YW5jZSh2dWUySW5zdGFuY2UuJHJvb3QpOwogIH0KCiAgcmV0dXJuIGluc3RhbmNlOwp9CgpmdW5jdGlvbiBjdXJyZW50Vk1JbkZuKGhvb2spIHsKICB2YXIgdm0gPSBnZXRDdXJyZW50SW5zdGFuY2UoKTsKCiAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicgJiYgIXZtKSB7CiAgICB3YXJuJDEoaG9vayArICIgaXMgY2FsbGVkIHdoZW4gdGhlcmUgaXMgbm8gYWN0aXZlIGNvbXBvbmVudCBpbnN0YW5jZSB0byBiZSAiICsgImFzc29jaWF0ZWQgd2l0aC4gIiArICJMaWZlY3ljbGUgaW5qZWN0aW9uIEFQSXMgY2FuIG9ubHkgYmUgdXNlZCBkdXJpbmcgZXhlY3V0aW9uIG9mIHNldHVwKCkuIik7CiAgfQoKICByZXR1cm4gdm0gPT09IG51bGwgfHwgdm0gPT09IHZvaWQgMCA/IHZvaWQgMCA6IHZtLnByb3h5Owp9CgpmdW5jdGlvbiBkZWZpbmVDb21wb25lbnRJbnN0YW5jZShDdG9yLCBvcHRpb25zKSB7CiAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgb3B0aW9ucyA9IHt9OwogIH0KCiAgdmFyIHNpbGVudCA9IEN0b3IuY29uZmlnLnNpbGVudDsKICBDdG9yLmNvbmZpZy5zaWxlbnQgPSB0cnVlOwogIHZhciB2bSA9IG5ldyBDdG9yKG9wdGlvbnMpOwogIEN0b3IuY29uZmlnLnNpbGVudCA9IHNpbGVudDsKICByZXR1cm4gdm07Cn0KCmZ1bmN0aW9uIGlzQ29tcG9uZW50SW5zdGFuY2Uob2JqKSB7CiAgdmFyIFZ1ZSA9IGdldFZ1ZUNvbnN0cnVjdG9yKCk7CiAgcmV0dXJuIFZ1ZSAmJiBvYmogaW5zdGFuY2VvZiBWdWU7Cn0KCmZ1bmN0aW9uIGNyZWF0ZVNsb3RQcm94eSh2bSwgc2xvdE5hbWUpIHsKICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgdmFyIGFyZ3MgPSBbXTsKCiAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykgewogICAgICBhcmdzW19pXSA9IGFyZ3VtZW50c1tfaV07CiAgICB9CgogICAgaWYgKCF2bS4kc2NvcGVkU2xvdHNbc2xvdE5hbWVdKSB7CiAgICAgIHJldHVybiB3YXJuJDEoInNsb3RzLiIgKyBzbG90TmFtZSArICIoKSBnb3QgY2FsbGVkIG91dHNpZGUgb2YgdGhlIFwicmVuZGVyKClcIiBzY29wZSIsIHZtKTsKICAgIH0KCiAgICByZXR1cm4gdm0uJHNjb3BlZFNsb3RzW3Nsb3ROYW1lXS5hcHBseSh2bSwgYXJncyk7CiAgfTsKfQoKZnVuY3Rpb24gcmVzb2x2ZVNsb3RzKHNsb3RzLCBub3JtYWxTbG90cykgewogIHZhciByZXM7CgogIGlmICghc2xvdHMpIHsKICAgIHJlcyA9IHt9OwogIH0gZWxzZSBpZiAoc2xvdHMuX25vcm1hbGl6ZWQpIHsKICAgIC8vIGZhc3QgcGF0aCAxOiBjaGlsZCBjb21wb25lbnQgcmUtcmVuZGVyIG9ubHksIHBhcmVudCBkaWQgbm90IGNoYW5nZQogICAgcmV0dXJuIHNsb3RzLl9ub3JtYWxpemVkOwogIH0gZWxzZSB7CiAgICByZXMgPSB7fTsKCiAgICBmb3IgKHZhciBrZXkgaW4gc2xvdHMpIHsKICAgICAgaWYgKHNsb3RzW2tleV0gJiYga2V5WzBdICE9PSAnJCcpIHsKICAgICAgICByZXNba2V5XSA9IHRydWU7CiAgICAgIH0KICAgIH0KICB9IC8vIGV4cG9zZSBub3JtYWwgc2xvdHMgb24gc2NvcGVkU2xvdHMKCgogIGZvciAodmFyIGtleSBpbiBub3JtYWxTbG90cykgewogICAgaWYgKCEoa2V5IGluIHJlcykpIHsKICAgICAgcmVzW2tleV0gPSB0cnVlOwogICAgfQogIH0KCiAgcmV0dXJuIHJlczsKfQoKdmFyIHZ1ZUludGVybmFsQ2xhc3NlczsKCnZhciBnZXRWdWVJbnRlcm5hbENsYXNzZXMgPSBmdW5jdGlvbiBnZXRWdWVJbnRlcm5hbENsYXNzZXMoKSB7CiAgaWYgKCF2dWVJbnRlcm5hbENsYXNzZXMpIHsKICAgIHZhciB2bSA9IGRlZmluZUNvbXBvbmVudEluc3RhbmNlKGdldFZ1ZUNvbnN0cnVjdG9yKCksIHsKICAgICAgY29tcHV0ZWQ6IHsKICAgICAgICB2YWx1ZTogZnVuY3Rpb24gdmFsdWUoKSB7CiAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOyAvLyB0byBnZXQgV2F0Y2hlciBjbGFzcwoKICAgIHZhciBXYXRjaGVyID0gdm0uX2NvbXB1dGVkV2F0Y2hlcnMudmFsdWUuY29uc3RydWN0b3I7IC8vIHRvIGdldCBEZXAgY2xhc3MKCiAgICB2YXIgRGVwID0gdm0uX2RhdGEuX19vYl9fLmRlcC5jb25zdHJ1Y3RvcjsKICAgIHZ1ZUludGVybmFsQ2xhc3NlcyA9IHsKICAgICAgV2F0Y2hlcjogV2F0Y2hlciwKICAgICAgRGVwOiBEZXAKICAgIH07CiAgICB2bS4kZGVzdHJveSgpOwogIH0KCiAgcmV0dXJuIHZ1ZUludGVybmFsQ2xhc3NlczsKfTsKLyohICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQpDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4NCg0KUGVybWlzc2lvbiB0byB1c2UsIGNvcHksIG1vZGlmeSwgYW5kL29yIGRpc3RyaWJ1dGUgdGhpcyBzb2Z0d2FyZSBmb3IgYW55DQpwdXJwb3NlIHdpdGggb3Igd2l0aG91dCBmZWUgaXMgaGVyZWJ5IGdyYW50ZWQuDQoNClRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiIEFORCBUSEUgQVVUSE9SIERJU0NMQUlNUyBBTEwgV0FSUkFOVElFUyBXSVRIDQpSRUdBUkQgVE8gVEhJUyBTT0ZUV0FSRSBJTkNMVURJTkcgQUxMIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkNCkFORCBGSVRORVNTLiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SIEJFIExJQUJMRSBGT1IgQU5ZIFNQRUNJQUwsIERJUkVDVCwNCklORElSRUNULCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMgT1IgQU5ZIERBTUFHRVMgV0hBVFNPRVZFUiBSRVNVTFRJTkcgRlJPTQ0KTE9TUyBPRiBVU0UsIERBVEEgT1IgUFJPRklUUywgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIE5FR0xJR0VOQ0UgT1INCk9USEVSIFRPUlRJT1VTIEFDVElPTiwgQVJJU0lORyBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBVU0UgT1INClBFUkZPUk1BTkNFIE9GIFRISVMgU09GVFdBUkUuDQoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqLwoKCnZhciBfYXNzaWduID0gZnVuY3Rpb24gX19hc3NpZ24oKSB7CiAgX2Fzc2lnbiA9IE9iamVjdC5hc3NpZ24gfHwgZnVuY3Rpb24gX19hc3NpZ24odCkgewogICAgZm9yICh2YXIgcywgaSA9IDEsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbjsgaSsrKSB7CiAgICAgIHMgPSBhcmd1bWVudHNbaV07CgogICAgICBmb3IgKHZhciBwIGluIHMpIHsKICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHMsIHApKSB0W3BdID0gc1twXTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiB0OwogIH07CgogIHJldHVybiBfYXNzaWduLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7Cn07CgpmdW5jdGlvbiBfX3ZhbHVlcyhvKSB7CiAgdmFyIHMgPSB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIFN5bWJvbC5pdGVyYXRvciwKICAgICAgbSA9IHMgJiYgb1tzXSwKICAgICAgaSA9IDA7CiAgaWYgKG0pIHJldHVybiBtLmNhbGwobyk7CiAgaWYgKG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikgcmV0dXJuIHsKICAgIG5leHQ6IGZ1bmN0aW9uIG5leHQoKSB7CiAgICAgIGlmIChvICYmIGkgPj0gby5sZW5ndGgpIG8gPSB2b2lkIDA7CiAgICAgIHJldHVybiB7CiAgICAgICAgdmFsdWU6IG8gJiYgb1tpKytdLAogICAgICAgIGRvbmU6ICFvCiAgICAgIH07CiAgICB9CiAgfTsKICB0aHJvdyBuZXcgVHlwZUVycm9yKHMgPyAiT2JqZWN0IGlzIG5vdCBpdGVyYWJsZS4iIDogIlN5bWJvbC5pdGVyYXRvciBpcyBub3QgZGVmaW5lZC4iKTsKfQoKZnVuY3Rpb24gX19yZWFkKG8sIG4pIHsKICB2YXIgbSA9IHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb1tTeW1ib2wuaXRlcmF0b3JdOwogIGlmICghbSkgcmV0dXJuIG87CiAgdmFyIGkgPSBtLmNhbGwobyksCiAgICAgIHIsCiAgICAgIGFyID0gW10sCiAgICAgIGU7CgogIHRyeSB7CiAgICB3aGlsZSAoKG4gPT09IHZvaWQgMCB8fCBuLS0gPiAwKSAmJiAhKHIgPSBpLm5leHQoKSkuZG9uZSkgewogICAgICBhci5wdXNoKHIudmFsdWUpOwogICAgfQogIH0gY2F0Y2ggKGVycm9yKSB7CiAgICBlID0gewogICAgICBlcnJvcjogZXJyb3IKICAgIH07CiAgfSBmaW5hbGx5IHsKICAgIHRyeSB7CiAgICAgIGlmIChyICYmICFyLmRvbmUgJiYgKG0gPSBpWyJyZXR1cm4iXSkpIG0uY2FsbChpKTsKICAgIH0gZmluYWxseSB7CiAgICAgIGlmIChlKSB0aHJvdyBlLmVycm9yOwogICAgfQogIH0KCiAgcmV0dXJuIGFyOwp9CgpmdW5jdGlvbiBfX3NwcmVhZEFycmF5KHRvLCBmcm9tKSB7CiAgZm9yICh2YXIgaSA9IDAsIGlsID0gZnJvbS5sZW5ndGgsIGogPSB0by5sZW5ndGg7IGkgPCBpbDsgaSsrLCBqKyspIHsKICAgIHRvW2pdID0gZnJvbVtpXTsKICB9CgogIHJldHVybiB0bzsKfQoKZnVuY3Rpb24gY3JlYXRlU3ltYm9sKG5hbWUpIHsKICByZXR1cm4gaGFzU3ltYm9sID8gU3ltYm9sWyJmb3IiXShuYW1lKSA6IG5hbWU7Cn0KCnZhciBXYXRjaGVyUHJlRmx1c2hRdWV1ZUtleSA9IGNyZWF0ZVN5bWJvbCgnY29tcG9zaXRpb24tYXBpLnByZUZsdXNoUXVldWUnKTsKdmFyIFdhdGNoZXJQb3N0Rmx1c2hRdWV1ZUtleSA9IGNyZWF0ZVN5bWJvbCgnY29tcG9zaXRpb24tYXBpLnBvc3RGbHVzaFF1ZXVlJyk7IC8vIG11c3QgYmUgYSBzdHJpbmcsIHN5bWJvbCBrZXkgaXMgaWdub3JlZCBpbiByZWFjdGl2ZQoKdmFyIFJlZktleSA9ICdjb21wb3NpdGlvbi1hcGkucmVmS2V5JzsKdmFyIGFjY2Vzc01vZGlmaWVkU2V0ID0gbmV3IFdlYWtNYXAoKTsKdmFyIHJhd1NldCA9IG5ldyBXZWFrTWFwKCk7CnZhciByZWFkb25seVNldCA9IG5ldyBXZWFrTWFwKCk7Cgp2YXIgUmVmSW1wbCA9Ci8qKiBAY2xhc3MgKi8KZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIFJlZkltcGwoX2EpIHsKICAgIHZhciBnZXQgPSBfYS5nZXQsCiAgICAgICAgc2V0ID0gX2Euc2V0OwogICAgcHJveHkodGhpcywgJ3ZhbHVlJywgewogICAgICBnZXQ6IGdldCwKICAgICAgc2V0OiBzZXQKICAgIH0pOwogIH0KCiAgcmV0dXJuIFJlZkltcGw7Cn0oKTsKCmZ1bmN0aW9uIGNyZWF0ZVJlZihvcHRpb25zLCByZWFkb25seSkgewogIHZhciByID0gbmV3IFJlZkltcGwob3B0aW9ucyk7IC8vIHNlYWwgdGhlIHJlZiwgdGhpcyBjb3VsZCBwcmV2ZW50IHJlZiBmcm9tIGJlaW5nIG9ic2VydmVkCiAgLy8gSXQncyBzYWZlIHRvIHNlYWwgdGhlIHJlZiwgc2luY2Ugd2UgcmVhbGx5IHNob3VsZG4ndCBleHRlbmQgaXQuCiAgLy8gcmVsYXRlZCBpc3N1ZXM6ICM3OQoKICB2YXIgc2VhbGVkID0gT2JqZWN0LnNlYWwocik7CiAgcmVhZG9ubHlTZXQuc2V0KHNlYWxlZCwgdHJ1ZSk7CiAgcmV0dXJuIHNlYWxlZDsKfQoKZnVuY3Rpb24gcmVmKHJhdykgewogIHZhciBfYTsKCiAgaWYgKGlzUmVmKHJhdykpIHsKICAgIHJldHVybiByYXc7CiAgfQoKICB2YXIgdmFsdWUgPSByZWFjdGl2ZSgoX2EgPSB7fSwgX2FbUmVmS2V5XSA9IHJhdywgX2EpKTsKICByZXR1cm4gY3JlYXRlUmVmKHsKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gdmFsdWVbUmVmS2V5XTsKICAgIH0sCiAgICBzZXQ6IGZ1bmN0aW9uIHNldCh2KSB7CiAgICAgIHJldHVybiB2YWx1ZVtSZWZLZXldID0gdjsKICAgIH0KICB9KTsKfQoKZnVuY3Rpb24gaXNSZWYodmFsdWUpIHsKICByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBSZWZJbXBsOwp9CgpmdW5jdGlvbiB1bnJlZihyZWYpIHsKICByZXR1cm4gaXNSZWYocmVmKSA/IHJlZi52YWx1ZSA6IHJlZjsKfQoKZnVuY3Rpb24gdG9SZWZzKG9iaikgewogIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nICYmICFpc1JlYWN0aXZlKG9iaikpIHsKICAgIHdhcm4kMSgidG9SZWZzKCkgZXhwZWN0cyBhIHJlYWN0aXZlIG9iamVjdCBidXQgcmVjZWl2ZWQgYSBwbGFpbiBvbmUuIik7CiAgfQoKICBpZiAoIWlzUGxhaW5PYmplY3Qob2JqKSkgcmV0dXJuIG9iajsKICB2YXIgcmV0ID0ge307CgogIGZvciAodmFyIGtleSBpbiBvYmopIHsKICAgIHJldFtrZXldID0gdG9SZWYob2JqLCBrZXkpOwogIH0KCiAgcmV0dXJuIHJldDsKfQoKZnVuY3Rpb24gY3VzdG9tUmVmKGZhY3RvcnkpIHsKICB2YXIgdmVyc2lvbiA9IHJlZigwKTsKICByZXR1cm4gY3JlYXRlUmVmKGZhY3RvcnkoZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHZvaWQgdmVyc2lvbi52YWx1ZTsKICB9LCBmdW5jdGlvbiAoKSB7CiAgICArK3ZlcnNpb24udmFsdWU7CiAgfSkpOwp9CgpmdW5jdGlvbiB0b1JlZihvYmplY3QsIGtleSkgewogIHZhciB2ID0gb2JqZWN0W2tleV07CiAgaWYgKGlzUmVmKHYpKSByZXR1cm4gdjsKICByZXR1cm4gY3JlYXRlUmVmKHsKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gb2JqZWN0W2tleV07CiAgICB9LAogICAgc2V0OiBmdW5jdGlvbiBzZXQodikgewogICAgICByZXR1cm4gb2JqZWN0W2tleV0gPSB2OwogICAgfQogIH0pOwp9CgpmdW5jdGlvbiBzaGFsbG93UmVmKHJhdykgewogIHZhciBfYTsKCiAgaWYgKGlzUmVmKHJhdykpIHsKICAgIHJldHVybiByYXc7CiAgfQoKICB2YXIgdmFsdWUgPSBzaGFsbG93UmVhY3RpdmUoKF9hID0ge30sIF9hW1JlZktleV0gPSByYXcsIF9hKSk7CiAgcmV0dXJuIGNyZWF0ZVJlZih7CiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIHZhbHVlW1JlZktleV07CiAgICB9LAogICAgc2V0OiBmdW5jdGlvbiBzZXQodikgewogICAgICByZXR1cm4gdmFsdWVbUmVmS2V5XSA9IHY7CiAgICB9CiAgfSk7Cn0KCmZ1bmN0aW9uIHRyaWdnZXJSZWYodmFsdWUpIHsKICBpZiAoIWlzUmVmKHZhbHVlKSkgcmV0dXJuOwogIHZhbHVlLnZhbHVlID0gdmFsdWUudmFsdWU7Cn0KCmZ1bmN0aW9uIHByb3h5UmVmcyhvYmplY3RXaXRoUmVmcykgewogIHZhciBfYSwgZV8xLCBfYjsKCiAgaWYgKGlzUmVhY3RpdmUob2JqZWN0V2l0aFJlZnMpKSB7CiAgICByZXR1cm4gb2JqZWN0V2l0aFJlZnM7CiAgfQoKICB2YXIgdmFsdWUgPSByZWFjdGl2ZSgoX2EgPSB7fSwgX2FbUmVmS2V5XSA9IG9iamVjdFdpdGhSZWZzLCBfYSkpOwoKICB2YXIgX2xvb3BfMSA9IGZ1bmN0aW9uIF9sb29wXzEoa2V5KSB7CiAgICBwcm94eSh2YWx1ZSwga2V5LCB7CiAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgIGlmIChpc1JlZih2YWx1ZVtrZXldKSkgewogICAgICAgICAgcmV0dXJuIHZhbHVlW2tleV0udmFsdWU7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdmFsdWVba2V5XTsKICAgICAgfSwKICAgICAgc2V0OiBmdW5jdGlvbiBzZXQodikgewogICAgICAgIGlmIChpc1JlZih2YWx1ZVtrZXldKSkgewogICAgICAgICAgcmV0dXJuIHZhbHVlW2tleV0udmFsdWUgPSB1bnJlZih2KTsKICAgICAgICB9CgogICAgICAgIHZhbHVlW2tleV0gPSB1bnJlZih2KTsKICAgICAgfQogICAgfSk7CiAgfTsKCiAgdHJ5IHsKICAgIGZvciAodmFyIF9jID0gX192YWx1ZXMoT2JqZWN0LmtleXMob2JqZWN0V2l0aFJlZnMpKSwgX2QgPSBfYy5uZXh0KCk7ICFfZC5kb25lOyBfZCA9IF9jLm5leHQoKSkgewogICAgICB2YXIga2V5ID0gX2QudmFsdWU7CgogICAgICBfbG9vcF8xKGtleSk7CiAgICB9CiAgfSBjYXRjaCAoZV8xXzEpIHsKICAgIGVfMSA9IHsKICAgICAgZXJyb3I6IGVfMV8xCiAgICB9OwogIH0gZmluYWxseSB7CiAgICB0cnkgewogICAgICBpZiAoX2QgJiYgIV9kLmRvbmUgJiYgKF9iID0gX2NbInJldHVybiJdKSkgX2IuY2FsbChfYyk7CiAgICB9IGZpbmFsbHkgewogICAgICBpZiAoZV8xKSB0aHJvdyBlXzEuZXJyb3I7CiAgICB9CiAgfQoKICByZXR1cm4gdmFsdWU7Cn0KCmZ1bmN0aW9uIGlzUmF3KG9iaikgewogIHZhciBfYTsKCiAgcmV0dXJuIEJvb2xlYW4oKG9iaiA9PT0gbnVsbCB8fCBvYmogPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9iai5fX29iX18pICYmICgoX2EgPSBvYmouX19vYl9fKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuX19yYXdfXykpOwp9CgpmdW5jdGlvbiBpc1JlYWN0aXZlKG9iaikgewogIHZhciBfYTsKCiAgcmV0dXJuIEJvb2xlYW4oKG9iaiA9PT0gbnVsbCB8fCBvYmogPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9iai5fX29iX18pICYmICEoKF9hID0gb2JqLl9fb2JfXykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLl9fcmF3X18pKTsKfQovKioNCiAqIFByb3hpbmcgcHJvcGVydHkgYWNjZXNzIG9mIHRhcmdldC4NCiAqIFdlIGNhbiBkbyB1bndyYXBwaW5nIGFuZCBvdGhlciB0aGluZ3MgaGVyZS4NCiAqLwoKCmZ1bmN0aW9uIHNldHVwQWNjZXNzQ29udHJvbCh0YXJnZXQpIHsKICBpZiAoIWlzUGxhaW5PYmplY3QodGFyZ2V0KSB8fCBpc1Jhdyh0YXJnZXQpIHx8IEFycmF5LmlzQXJyYXkodGFyZ2V0KSB8fCBpc1JlZih0YXJnZXQpIHx8IGlzQ29tcG9uZW50SW5zdGFuY2UodGFyZ2V0KSB8fCBhY2Nlc3NNb2RpZmllZFNldC5oYXModGFyZ2V0KSkgcmV0dXJuOwogIGFjY2Vzc01vZGlmaWVkU2V0LnNldCh0YXJnZXQsIHRydWUpOwogIHZhciBrZXlzID0gT2JqZWN0LmtleXModGFyZ2V0KTsKCiAgZm9yICh2YXIgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7CiAgICBkZWZpbmVBY2Nlc3NDb250cm9sKHRhcmdldCwga2V5c1tpXSk7CiAgfQp9Ci8qKg0KICogQXV0byB1bndyYXBwaW5nIHdoZW4gYWNjZXNzIHByb3BlcnR5DQogKi8KCgpmdW5jdGlvbiBkZWZpbmVBY2Nlc3NDb250cm9sKHRhcmdldCwga2V5LCB2YWwpIHsKICBpZiAoa2V5ID09PSAnX19vYl9fJykgcmV0dXJuOwogIGlmIChpc1Jhdyh0YXJnZXRba2V5XSkpIHJldHVybjsKICB2YXIgZ2V0dGVyOwogIHZhciBzZXR0ZXI7CiAgdmFyIHByb3BlcnR5ID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0YXJnZXQsIGtleSk7CgogIGlmIChwcm9wZXJ0eSkgewogICAgaWYgKHByb3BlcnR5LmNvbmZpZ3VyYWJsZSA9PT0gZmFsc2UpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGdldHRlciA9IHByb3BlcnR5LmdldDsKICAgIHNldHRlciA9IHByb3BlcnR5LnNldDsKCiAgICBpZiAoKCFnZXR0ZXIgfHwgc2V0dGVyKSAmJgogICAgLyogbm90IG9ubHkgaGF2ZSBnZXR0ZXIgKi8KICAgIGFyZ3VtZW50cy5sZW5ndGggPT09IDIpIHsKICAgICAgdmFsID0gdGFyZ2V0W2tleV07CiAgICB9CiAgfQoKICBzZXR1cEFjY2Vzc0NvbnRyb2wodmFsKTsKICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHsKICAgIGVudW1lcmFibGU6IHRydWUsCiAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldHRlckhhbmRsZXIoKSB7CiAgICAgIHZhciB2YWx1ZSA9IGdldHRlciA/IGdldHRlci5jYWxsKHRhcmdldCkgOiB2YWw7IC8vIGlmIHRoZSBrZXkgaXMgZXF1YWwgdG8gUmVmS2V5LCBza2lwIHRoZSB1bndyYXAgbG9naWMKCiAgICAgIGlmIChrZXkgIT09IFJlZktleSAmJiBpc1JlZih2YWx1ZSkpIHsKICAgICAgICByZXR1cm4gdmFsdWUudmFsdWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICB9CiAgICB9LAogICAgc2V0OiBmdW5jdGlvbiBzZXR0ZXJIYW5kbGVyKG5ld1ZhbCkgewogICAgICBpZiAoZ2V0dGVyICYmICFzZXR0ZXIpIHJldHVybjsKICAgICAgdmFyIHZhbHVlID0gZ2V0dGVyID8gZ2V0dGVyLmNhbGwodGFyZ2V0KSA6IHZhbDsgLy8gSWYgdGhlIGtleSBpcyBlcXVhbCB0byBSZWZLZXksIHNraXAgdGhlIHVud3JhcCBsb2dpYwogICAgICAvLyBJZiBhbmQgb25seSBpZiAidmFsdWUiIGlzIHJlZiBhbmQgIm5ld1ZhbCIgaXMgbm90IGEgcmVmLAogICAgICAvLyB0aGUgYXNzaWdubWVudCBzaG91bGQgYmUgcHJveGllZCB0byAidmFsdWUiIHJlZi4KCiAgICAgIGlmIChrZXkgIT09IFJlZktleSAmJiBpc1JlZih2YWx1ZSkgJiYgIWlzUmVmKG5ld1ZhbCkpIHsKICAgICAgICB2YWx1ZS52YWx1ZSA9IG5ld1ZhbDsKICAgICAgfSBlbHNlIGlmIChzZXR0ZXIpIHsKICAgICAgICBzZXR0ZXIuY2FsbCh0YXJnZXQsIG5ld1ZhbCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFsID0gbmV3VmFsOwogICAgICB9CgogICAgICBzZXR1cEFjY2Vzc0NvbnRyb2wobmV3VmFsKTsKICAgIH0KICB9KTsKfQoKZnVuY3Rpb24gb2JzZXJ2ZShvYmopIHsKICB2YXIgVnVlID0gZ2V0UmVnaXN0ZXJlZFZ1ZU9yRGVmYXVsdCgpOwogIHZhciBvYnNlcnZlZDsKCiAgaWYgKFZ1ZS5vYnNlcnZhYmxlKSB7CiAgICBvYnNlcnZlZCA9IFZ1ZS5vYnNlcnZhYmxlKG9iaik7CiAgfSBlbHNlIHsKICAgIHZhciB2bSA9IGRlZmluZUNvbXBvbmVudEluc3RhbmNlKFZ1ZSwgewogICAgICBkYXRhOiB7CiAgICAgICAgJCRzdGF0ZTogb2JqCiAgICAgIH0KICAgIH0pOwogICAgb2JzZXJ2ZWQgPSB2bS5fZGF0YS4kJHN0YXRlOwogIH0gLy8gaW4gU1NSLCB0aGVyZSBpcyBubyBfX29iX18uIE1vY2sgZm9yIHJlYWN0aXZpdHkgY2hlY2sKCgogIGlmICghaGFzT3duKG9ic2VydmVkLCAnX19vYl9fJykpIHsKICAgIGRlZihvYnNlcnZlZCwgJ19fb2JfXycsIG1vY2tPYnNlcnZlcihvYnNlcnZlZCkpOwogIH0KCiAgcmV0dXJuIG9ic2VydmVkOwp9CgpmdW5jdGlvbiBjcmVhdGVPYnNlcnZlcigpIHsKICByZXR1cm4gb2JzZXJ2ZSh7fSkuX19vYl9fOwp9CgpmdW5jdGlvbiBtb2NrT2JzZXJ2ZXIodmFsdWUpIHsKICBpZiAodmFsdWUgPT09IHZvaWQgMCkgewogICAgdmFsdWUgPSB7fTsKICB9CgogIHJldHVybiB7CiAgICB2YWx1ZTogdmFsdWUsCiAgICBkZXA6IHsKICAgICAgbm90aWZ5OiBub29wRm4sCiAgICAgIGRlcGVuZDogbm9vcEZuLAogICAgICBhZGRTdWI6IG5vb3BGbiwKICAgICAgcmVtb3ZlU3ViOiBub29wRm4KICAgIH0KICB9Owp9CgpmdW5jdGlvbiBzaGFsbG93UmVhY3RpdmUob2JqKSB7CiAgdmFyIGVfMSwgX2E7CgogIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nICYmICFvYmopIHsKICAgIHdhcm4kMSgnInNoYWxsb3dSZWFjdGl2ZSgpIiBpcyBjYWxsZWQgd2l0aG91dCBwcm92aWRlIGFuICJvYmplY3QiLicpOwogICAgcmV0dXJuOwogIH0KCiAgaWYgKCEoaXNQbGFpbk9iamVjdChvYmopIHx8IGlzQXJyYXkob2JqKSkgfHwgaXNSYXcob2JqKSB8fCAhT2JqZWN0LmlzRXh0ZW5zaWJsZShvYmopKSB7CiAgICByZXR1cm4gb2JqOwogIH0KCiAgdmFyIG9ic2VydmVkID0gb2JzZXJ2ZSh7fSk7CiAgc2V0dXBBY2Nlc3NDb250cm9sKG9ic2VydmVkKTsKICB2YXIgb2IgPSBvYnNlcnZlZC5fX29iX187CgogIHZhciBfbG9vcF8xID0gZnVuY3Rpb24gX2xvb3BfMShrZXkpIHsKICAgIHZhciB2YWwgPSBvYmpba2V5XTsKICAgIHZhciBnZXR0ZXI7CiAgICB2YXIgc2V0dGVyOwogICAgdmFyIHByb3BlcnR5ID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmosIGtleSk7CgogICAgaWYgKHByb3BlcnR5KSB7CiAgICAgIGlmIChwcm9wZXJ0eS5jb25maWd1cmFibGUgPT09IGZhbHNlKSB7CiAgICAgICAgcmV0dXJuICJjb250aW51ZSI7CiAgICAgIH0KCiAgICAgIGdldHRlciA9IHByb3BlcnR5LmdldDsKICAgICAgc2V0dGVyID0gcHJvcGVydHkuc2V0OwogICAgfQoKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYnNlcnZlZCwga2V5LCB7CiAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgZ2V0OiBmdW5jdGlvbiBnZXR0ZXJIYW5kbGVyKCkgewogICAgICAgIHZhciBfYTsKCiAgICAgICAgdmFyIHZhbHVlID0gZ2V0dGVyID8gZ2V0dGVyLmNhbGwob2JqKSA6IHZhbDsKICAgICAgICAoX2EgPSBvYi5kZXApID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5kZXBlbmQoKTsKICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgIH0sCiAgICAgIHNldDogZnVuY3Rpb24gc2V0dGVySGFuZGxlcihuZXdWYWwpIHsKICAgICAgICB2YXIgX2E7CgogICAgICAgIGlmIChnZXR0ZXIgJiYgIXNldHRlcikgcmV0dXJuOwoKICAgICAgICBpZiAoc2V0dGVyKSB7CiAgICAgICAgICBzZXR0ZXIuY2FsbChvYmosIG5ld1ZhbCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhbCA9IG5ld1ZhbDsKICAgICAgICB9CgogICAgICAgIChfYSA9IG9iLmRlcCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLm5vdGlmeSgpOwogICAgICB9CiAgICB9KTsKICB9OwoKICB0cnkgewogICAgZm9yICh2YXIgX2IgPSBfX3ZhbHVlcyhPYmplY3Qua2V5cyhvYmopKSwgX2MgPSBfYi5uZXh0KCk7ICFfYy5kb25lOyBfYyA9IF9iLm5leHQoKSkgewogICAgICB2YXIga2V5ID0gX2MudmFsdWU7CgogICAgICBfbG9vcF8xKGtleSk7CiAgICB9CiAgfSBjYXRjaCAoZV8xXzEpIHsKICAgIGVfMSA9IHsKICAgICAgZXJyb3I6IGVfMV8xCiAgICB9OwogIH0gZmluYWxseSB7CiAgICB0cnkgewogICAgICBpZiAoX2MgJiYgIV9jLmRvbmUgJiYgKF9hID0gX2JbInJldHVybiJdKSkgX2EuY2FsbChfYik7CiAgICB9IGZpbmFsbHkgewogICAgICBpZiAoZV8xKSB0aHJvdyBlXzEuZXJyb3I7CiAgICB9CiAgfQoKICByZXR1cm4gb2JzZXJ2ZWQ7Cn0KLyoqDQogKiBNYWtlIG9iaiByZWFjdGl2aXR5DQogKi8KCgpmdW5jdGlvbiByZWFjdGl2ZShvYmopIHsKICBpZiAoIWlzT2JqZWN0KG9iaikpIHsKICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICAgIHdhcm4kMSgnInJlYWN0aXZlKCkiIGlzIGNhbGxlZCB3aXRob3V0IHByb3ZpZGUgYW4gIm9iamVjdCIuJyk7CiAgICB9CgogICAgcmV0dXJuIG9iajsKICB9CgogIGlmICghKGlzUGxhaW5PYmplY3Qob2JqKSB8fCBpc0FycmF5KG9iaikpIHx8IGlzUmF3KG9iaikgfHwgIU9iamVjdC5pc0V4dGVuc2libGUob2JqKSkgewogICAgcmV0dXJuIG9iajsKICB9CgogIHZhciBvYnNlcnZlZCA9IG9ic2VydmUob2JqKTsKICBzZXR1cEFjY2Vzc0NvbnRyb2wob2JzZXJ2ZWQpOwogIHJldHVybiBvYnNlcnZlZDsKfQovKioNCiAqIE1ha2Ugc3VyZSBvYmogY2FuJ3QgYmUgYSByZWFjdGl2ZQ0KICovCgoKZnVuY3Rpb24gbWFya1JhdyhvYmopIHsKICBpZiAoIShpc1BsYWluT2JqZWN0KG9iaikgfHwgaXNBcnJheShvYmopKSB8fCAhT2JqZWN0LmlzRXh0ZW5zaWJsZShvYmopKSB7CiAgICByZXR1cm4gb2JqOwogIH0gLy8gc2V0IHRoZSB2dWUgb2JzZXJ2YWJsZSBmbGFnIGF0IG9iagoKCiAgdmFyIG9iID0gY3JlYXRlT2JzZXJ2ZXIoKTsKICBvYi5fX3Jhd19fID0gdHJ1ZTsKICBkZWYob2JqLCAnX19vYl9fJywgb2IpOyAvLyBtYXJrIGFzIFJhdwoKICByYXdTZXQuc2V0KG9iaiwgdHJ1ZSk7CiAgcmV0dXJuIG9iajsKfQoKZnVuY3Rpb24gdG9SYXcob2JzZXJ2ZWQpIHsKICB2YXIgX2EsIF9iOwoKICBpZiAoaXNSYXcob2JzZXJ2ZWQpIHx8ICFPYmplY3QuaXNFeHRlbnNpYmxlKG9ic2VydmVkKSkgewogICAgcmV0dXJuIG9ic2VydmVkOwogIH0KCiAgcmV0dXJuICgoX2IgPSAoX2EgPSBvYnNlcnZlZCkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLl9fb2JfXykgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnZhbHVlKSB8fCBvYnNlcnZlZDsKfQoKZnVuY3Rpb24gaXNSZWFkb25seShvYmopIHsKICByZXR1cm4gcmVhZG9ubHlTZXQuaGFzKG9iaik7Cn0KLyoqDQogKiAqKkluIEB2dWUvY29tcG9zaXRpb24tYXBpLCBgcmVhY3RpdmVgIG9ubHkgcHJvdmlkZXMgdHlwZS1sZXZlbCByZWFkb25seSBjaGVjayoqDQogKg0KICogQ3JlYXRlcyBhIHJlYWRvbmx5IGNvcHkgb2YgdGhlIG9yaWdpbmFsIG9iamVjdC4gTm90ZSB0aGUgcmV0dXJuZWQgY29weSBpcyBub3QNCiAqIG1hZGUgcmVhY3RpdmUsIGJ1dCBgcmVhZG9ubHlgIGNhbiBiZSBjYWxsZWQgb24gYW4gYWxyZWFkeSByZWFjdGl2ZSBvYmplY3QuDQogKi8KCgpmdW5jdGlvbiByZWFkb25seSh0YXJnZXQpIHsKICByZXR1cm4gdGFyZ2V0Owp9CgpmdW5jdGlvbiBzaGFsbG93UmVhZG9ubHkob2JqKSB7CiAgdmFyIGVfMSwgX2E7CgogIGlmICghKGlzUGxhaW5PYmplY3Qob2JqKSB8fCBpc0FycmF5KG9iaikpIHx8ICFPYmplY3QuaXNFeHRlbnNpYmxlKG9iaikpIHsKICAgIHJldHVybiBvYmo7CiAgfQoKICB2YXIgcmVhZG9ubHlPYmogPSB7fTsKICB2YXIgc291cmNlID0gcmVhY3RpdmUoe30pOwogIHZhciBvYiA9IHNvdXJjZS5fX29iX187CgogIHZhciBfbG9vcF8xID0gZnVuY3Rpb24gX2xvb3BfMShrZXkpIHsKICAgIHZhciB2YWwgPSBvYmpba2V5XTsKICAgIHZhciBnZXR0ZXI7CiAgICB2YXIgcHJvcGVydHkgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwga2V5KTsKCiAgICBpZiAocHJvcGVydHkpIHsKICAgICAgaWYgKHByb3BlcnR5LmNvbmZpZ3VyYWJsZSA9PT0gZmFsc2UpIHsKICAgICAgICByZXR1cm4gImNvbnRpbnVlIjsKICAgICAgfQoKICAgICAgZ2V0dGVyID0gcHJvcGVydHkuZ2V0OwogICAgfQoKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShyZWFkb25seU9iaiwga2V5LCB7CiAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwKICAgICAgZ2V0OiBmdW5jdGlvbiBnZXR0ZXJIYW5kbGVyKCkgewogICAgICAgIHZhciB2YWx1ZSA9IGdldHRlciA/IGdldHRlci5jYWxsKG9iaikgOiB2YWw7CiAgICAgICAgb2IuZGVwLmRlcGVuZCgpOwogICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgfSwKICAgICAgc2V0OiBmdW5jdGlvbiBzZXQodikgewogICAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICAgICAgICB3YXJuJDEoIlNldCBvcGVyYXRpb24gb24ga2V5IFwiIiArIGtleSArICJcIiBmYWlsZWQ6IHRhcmdldCBpcyByZWFkb25seS4iKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogIH07CgogIHRyeSB7CiAgICBmb3IgKHZhciBfYiA9IF9fdmFsdWVzKE9iamVjdC5rZXlzKG9iaikpLCBfYyA9IF9iLm5leHQoKTsgIV9jLmRvbmU7IF9jID0gX2IubmV4dCgpKSB7CiAgICAgIHZhciBrZXkgPSBfYy52YWx1ZTsKCiAgICAgIF9sb29wXzEoa2V5KTsKICAgIH0KICB9IGNhdGNoIChlXzFfMSkgewogICAgZV8xID0gewogICAgICBlcnJvcjogZV8xXzEKICAgIH07CiAgfSBmaW5hbGx5IHsKICAgIHRyeSB7CiAgICAgIGlmIChfYyAmJiAhX2MuZG9uZSAmJiAoX2EgPSBfYlsicmV0dXJuIl0pKSBfYS5jYWxsKF9iKTsKICAgIH0gZmluYWxseSB7CiAgICAgIGlmIChlXzEpIHRocm93IGVfMS5lcnJvcjsKICAgIH0KICB9CgogIHJlYWRvbmx5U2V0LnNldChyZWFkb25seU9iaiwgdHJ1ZSk7CiAgcmV0dXJuIHJlYWRvbmx5T2JqOwp9Ci8qKg0KICogU2V0IGEgcHJvcGVydHkgb24gYW4gb2JqZWN0LiBBZGRzIHRoZSBuZXcgcHJvcGVydHksIHRyaWdnZXJzIGNoYW5nZQ0KICogbm90aWZpY2F0aW9uIGFuZCBpbnRlcmNlcHQgaXQncyBzdWJzZXF1ZW50IGFjY2VzcyBpZiB0aGUgcHJvcGVydHkgZG9lc24ndA0KICogYWxyZWFkeSBleGlzdC4NCiAqLwoKCmZ1bmN0aW9uIHNldCQxKHRhcmdldCwga2V5LCB2YWwpIHsKICB2YXIgVnVlID0gZ2V0VnVlQ29uc3RydWN0b3IoKTsKICB2YXIgX2EgPSBWdWUudXRpbCwKICAgICAgd2FybiA9IF9hLndhcm4sCiAgICAgIGRlZmluZVJlYWN0aXZlID0gX2EuZGVmaW5lUmVhY3RpdmU7CgogIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nICYmIChpc1VuZGVmKHRhcmdldCkgfHwgaXNQcmltaXRpdmUodGFyZ2V0KSkpIHsKICAgIHdhcm4oIkNhbm5vdCBzZXQgcmVhY3RpdmUgcHJvcGVydHkgb24gdW5kZWZpbmVkLCBudWxsLCBvciBwcmltaXRpdmUgdmFsdWU6ICIgKyB0YXJnZXQpOwogIH0KCiAgaWYgKGlzQXJyYXkodGFyZ2V0KSAmJiBpc1ZhbGlkQXJyYXlJbmRleChrZXkpKSB7CiAgICB0YXJnZXQubGVuZ3RoID0gTWF0aC5tYXgodGFyZ2V0Lmxlbmd0aCwga2V5KTsKICAgIHRhcmdldC5zcGxpY2Uoa2V5LCAxLCB2YWwpOwogICAgcmV0dXJuIHZhbDsKICB9CgogIGlmIChrZXkgaW4gdGFyZ2V0ICYmICEoa2V5IGluIE9iamVjdC5wcm90b3R5cGUpKSB7CiAgICB0YXJnZXRba2V5XSA9IHZhbDsKICAgIHJldHVybiB2YWw7CiAgfQoKICB2YXIgb2IgPSB0YXJnZXQuX19vYl9fOwoKICBpZiAodGFyZ2V0Ll9pc1Z1ZSB8fCBvYiAmJiBvYi52bUNvdW50KSB7CiAgICBwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nICYmIHdhcm4oJ0F2b2lkIGFkZGluZyByZWFjdGl2ZSBwcm9wZXJ0aWVzIHRvIGEgVnVlIGluc3RhbmNlIG9yIGl0cyByb290ICRkYXRhICcgKyAnYXQgcnVudGltZSAtIGRlY2xhcmUgaXQgdXBmcm9udCBpbiB0aGUgZGF0YSBvcHRpb24uJyk7CiAgICByZXR1cm4gdmFsOwogIH0KCiAgaWYgKCFvYikgewogICAgdGFyZ2V0W2tleV0gPSB2YWw7CiAgICByZXR1cm4gdmFsOwogIH0KCiAgZGVmaW5lUmVhY3RpdmUob2IudmFsdWUsIGtleSwgdmFsKTsgLy8gSU1QT1JUQU5UOiBkZWZpbmUgYWNjZXNzIGNvbnRyb2wgYmVmb3JlIHRyaWdnZXIgd2F0Y2hlcgoKICBkZWZpbmVBY2Nlc3NDb250cm9sKHRhcmdldCwga2V5LCB2YWwpOwogIG9iLmRlcC5ub3RpZnkoKTsKICByZXR1cm4gdmFsOwp9Ci8qKg0KICogRGVsZXRlIGEgcHJvcGVydHkgYW5kIHRyaWdnZXIgY2hhbmdlIGlmIG5lY2Vzc2FyeS4NCiAqLwoKCmZ1bmN0aW9uIGRlbCh0YXJnZXQsIGtleSkgewogIHZhciBWdWUgPSBnZXRWdWVDb25zdHJ1Y3RvcigpOwogIHZhciB3YXJuID0gVnVlLnV0aWwud2FybjsKCiAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicgJiYgKGlzVW5kZWYodGFyZ2V0KSB8fCBpc1ByaW1pdGl2ZSh0YXJnZXQpKSkgewogICAgd2FybigiQ2Fubm90IGRlbGV0ZSByZWFjdGl2ZSBwcm9wZXJ0eSBvbiB1bmRlZmluZWQsIG51bGwsIG9yIHByaW1pdGl2ZSB2YWx1ZTogIiArIHRhcmdldCk7CiAgfQoKICBpZiAoQXJyYXkuaXNBcnJheSh0YXJnZXQpICYmIGlzVmFsaWRBcnJheUluZGV4KGtleSkpIHsKICAgIHRhcmdldC5zcGxpY2Uoa2V5LCAxKTsKICAgIHJldHVybjsKICB9CgogIHZhciBvYiA9IHRhcmdldC5fX29iX187CgogIGlmICh0YXJnZXQuX2lzVnVlIHx8IG9iICYmIG9iLnZtQ291bnQpIHsKICAgIHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicgJiYgd2FybignQXZvaWQgZGVsZXRpbmcgcHJvcGVydGllcyBvbiBhIFZ1ZSBpbnN0YW5jZSBvciBpdHMgcm9vdCAkZGF0YSAnICsgJy0ganVzdCBzZXQgaXQgdG8gbnVsbC4nKTsKICAgIHJldHVybjsKICB9CgogIGlmICghaGFzT3duKHRhcmdldCwga2V5KSkgewogICAgcmV0dXJuOwogIH0KCiAgZGVsZXRlIHRhcmdldFtrZXldOwoKICBpZiAoIW9iKSB7CiAgICByZXR1cm47CiAgfQoKICBvYi5kZXAubm90aWZ5KCk7Cn0KCnZhciBnZW5OYW1lID0gZnVuY3Rpb24gZ2VuTmFtZShuYW1lKSB7CiAgcmV0dXJuICJvbiIgKyAobmFtZVswXS50b1VwcGVyQ2FzZSgpICsgbmFtZS5zbGljZSgxKSk7Cn07CgpmdW5jdGlvbiBjcmVhdGVMaWZlQ3ljbGUobGlmZUN5Y2xlaG9vaykgewogIHJldHVybiBmdW5jdGlvbiAoY2FsbGJhY2spIHsKICAgIHZhciB2bSA9IGN1cnJlbnRWTUluRm4oZ2VuTmFtZShsaWZlQ3ljbGVob29rKSk7CgogICAgaWYgKHZtKSB7CiAgICAgIGluamVjdEhvb2tPcHRpb24oZ2V0VnVlQ29uc3RydWN0b3IoKSwgdm0sIGxpZmVDeWNsZWhvb2ssIGNhbGxiYWNrKTsKICAgIH0KICB9Owp9CgpmdW5jdGlvbiBpbmplY3RIb29rT3B0aW9uKFZ1ZSwgdm0sIGhvb2ssIHZhbCkgewogIHZhciBvcHRpb25zID0gdm0uJG9wdGlvbnM7CiAgdmFyIG1lcmdlRm4gPSBWdWUuY29uZmlnLm9wdGlvbk1lcmdlU3RyYXRlZ2llc1tob29rXTsKICBvcHRpb25zW2hvb2tdID0gbWVyZ2VGbihvcHRpb25zW2hvb2tdLCB3cmFwSG9va0NhbGwodm0sIHZhbCkpOwp9CgpmdW5jdGlvbiB3cmFwSG9va0NhbGwodm0sIGZuKSB7CiAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgIHZhciBfYTsKCiAgICB2YXIgYXJncyA9IFtdOwoKICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7CiAgICAgIGFyZ3NbX2ldID0gYXJndW1lbnRzW19pXTsKICAgIH0KCiAgICB2YXIgcHJlVm0gPSAoX2EgPSBnZXRDdXJyZW50SW5zdGFuY2UoKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnByb3h5OwogICAgc2V0Q3VycmVudEluc3RhbmNlKHZtKTsKCiAgICB0cnkgewogICAgICByZXR1cm4gZm4uYXBwbHkodm9pZCAwLCBfX3NwcmVhZEFycmF5KFtdLCBfX3JlYWQoYXJncykpKTsKICAgIH0gZmluYWxseSB7CiAgICAgIHNldEN1cnJlbnRJbnN0YW5jZShwcmVWbSk7CiAgICB9CiAgfTsKfSAvLyBleHBvcnQgY29uc3Qgb25DcmVhdGVkID0gY3JlYXRlTGlmZUN5Y2xlKCdjcmVhdGVkJyk7CgoKdmFyIG9uQmVmb3JlTW91bnQgPSBjcmVhdGVMaWZlQ3ljbGUoJ2JlZm9yZU1vdW50Jyk7CnZhciBvbk1vdW50ZWQgPSBjcmVhdGVMaWZlQ3ljbGUoJ21vdW50ZWQnKTsKdmFyIG9uQmVmb3JlVXBkYXRlID0gY3JlYXRlTGlmZUN5Y2xlKCdiZWZvcmVVcGRhdGUnKTsKdmFyIG9uVXBkYXRlZCA9IGNyZWF0ZUxpZmVDeWNsZSgndXBkYXRlZCcpOwp2YXIgb25CZWZvcmVVbm1vdW50ID0gY3JlYXRlTGlmZUN5Y2xlKCdiZWZvcmVEZXN0cm95Jyk7CnZhciBvblVubW91bnRlZCA9IGNyZWF0ZUxpZmVDeWNsZSgnZGVzdHJveWVkJyk7CnZhciBvbkVycm9yQ2FwdHVyZWQgPSBjcmVhdGVMaWZlQ3ljbGUoJ2Vycm9yQ2FwdHVyZWQnKTsKdmFyIG9uQWN0aXZhdGVkID0gY3JlYXRlTGlmZUN5Y2xlKCdhY3RpdmF0ZWQnKTsKdmFyIG9uRGVhY3RpdmF0ZWQgPSBjcmVhdGVMaWZlQ3ljbGUoJ2RlYWN0aXZhdGVkJyk7CnZhciBvblNlcnZlclByZWZldGNoID0gY3JlYXRlTGlmZUN5Y2xlKCdzZXJ2ZXJQcmVmZXRjaCcpOwp2YXIgZmFsbGJhY2tWTTsKCmZ1bmN0aW9uIGZsdXNoUHJlUXVldWUoKSB7CiAgZmx1c2hRdWV1ZSh0aGlzLCBXYXRjaGVyUHJlRmx1c2hRdWV1ZUtleSk7Cn0KCmZ1bmN0aW9uIGZsdXNoUG9zdFF1ZXVlKCkgewogIGZsdXNoUXVldWUodGhpcywgV2F0Y2hlclBvc3RGbHVzaFF1ZXVlS2V5KTsKfQoKZnVuY3Rpb24gaGFzV2F0Y2hFbnYodm0pIHsKICByZXR1cm4gdm1bV2F0Y2hlclByZUZsdXNoUXVldWVLZXldICE9PSB1bmRlZmluZWQ7Cn0KCmZ1bmN0aW9uIGluc3RhbGxXYXRjaEVudih2bSkgewogIHZtW1dhdGNoZXJQcmVGbHVzaFF1ZXVlS2V5XSA9IFtdOwogIHZtW1dhdGNoZXJQb3N0Rmx1c2hRdWV1ZUtleV0gPSBbXTsKICB2bS4kb24oJ2hvb2s6YmVmb3JlVXBkYXRlJywgZmx1c2hQcmVRdWV1ZSk7CiAgdm0uJG9uKCdob29rOnVwZGF0ZWQnLCBmbHVzaFBvc3RRdWV1ZSk7Cn0KCmZ1bmN0aW9uIGdldFdhdGNoZXJPcHRpb24ob3B0aW9ucykgewogIHJldHVybiBfYXNzaWduKHsKICAgIGltbWVkaWF0ZTogZmFsc2UsCiAgICBkZWVwOiBmYWxzZSwKICAgIGZsdXNoOiAncHJlJwogIH0sIG9wdGlvbnMpOwp9CgpmdW5jdGlvbiBnZXRXYXRjaEVmZmVjdE9wdGlvbihvcHRpb25zKSB7CiAgcmV0dXJuIF9hc3NpZ24oewogICAgaW1tZWRpYXRlOiB0cnVlLAogICAgZGVlcDogZmFsc2UsCiAgICBmbHVzaDogJ3ByZScKICB9LCBvcHRpb25zKTsKfQoKZnVuY3Rpb24gZ2V0V2F0Y2hlclZNKCkgewogIHZhciBfYTsKCiAgdmFyIHZtID0gKF9hID0gZ2V0Q3VycmVudEluc3RhbmNlKCkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5wcm94eTsKCiAgaWYgKCF2bSkgewogICAgaWYgKCFmYWxsYmFja1ZNKSB7CiAgICAgIGZhbGxiYWNrVk0gPSBkZWZpbmVDb21wb25lbnRJbnN0YW5jZShnZXRWdWVDb25zdHJ1Y3RvcigpKTsKICAgIH0KCiAgICB2bSA9IGZhbGxiYWNrVk07CiAgfSBlbHNlIGlmICghaGFzV2F0Y2hFbnYodm0pKSB7CiAgICBpbnN0YWxsV2F0Y2hFbnYodm0pOwogIH0KCiAgcmV0dXJuIHZtOwp9CgpmdW5jdGlvbiBmbHVzaFF1ZXVlKHZtLCBrZXkpIHsKICB2YXIgcXVldWUgPSB2bVtrZXldOwoKICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgcXVldWUubGVuZ3RoOyBpbmRleCsrKSB7CiAgICBxdWV1ZVtpbmRleF0oKTsKICB9CgogIHF1ZXVlLmxlbmd0aCA9IDA7Cn0KCmZ1bmN0aW9uIHF1ZXVlRmx1c2hKb2Iodm0sIGZuLCBtb2RlKSB7CiAgLy8gZmx1c2ggYWxsIHdoZW4gYmVmb3JlVXBkYXRlIGFuZCB1cGRhdGVkIGFyZSBub3QgZmlyZWQKICB2YXIgZmFsbGJhY2tGbHVzaCA9IGZ1bmN0aW9uIGZhbGxiYWNrRmx1c2goKSB7CiAgICB2bS4kbmV4dFRpY2soZnVuY3Rpb24gKCkgewogICAgICBpZiAodm1bV2F0Y2hlclByZUZsdXNoUXVldWVLZXldLmxlbmd0aCkgewogICAgICAgIGZsdXNoUXVldWUodm0sIFdhdGNoZXJQcmVGbHVzaFF1ZXVlS2V5KTsKICAgICAgfQoKICAgICAgaWYgKHZtW1dhdGNoZXJQb3N0Rmx1c2hRdWV1ZUtleV0ubGVuZ3RoKSB7CiAgICAgICAgZmx1c2hRdWV1ZSh2bSwgV2F0Y2hlclBvc3RGbHVzaFF1ZXVlS2V5KTsKICAgICAgfQogICAgfSk7CiAgfTsKCiAgc3dpdGNoIChtb2RlKSB7CiAgICBjYXNlICdwcmUnOgogICAgICBmYWxsYmFja0ZsdXNoKCk7CiAgICAgIHZtW1dhdGNoZXJQcmVGbHVzaFF1ZXVlS2V5XS5wdXNoKGZuKTsKICAgICAgYnJlYWs7CgogICAgY2FzZSAncG9zdCc6CiAgICAgIGZhbGxiYWNrRmx1c2goKTsKICAgICAgdm1bV2F0Y2hlclBvc3RGbHVzaFF1ZXVlS2V5XS5wdXNoKGZuKTsKICAgICAgYnJlYWs7CgogICAgZGVmYXVsdDoKICAgICAgYXNzZXJ0KGZhbHNlLCAiZmx1c2ggbXVzdCBiZSBvbmUgb2YgW1wicG9zdFwiLCBcInByZVwiLCBcInN5bmNcIl0sIGJ1dCBnb3QgIiArIG1vZGUpOwogICAgICBicmVhazsKICB9Cn0KCmZ1bmN0aW9uIGNyZWF0ZVZ1ZVdhdGNoZXIodm0sIGdldHRlciwgY2FsbGJhY2ssIG9wdGlvbnMpIHsKICB2YXIgaW5kZXggPSB2bS5fd2F0Y2hlcnMubGVuZ3RoOyAvLyBAdHMtaWdub3JlOiB1c2UgdW5kb2N1bWVudGVkIG9wdGlvbnMKCiAgdm0uJHdhdGNoKGdldHRlciwgY2FsbGJhY2ssIHsKICAgIGltbWVkaWF0ZTogb3B0aW9ucy5pbW1lZGlhdGVJbnZva2VDYWxsYmFjaywKICAgIGRlZXA6IG9wdGlvbnMuZGVlcCwKICAgIGxhenk6IG9wdGlvbnMubm9SdW4sCiAgICBzeW5jOiBvcHRpb25zLnN5bmMsCiAgICBiZWZvcmU6IG9wdGlvbnMuYmVmb3JlCiAgfSk7CiAgcmV0dXJuIHZtLl93YXRjaGVyc1tpbmRleF07Cn0gLy8gV2UgaGF2ZSB0byBtb25rZXlwYXRjaCB0aGUgdGVhcmRvd24gZnVuY3Rpb24gc28gVnVlIHdpbGwgcnVuCi8vIHJ1bkNsZWFudXAoKSB3aGVuIGl0IHRlYXJzIGRvd24gdGhlIHdhdGNoZXIgb24gdW5tb3VudGVkLgoKCmZ1bmN0aW9uIHBhdGNoV2F0Y2hlclRlYXJkb3duKHdhdGNoZXIsIHJ1bkNsZWFudXApIHsKICB2YXIgX3RlYXJkb3duID0gd2F0Y2hlci50ZWFyZG93bjsKCiAgd2F0Y2hlci50ZWFyZG93biA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciBhcmdzID0gW107CgogICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHsKICAgICAgYXJnc1tfaV0gPSBhcmd1bWVudHNbX2ldOwogICAgfQoKICAgIF90ZWFyZG93bi5hcHBseSh3YXRjaGVyLCBhcmdzKTsKCiAgICBydW5DbGVhbnVwKCk7CiAgfTsKfQoKZnVuY3Rpb24gY3JlYXRlV2F0Y2hlcih2bSwgc291cmNlLCBjYiwgb3B0aW9ucykgewogIHZhciBfYTsKCiAgdmFyIGZsdXNoTW9kZSA9IG9wdGlvbnMuZmx1c2g7CiAgdmFyIGlzU3luYyA9IGZsdXNoTW9kZSA9PT0gJ3N5bmMnOwogIHZhciBjbGVhbnVwOwoKICB2YXIgcmVnaXN0ZXJDbGVhbnVwID0gZnVuY3Rpb24gcmVnaXN0ZXJDbGVhbnVwKGZuKSB7CiAgICBjbGVhbnVwID0gZnVuY3Rpb24gY2xlYW51cCgpIHsKICAgICAgdHJ5IHsKICAgICAgICBmbigpOwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGxvZ0Vycm9yKGVycm9yLCB2bSwgJ29uQ2xlYW51cCgpJyk7CiAgICAgIH0KICAgIH07CiAgfTsgLy8gY2xlYW51cCBiZWZvcmUgcnVubmluZyBnZXR0ZXIgYWdhaW4KCgogIHZhciBydW5DbGVhbnVwID0gZnVuY3Rpb24gcnVuQ2xlYW51cCgpIHsKICAgIGlmIChjbGVhbnVwKSB7CiAgICAgIGNsZWFudXAoKTsKICAgICAgY2xlYW51cCA9IG51bGw7CiAgICB9CiAgfTsKCiAgdmFyIGNyZWF0ZVNjaGVkdWxlciA9IGZ1bmN0aW9uIGNyZWF0ZVNjaGVkdWxlcihmbikgewogICAgaWYgKGlzU3luYyB8fAogICAgLyogd2l0aG91dCBhIGN1cnJlbnQgYWN0aXZlIGluc3RhbmNlLCBpZ25vcmUgcHJlfHBvc3QgbW9kZSAqLwogICAgdm0gPT09IGZhbGxiYWNrVk0pIHsKICAgICAgcmV0dXJuIGZuOwogICAgfQoKICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBhcmdzID0gW107CgogICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykgewogICAgICAgIGFyZ3NbX2ldID0gYXJndW1lbnRzW19pXTsKICAgICAgfQoKICAgICAgcmV0dXJuIHF1ZXVlRmx1c2hKb2Iodm0sIGZ1bmN0aW9uICgpIHsKICAgICAgICBmbi5hcHBseSh2b2lkIDAsIF9fc3ByZWFkQXJyYXkoW10sIF9fcmVhZChhcmdzKSkpOwogICAgICB9LCBmbHVzaE1vZGUpOwogICAgfTsKICB9OyAvLyBlZmZlY3Qgd2F0Y2gKCgogIGlmIChjYiA9PT0gbnVsbCkgewogICAgdmFyIHJ1bm5pbmdfMSA9IGZhbHNlOwoKICAgIHZhciBnZXR0ZXJfMSA9IGZ1bmN0aW9uIGdldHRlcl8xKCkgewogICAgICAvLyBwcmV2ZW50aW5nIHRoZSB3YXRjaCBjYWxsYmFjayBiZWluZyBjYWxsIGluIHRoZSBzYW1lIGV4ZWN1dGlvbgogICAgICBpZiAocnVubmluZ18xKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0cnkgewogICAgICAgIHJ1bm5pbmdfMSA9IHRydWU7CiAgICAgICAgc291cmNlKHJlZ2lzdGVyQ2xlYW51cCk7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgcnVubmluZ18xID0gZmFsc2U7CiAgICAgIH0KICAgIH07CgogICAgdmFyIHdhdGNoZXJfMSA9IGNyZWF0ZVZ1ZVdhdGNoZXIodm0sIGdldHRlcl8xLCBub29wRm4sIHsKICAgICAgZGVlcDogb3B0aW9ucy5kZWVwIHx8IGZhbHNlLAogICAgICBzeW5jOiBpc1N5bmMsCiAgICAgIGJlZm9yZTogcnVuQ2xlYW51cAogICAgfSk7CiAgICBwYXRjaFdhdGNoZXJUZWFyZG93bih3YXRjaGVyXzEsIHJ1bkNsZWFudXApOyAvLyBlbmFibGUgdGhlIHdhdGNoZXIgdXBkYXRlCgogICAgd2F0Y2hlcl8xLmxhenkgPSBmYWxzZTsKICAgIHZhciBvcmlnaW5HZXQgPSB3YXRjaGVyXzEuZ2V0LmJpbmQod2F0Y2hlcl8xKTsgLy8gYWx3YXlzIHJ1biB3YXRjaEVmZmVjdAoKICAgIHdhdGNoZXJfMS5nZXQgPSBjcmVhdGVTY2hlZHVsZXIob3JpZ2luR2V0KTsKICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgIHdhdGNoZXJfMS50ZWFyZG93bigpOwogICAgfTsKICB9CgogIHZhciBkZWVwID0gb3B0aW9ucy5kZWVwOwogIHZhciBnZXR0ZXI7CgogIGlmIChBcnJheS5pc0FycmF5KHNvdXJjZSkpIHsKICAgIGdldHRlciA9IGZ1bmN0aW9uIGdldHRlcigpIHsKICAgICAgcmV0dXJuIHNvdXJjZS5tYXAoZnVuY3Rpb24gKHMpIHsKICAgICAgICByZXR1cm4gaXNSZWYocykgPyBzLnZhbHVlIDogcygpOwogICAgICB9KTsKICAgIH07CiAgfSBlbHNlIGlmIChpc1JlZihzb3VyY2UpKSB7CiAgICBnZXR0ZXIgPSBmdW5jdGlvbiBnZXR0ZXIoKSB7CiAgICAgIHJldHVybiBzb3VyY2UudmFsdWU7CiAgICB9OwogIH0gZWxzZSBpZiAoaXNSZWFjdGl2ZShzb3VyY2UpKSB7CiAgICBnZXR0ZXIgPSBmdW5jdGlvbiBnZXR0ZXIoKSB7CiAgICAgIHJldHVybiBzb3VyY2U7CiAgICB9OwoKICAgIGRlZXAgPSB0cnVlOwogIH0gZWxzZSBpZiAoaXNGdW5jdGlvbihzb3VyY2UpKSB7CiAgICBnZXR0ZXIgPSBzb3VyY2U7CiAgfSBlbHNlIHsKICAgIGdldHRlciA9IG5vb3BGbjsKICAgIHdhcm4kMSgiSW52YWxpZCB3YXRjaCBzb3VyY2U6ICIgKyBKU09OLnN0cmluZ2lmeShzb3VyY2UpICsgIi5cbiAgICAgIEEgd2F0Y2ggc291cmNlIGNhbiBvbmx5IGJlIGEgZ2V0dGVyL2VmZmVjdCBmdW5jdGlvbiwgYSByZWYsIGEgcmVhY3RpdmUgb2JqZWN0LCBvciBhbiBhcnJheSBvZiB0aGVzZSB0eXBlcy4iLCB2bSk7CiAgfQoKICB2YXIgYXBwbHlDYiA9IGZ1bmN0aW9uIGFwcGx5Q2IobiwgbykgewogICAgLy8gY2xlYW51cCBiZWZvcmUgcnVubmluZyBjYiBhZ2FpbgogICAgcnVuQ2xlYW51cCgpOwogICAgY2IobiwgbywgcmVnaXN0ZXJDbGVhbnVwKTsKICB9OwoKICB2YXIgY2FsbGJhY2sgPSBjcmVhdGVTY2hlZHVsZXIoYXBwbHlDYik7CgogIGlmIChvcHRpb25zLmltbWVkaWF0ZSkgewogICAgdmFyIG9yaWdpbmFsQ2FsbGJhY2tfMSA9IGNhbGxiYWNrOyAvLyBgc2hpZnRDYWxsYmFja2AgaXMgdXNlZCB0byBoYW5kbGUgdGhlIGZpcnN0IHN5bmMgZWZmZWN0IHJ1bi4KICAgIC8vIFRoZSBzdWJzZXF1ZW50IGNhbGxiYWNrcyB3aWxsIHJlZGlyZWN0IHRvIGBjYWxsYmFja2AuCgogICAgdmFyIF9zaGlmdENhbGxiYWNrXyA9IGZ1bmN0aW9uIHNoaWZ0Q2FsbGJhY2tfMShuLCBvKSB7CiAgICAgIF9zaGlmdENhbGxiYWNrXyA9IG9yaWdpbmFsQ2FsbGJhY2tfMTsKICAgICAgYXBwbHlDYihuLCBvKTsKICAgIH07CgogICAgY2FsbGJhY2sgPSBmdW5jdGlvbiBjYWxsYmFjayhuLCBvKSB7CiAgICAgIF9zaGlmdENhbGxiYWNrXyhuLCBvKTsKICAgIH07CiAgfSAvLyBAdHMtaWdub3JlOiB1c2UgdW5kb2N1bWVudGVkIG9wdGlvbiAic3luYyIKCgogIHZhciBzdG9wID0gdm0uJHdhdGNoKGdldHRlciwgY2FsbGJhY2ssIHsKICAgIGltbWVkaWF0ZTogb3B0aW9ucy5pbW1lZGlhdGUsCiAgICBkZWVwOiBkZWVwLAogICAgc3luYzogaXNTeW5jCiAgfSk7IC8vIE9uY2UgYWdhaW4sIHdlIGhhdmUgdG8gaGFjayB0aGUgd2F0Y2hlciBmb3IgcHJvcGVyIHRlYXJkb3duCgogIHZhciB3YXRjaGVyID0gdm0uX3dhdGNoZXJzW3ZtLl93YXRjaGVycy5sZW5ndGggLSAxXTsgLy8gaWYgdGhlIHJldHVybiB2YWx1ZSBpcyByZWFjdGl2ZSBhbmQgZGVlcDp0cnVlCiAgLy8gd2F0Y2ggZm9yIGNoYW5nZXMsIHRoaXMgbWlnaHQgaGFwcGVuIHdoZW4gbmV3IGtleSBpcyBhZGRlZAoKICBpZiAoaXNSZWFjdGl2ZSh3YXRjaGVyLnZhbHVlKSAmJiAoKF9hID0gd2F0Y2hlci52YWx1ZS5fX29iX18pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5kZXApICYmIGRlZXApIHsKICAgIHdhdGNoZXIudmFsdWUuX19vYl9fLmRlcC5hZGRTdWIoewogICAgICB1cGRhdGU6IGZ1bmN0aW9uIHVwZGF0ZSgpIHsKICAgICAgICAvLyB0aGlzIHdpbGwgZm9yY2UgdGhlIHNvdXJjZSB0byBiZSByZXZhbHVhdGVkIGFuZCB0aGUgY2FsbGJhY2sKICAgICAgICAvLyBleGVjdXRlZCBpZiBuZWVkZWQKICAgICAgICB3YXRjaGVyLnJ1bigpOwogICAgICB9CiAgICB9KTsKICB9CgogIHBhdGNoV2F0Y2hlclRlYXJkb3duKHdhdGNoZXIsIHJ1bkNsZWFudXApOwogIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICBzdG9wKCk7CiAgfTsKfQoKZnVuY3Rpb24gd2F0Y2hFZmZlY3QoZWZmZWN0LCBvcHRpb25zKSB7CiAgdmFyIG9wdHMgPSBnZXRXYXRjaEVmZmVjdE9wdGlvbihvcHRpb25zKTsKICB2YXIgdm0gPSBnZXRXYXRjaGVyVk0oKTsKICByZXR1cm4gY3JlYXRlV2F0Y2hlcih2bSwgZWZmZWN0LCBudWxsLCBvcHRzKTsKfSAvLyBpbXBsZW1lbnRhdGlvbgoKCmZ1bmN0aW9uIHdhdGNoKHNvdXJjZSwgY2IsIG9wdGlvbnMpIHsKICB2YXIgY2FsbGJhY2sgPSBudWxsOwoKICBpZiAodHlwZW9mIGNiID09PSAnZnVuY3Rpb24nKSB7CiAgICAvLyBzb3VyY2Ugd2F0Y2gKICAgIGNhbGxiYWNrID0gY2I7CiAgfSBlbHNlIHsKICAgIC8vIGVmZmVjdCB3YXRjaAogICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHsKICAgICAgd2FybiQxKCJgd2F0Y2goZm4sIG9wdGlvbnM/KWAgc2lnbmF0dXJlIGhhcyBiZWVuIG1vdmVkIHRvIGEgc2VwYXJhdGUgQVBJLiAiICsgIlVzZSBgd2F0Y2hFZmZlY3QoZm4sIG9wdGlvbnM/KWAgaW5zdGVhZC4gYHdhdGNoYCBub3cgb25seSAiICsgInN1cHBvcnRzIGB3YXRjaChzb3VyY2UsIGNiLCBvcHRpb25zPykgc2lnbmF0dXJlLiIpOwogICAgfQoKICAgIG9wdGlvbnMgPSBjYjsKICAgIGNhbGxiYWNrID0gbnVsbDsKICB9CgogIHZhciBvcHRzID0gZ2V0V2F0Y2hlck9wdGlvbihvcHRpb25zKTsKICB2YXIgdm0gPSBnZXRXYXRjaGVyVk0oKTsKICByZXR1cm4gY3JlYXRlV2F0Y2hlcih2bSwgc291cmNlLCBjYWxsYmFjaywgb3B0cyk7Cn0gLy8gaW1wbGVtZW50CgoKZnVuY3Rpb24gY29tcHV0ZWQoZ2V0dGVyT3JPcHRpb25zKSB7CiAgdmFyIF9hOwoKICB2YXIgdm0gPSAoX2EgPSBnZXRDdXJyZW50SW5zdGFuY2UoKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnByb3h5OwogIHZhciBnZXR0ZXI7CiAgdmFyIHNldHRlcjsKCiAgaWYgKHR5cGVvZiBnZXR0ZXJPck9wdGlvbnMgPT09ICdmdW5jdGlvbicpIHsKICAgIGdldHRlciA9IGdldHRlck9yT3B0aW9uczsKICB9IGVsc2UgewogICAgZ2V0dGVyID0gZ2V0dGVyT3JPcHRpb25zLmdldDsKICAgIHNldHRlciA9IGdldHRlck9yT3B0aW9ucy5zZXQ7CiAgfQoKICB2YXIgY29tcHV0ZWRTZXR0ZXI7CiAgdmFyIGNvbXB1dGVkR2V0dGVyOwoKICBpZiAodm0gJiYgIXZtLiRpc1NlcnZlcikgewogICAgdmFyIF9iID0gZ2V0VnVlSW50ZXJuYWxDbGFzc2VzKCksCiAgICAgICAgV2F0Y2hlcl8xID0gX2IuV2F0Y2hlciwKICAgICAgICBEZXBfMSA9IF9iLkRlcDsKCiAgICB2YXIgd2F0Y2hlcl8xOwoKICAgIGNvbXB1dGVkR2V0dGVyID0gZnVuY3Rpb24gY29tcHV0ZWRHZXR0ZXIoKSB7CiAgICAgIGlmICghd2F0Y2hlcl8xKSB7CiAgICAgICAgd2F0Y2hlcl8xID0gbmV3IFdhdGNoZXJfMSh2bSwgZ2V0dGVyLCBub29wRm4sIHsKICAgICAgICAgIGxhenk6IHRydWUKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgaWYgKHdhdGNoZXJfMS5kaXJ0eSkgewogICAgICAgIHdhdGNoZXJfMS5ldmFsdWF0ZSgpOwogICAgICB9CgogICAgICBpZiAoRGVwXzEudGFyZ2V0KSB7CiAgICAgICAgd2F0Y2hlcl8xLmRlcGVuZCgpOwogICAgICB9CgogICAgICByZXR1cm4gd2F0Y2hlcl8xLnZhbHVlOwogICAgfTsKCiAgICBjb21wdXRlZFNldHRlciA9IGZ1bmN0aW9uIGNvbXB1dGVkU2V0dGVyKHYpIHsKICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicgJiYgIXNldHRlcikgewogICAgICAgIHdhcm4kMSgnV3JpdGUgb3BlcmF0aW9uIGZhaWxlZDogY29tcHV0ZWQgdmFsdWUgaXMgcmVhZG9ubHkuJywgdm0pOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKHNldHRlcikgewogICAgICAgIHNldHRlcih2KTsKICAgICAgfQogICAgfTsKICB9IGVsc2UgewogICAgLy8gZmFsbGJhY2sKICAgIHZhciBjb21wdXRlZEhvc3RfMSA9IGRlZmluZUNvbXBvbmVudEluc3RhbmNlKGdldFZ1ZUNvbnN0cnVjdG9yKCksIHsKICAgICAgY29tcHV0ZWQ6IHsKICAgICAgICAkJHN0YXRlOiB7CiAgICAgICAgICBnZXQ6IGdldHRlciwKICAgICAgICAgIHNldDogc2V0dGVyCiAgICAgICAgfQogICAgICB9CiAgICB9KTsKICAgIHZtICYmIHZtLiRvbignaG9vazpkZXN0cm95ZWQnLCBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBjb21wdXRlZEhvc3RfMS4kZGVzdHJveSgpOwogICAgfSk7CgogICAgY29tcHV0ZWRHZXR0ZXIgPSBmdW5jdGlvbiBjb21wdXRlZEdldHRlcigpIHsKICAgICAgcmV0dXJuIGNvbXB1dGVkSG9zdF8xLiQkc3RhdGU7CiAgICB9OwoKICAgIGNvbXB1dGVkU2V0dGVyID0gZnVuY3Rpb24gY29tcHV0ZWRTZXR0ZXIodikgewogICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJyAmJiAhc2V0dGVyKSB7CiAgICAgICAgd2FybiQxKCdXcml0ZSBvcGVyYXRpb24gZmFpbGVkOiBjb21wdXRlZCB2YWx1ZSBpcyByZWFkb25seS4nLCB2bSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb21wdXRlZEhvc3RfMS4kJHN0YXRlID0gdjsKICAgIH07CiAgfQoKICByZXR1cm4gY3JlYXRlUmVmKHsKICAgIGdldDogY29tcHV0ZWRHZXR0ZXIsCiAgICBzZXQ6IGNvbXB1dGVkU2V0dGVyCiAgfSk7Cn0KCnZhciBOT1RfRk9VTkQgPSB7fTsKCmZ1bmN0aW9uIHJlc29sdmVJbmplY3QocHJvdmlkZUtleSwgdm0pIHsKICB2YXIgc291cmNlID0gdm07CgogIHdoaWxlIChzb3VyY2UpIHsKICAgIC8vIEB0cy1pZ25vcmUKICAgIGlmIChzb3VyY2UuX3Byb3ZpZGVkICYmIGhhc093bihzb3VyY2UuX3Byb3ZpZGVkLCBwcm92aWRlS2V5KSkgewogICAgICAvL0B0cy1pZ25vcmUKICAgICAgcmV0dXJuIHNvdXJjZS5fcHJvdmlkZWRbcHJvdmlkZUtleV07CiAgICB9CgogICAgc291cmNlID0gc291cmNlLiRwYXJlbnQ7CiAgfQoKICByZXR1cm4gTk9UX0ZPVU5EOwp9CgpmdW5jdGlvbiBwcm92aWRlKGtleSwgdmFsdWUpIHsKICB2YXIgdm0gPSBjdXJyZW50Vk1JbkZuKCdwcm92aWRlJyk7CiAgaWYgKCF2bSkgcmV0dXJuOwoKICBpZiAoIXZtLl9wcm92aWRlZCkgewogICAgdmFyIHByb3ZpZGVDYWNoZV8xID0ge307CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodm0sICdfcHJvdmlkZWQnLCB7CiAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgIHJldHVybiBwcm92aWRlQ2FjaGVfMTsKICAgICAgfSwKICAgICAgc2V0OiBmdW5jdGlvbiBzZXQodikgewogICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKHByb3ZpZGVDYWNoZV8xLCB2KTsKICAgICAgfQogICAgfSk7CiAgfQoKICB2bS5fcHJvdmlkZWRba2V5XSA9IHZhbHVlOwp9CgpmdW5jdGlvbiBpbmplY3Qoa2V5LCBkZWZhdWx0VmFsdWUsIHRyZWF0RGVmYXVsdEFzRmFjdG9yeSkgewogIHZhciBfYTsKCiAgaWYgKHRyZWF0RGVmYXVsdEFzRmFjdG9yeSA9PT0gdm9pZCAwKSB7CiAgICB0cmVhdERlZmF1bHRBc0ZhY3RvcnkgPSBmYWxzZTsKICB9CgogIGlmICgha2V5KSB7CiAgICByZXR1cm4gZGVmYXVsdFZhbHVlOwogIH0KCiAgdmFyIHZtID0gKF9hID0gZ2V0Q3VycmVudEluc3RhbmNlKCkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5wcm94eTsKCiAgaWYgKCF2bSkgewogICAgd2FybiQxKCJpbmplY3QoKSBjYW4gb25seSBiZSB1c2VkIGluc2lkZSBzZXR1cCgpIG9yIGZ1bmN0aW9uYWwgY29tcG9uZW50cy4iKTsKICAgIHJldHVybjsKICB9CgogIHZhciB2YWwgPSByZXNvbHZlSW5qZWN0KGtleSwgdm0pOwoKICBpZiAodmFsICE9PSBOT1RfRk9VTkQpIHsKICAgIHJldHVybiB2YWw7CiAgfQoKICBpZiAoZGVmYXVsdFZhbHVlID09PSB1bmRlZmluZWQgJiYgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgewogICAgd2FybiQxKCJJbmplY3Rpb24gXCIiICsgU3RyaW5nKGtleSkgKyAiXCIgbm90IGZvdW5kIiwgdm0pOwogIH0KCiAgcmV0dXJuIHRyZWF0RGVmYXVsdEFzRmFjdG9yeSAmJiBpc0Z1bmN0aW9uKGRlZmF1bHRWYWx1ZSkgPyBkZWZhdWx0VmFsdWUoKSA6IGRlZmF1bHRWYWx1ZTsKfQoKdmFyIEVNUFRZX09CSiA9IHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicgPyBPYmplY3QuZnJlZXplKHt9KSA6IHt9OwoKdmFyIHVzZUNzc01vZHVsZSA9IGZ1bmN0aW9uIHVzZUNzc01vZHVsZShuYW1lKSB7CiAgdmFyIF9hOwoKICBpZiAobmFtZSA9PT0gdm9pZCAwKSB7CiAgICBuYW1lID0gJyRzdHlsZSc7CiAgfQoKICB2YXIgaW5zdGFuY2UgPSBnZXRDdXJyZW50SW5zdGFuY2UoKTsKCiAgaWYgKCFpbnN0YW5jZSkgewogICAgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJyAmJiB3YXJuJDEoInVzZUNzc01vZHVsZSBtdXN0IGJlIGNhbGxlZCBpbnNpZGUgc2V0dXAoKSIpOwogICAgcmV0dXJuIEVNUFRZX09CSjsKICB9CgogIHZhciBtb2QgPSAoX2EgPSBpbnN0YW5jZS5wcm94eSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hW25hbWVdOwoKICBpZiAoIW1vZCkgewogICAgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJyAmJiB3YXJuJDEoIkN1cnJlbnQgaW5zdGFuY2UgZG9lcyBub3QgaGF2ZSBDU1MgbW9kdWxlIG5hbWVkIFwiIiArIG5hbWUgKyAiXCIuIik7CiAgICByZXR1cm4gRU1QVFlfT0JKOwogIH0KCiAgcmV0dXJuIG1vZDsKfTsKLyoqDQogKiBAZGVwcmVjYXRlZCB1c2UgYHVzZUNzc01vZHVsZWAgaW5zdGVhZC4NCiAqLwoKCnZhciB1c2VDU1NNb2R1bGUgPSB1c2VDc3NNb2R1bGU7CgpmdW5jdGlvbiBjcmVhdGVBcHAocm9vdENvbXBvbmVudCwgcm9vdFByb3BzKSB7CiAgaWYgKHJvb3RQcm9wcyA9PT0gdm9pZCAwKSB7CiAgICByb290UHJvcHMgPSB1bmRlZmluZWQ7CiAgfQoKICB2YXIgViA9IGdldFZ1ZUNvbnN0cnVjdG9yKCk7CiAgdmFyIG1vdW50ZWRWTSA9IHVuZGVmaW5lZDsKICByZXR1cm4gewogICAgY29uZmlnOiBWLmNvbmZpZywKICAgIHVzZTogVi51c2UuYmluZChWKSwKICAgIG1peGluOiBWLm1peGluLmJpbmQoViksCiAgICBjb21wb25lbnQ6IFYuY29tcG9uZW50LmJpbmQoViksCiAgICBkaXJlY3RpdmU6IFYuZGlyZWN0aXZlLmJpbmQoViksCiAgICBtb3VudDogZnVuY3Rpb24gbW91bnQoZWwsIGh5ZHJhdGluZykgewogICAgICBpZiAoIW1vdW50ZWRWTSkgewogICAgICAgIG1vdW50ZWRWTSA9IG5ldyBWKF9hc3NpZ24oewogICAgICAgICAgcHJvcHNEYXRhOiByb290UHJvcHMKICAgICAgICB9LCByb290Q29tcG9uZW50KSk7CiAgICAgICAgbW91bnRlZFZNLiRtb3VudChlbCwgaHlkcmF0aW5nKTsKICAgICAgICByZXR1cm4gbW91bnRlZFZNOwogICAgICB9IGVsc2UgewogICAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICAgICAgICB3YXJuJDEoIkFwcCBoYXMgYWxyZWFkeSBiZWVuIG1vdW50ZWQuXG4iICsgIklmIHlvdSB3YW50IHRvIHJlbW91bnQgdGhlIHNhbWUgYXBwLCBtb3ZlIHlvdXIgYXBwIGNyZWF0aW9uIGxvZ2ljICIgKyAiaW50byBhIGZhY3RvcnkgZnVuY3Rpb24gYW5kIGNyZWF0ZSBmcmVzaCBhcHAgaW5zdGFuY2VzIGZvciBlYWNoICIgKyAibW91bnQgLSBlLmcuIGBjb25zdCBjcmVhdGVNeUFwcCA9ICgpID0+IGNyZWF0ZUFwcChBcHApYCIpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG1vdW50ZWRWTTsKICAgICAgfQogICAgfSwKICAgIHVubW91bnQ6IGZ1bmN0aW9uIHVubW91bnQoKSB7CiAgICAgIGlmIChtb3VudGVkVk0pIHsKICAgICAgICBtb3VudGVkVk0uJGRlc3Ryb3koKTsKICAgICAgICBtb3VudGVkVk0gPSB1bmRlZmluZWQ7CiAgICAgIH0gZWxzZSBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgewogICAgICAgIHdhcm4kMSgiQ2Fubm90IHVubW91bnQgYW4gYXBwIHRoYXQgaXMgbm90IG1vdW50ZWQuIik7CiAgICAgIH0KICAgIH0KICB9Owp9Cgp2YXIgbmV4dFRpY2sgPSBmdW5jdGlvbiBuZXh0VGljaygpIHsKICB2YXIgX2E7CgogIHZhciBhcmdzID0gW107CgogIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7CiAgICBhcmdzW19pXSA9IGFyZ3VtZW50c1tfaV07CiAgfQoKICByZXR1cm4gKF9hID0gZ2V0VnVlQ29uc3RydWN0b3IoKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLm5leHRUaWNrLmFwcGx5KHRoaXMsIGFyZ3MpOwp9OwoKdmFyIGZhbGxiYWNrQ3JlYXRlRWxlbWVudDsKCnZhciBjcmVhdGVFbGVtZW50ID0gZnVuY3Rpb24gY3JlYXRlRWxlbWVudCgpIHsKICB2YXIgX2E7CgogIHZhciBhcmdzID0gW107CgogIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7CiAgICBhcmdzW19pXSA9IGFyZ3VtZW50c1tfaV07CiAgfQoKICB2YXIgaW5zdGFuY2UgPSAoX2EgPSBnZXRDdXJyZW50SW5zdGFuY2UoKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnByb3h5OwoKICBpZiAoIWluc3RhbmNlKSB7CiAgICB3YXJuJDEoJ2BjcmVhdGVFbGVtZW50KClgIGhhcyBiZWVuIGNhbGxlZCBvdXRzaWRlIG9mIHJlbmRlciBmdW5jdGlvbi4nKTsKCiAgICBpZiAoIWZhbGxiYWNrQ3JlYXRlRWxlbWVudCkgewogICAgICBmYWxsYmFja0NyZWF0ZUVsZW1lbnQgPSBkZWZpbmVDb21wb25lbnRJbnN0YW5jZShnZXRWdWVDb25zdHJ1Y3RvcigpKS4kY3JlYXRlRWxlbWVudDsKICAgIH0KCiAgICByZXR1cm4gZmFsbGJhY2tDcmVhdGVFbGVtZW50LmFwcGx5KGZhbGxiYWNrQ3JlYXRlRWxlbWVudCwgYXJncyk7CiAgfQoKICByZXR1cm4gaW5zdGFuY2UuJGNyZWF0ZUVsZW1lbnQuYXBwbHkoaW5zdGFuY2UsIGFyZ3MpOwp9OwovKioNCiAqIERpc3BsYXlzIGEgd2FybmluZyBtZXNzYWdlICh1c2luZyBjb25zb2xlLmVycm9yKSB3aXRoIGEgc3RhY2sgdHJhY2UgaWYgdGhlDQogKiBmdW5jdGlvbiBpcyBjYWxsZWQgaW5zaWRlIG9mIGFjdGl2ZSBjb21wb25lbnQuDQogKg0KICogQHBhcmFtIG1lc3NhZ2Ugd2FybmluZyBtZXNzYWdlIHRvIGJlIGRpc3BsYXllZA0KICovCgoKZnVuY3Rpb24gd2FybihtZXNzYWdlKSB7CiAgdmFyIF9hOwoKICB3YXJuJDEobWVzc2FnZSwgKF9hID0gZ2V0Q3VycmVudEluc3RhbmNlKCkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5wcm94eSk7Cn0KCmZ1bmN0aW9uIHNldCh2bSwga2V5LCB2YWx1ZSkgewogIHZhciBzdGF0ZSA9IHZtLl9fY29tcG9zaXRpb25fYXBpX3N0YXRlX18gPSB2bS5fX2NvbXBvc2l0aW9uX2FwaV9zdGF0ZV9fIHx8IHt9OwogIHN0YXRlW2tleV0gPSB2YWx1ZTsKfQoKZnVuY3Rpb24gZ2V0KHZtLCBrZXkpIHsKICByZXR1cm4gKHZtLl9fY29tcG9zaXRpb25fYXBpX3N0YXRlX18gfHwge30pW2tleV07Cn0KCnZhciB2bVN0YXRlTWFuYWdlciA9IHsKICBzZXQ6IHNldCwKICBnZXQ6IGdldAp9OwoKZnVuY3Rpb24gYXNWbVByb3BlcnR5KHZtLCBwcm9wTmFtZSwgcHJvcFZhbHVlKSB7CiAgdmFyIHByb3BzID0gdm0uJG9wdGlvbnMucHJvcHM7CgogIGlmICghKHByb3BOYW1lIGluIHZtKSAmJiAhKHByb3BzICYmIGhhc093bihwcm9wcywgcHJvcE5hbWUpKSkgewogICAgaWYgKGlzUmVmKHByb3BWYWx1ZSkpIHsKICAgICAgcHJveHkodm0sIHByb3BOYW1lLCB7CiAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICByZXR1cm4gcHJvcFZhbHVlLnZhbHVlOwogICAgICAgIH0sCiAgICAgICAgc2V0OiBmdW5jdGlvbiBzZXQodmFsKSB7CiAgICAgICAgICBwcm9wVmFsdWUudmFsdWUgPSB2YWw7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIC8vIEB0cy1pZ25vcmUKICAgICAgdm1bcHJvcE5hbWVdID0gcHJvcFZhbHVlOwogICAgfQoKICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICAgIC8vIGV4cG9zZSBiaW5kaW5nIHRvIFZ1ZSBEZXZ0b29sIGFzIGEgZGF0YSBwcm9wZXJ0eQogICAgICAvLyBkZWxheSB0aGlzIHVudGlsIHN0YXRlIGhhcyBiZWVuIHJlc29sdmVkIHRvIHByZXZlbnQgcmVwZWF0ZWQgd29ya3MKICAgICAgdm0uJG5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoaXNSZWYocHJvcFZhbHVlKSkgewogICAgICAgICAgcHJveHkodm0uX2RhdGEsIHByb3BOYW1lLCB7CiAgICAgICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICAgIHJldHVybiBwcm9wVmFsdWUudmFsdWU7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHNldDogZnVuY3Rpb24gc2V0KHZhbCkgewogICAgICAgICAgICAgIHByb3BWYWx1ZS52YWx1ZSA9IHZhbDsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZtLl9kYXRhW3Byb3BOYW1lXSA9IHByb3BWYWx1ZTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0gZWxzZSBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgewogICAgaWYgKHByb3BzICYmIGhhc093bihwcm9wcywgcHJvcE5hbWUpKSB7CiAgICAgIHdhcm4kMSgiVGhlIHNldHVwIGJpbmRpbmcgcHJvcGVydHkgXCIiICsgcHJvcE5hbWUgKyAiXCIgaXMgYWxyZWFkeSBkZWNsYXJlZCBhcyBhIHByb3AuIiwgdm0pOwogICAgfSBlbHNlIHsKICAgICAgd2FybiQxKCJUaGUgc2V0dXAgYmluZGluZyBwcm9wZXJ0eSBcIiIgKyBwcm9wTmFtZSArICJcIiBpcyBhbHJlYWR5IGRlY2xhcmVkLiIsIHZtKTsKICAgIH0KICB9Cn0KCmZ1bmN0aW9uIHVwZGF0ZVRlbXBsYXRlUmVmKHZtKSB7CiAgdmFyIHJhd0JpbmRpbmdzID0gdm1TdGF0ZU1hbmFnZXIuZ2V0KHZtLCAncmF3QmluZGluZ3MnKSB8fCB7fTsKICBpZiAoIXJhd0JpbmRpbmdzIHx8ICFPYmplY3Qua2V5cyhyYXdCaW5kaW5ncykubGVuZ3RoKSByZXR1cm47CiAgdmFyIHJlZnMgPSB2bS4kcmVmczsKICB2YXIgb2xkUmVmS2V5cyA9IHZtU3RhdGVNYW5hZ2VyLmdldCh2bSwgJ3JlZnMnKSB8fCBbXTsKCiAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IG9sZFJlZktleXMubGVuZ3RoOyBpbmRleCsrKSB7CiAgICB2YXIga2V5ID0gb2xkUmVmS2V5c1tpbmRleF07CiAgICB2YXIgc2V0dXBWYWx1ZSA9IHJhd0JpbmRpbmdzW2tleV07CgogICAgaWYgKCFyZWZzW2tleV0gJiYgc2V0dXBWYWx1ZSAmJiBpc1JlZihzZXR1cFZhbHVlKSkgewogICAgICBzZXR1cFZhbHVlLnZhbHVlID0gbnVsbDsKICAgIH0KICB9CgogIHZhciBuZXdLZXlzID0gT2JqZWN0LmtleXMocmVmcyk7CiAgdmFyIHZhbGlkTmV3S2V5cyA9IFtdOwoKICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgbmV3S2V5cy5sZW5ndGg7IGluZGV4KyspIHsKICAgIHZhciBrZXkgPSBuZXdLZXlzW2luZGV4XTsKICAgIHZhciBzZXR1cFZhbHVlID0gcmF3QmluZGluZ3Nba2V5XTsKCiAgICBpZiAocmVmc1trZXldICYmIHNldHVwVmFsdWUgJiYgaXNSZWYoc2V0dXBWYWx1ZSkpIHsKICAgICAgc2V0dXBWYWx1ZS52YWx1ZSA9IHJlZnNba2V5XTsKICAgICAgdmFsaWROZXdLZXlzLnB1c2goa2V5KTsKICAgIH0KICB9CgogIHZtU3RhdGVNYW5hZ2VyLnNldCh2bSwgJ3JlZnMnLCB2YWxpZE5ld0tleXMpOwp9CgpmdW5jdGlvbiByZXNvbHZlU2NvcGVkU2xvdHModm0sIHNsb3RzUHJveHkpIHsKICB2YXIgcGFyZW50Vk5vZGUgPSB2bS4kb3B0aW9ucy5fcGFyZW50Vm5vZGU7CiAgaWYgKCFwYXJlbnRWTm9kZSkgcmV0dXJuOwogIHZhciBwcmV2U2xvdHMgPSB2bVN0YXRlTWFuYWdlci5nZXQodm0sICdzbG90cycpIHx8IFtdOwogIHZhciBjdXJTbG90cyA9IHJlc29sdmVTbG90cyhwYXJlbnRWTm9kZS5kYXRhLnNjb3BlZFNsb3RzLCB2bS4kc2xvdHMpOyAvLyByZW1vdmUgc3RhbGVkIHNsb3RzCgogIGZvciAodmFyIGluZGV4ID0gMDsgaW5kZXggPCBwcmV2U2xvdHMubGVuZ3RoOyBpbmRleCsrKSB7CiAgICB2YXIga2V5ID0gcHJldlNsb3RzW2luZGV4XTsKCiAgICBpZiAoIWN1clNsb3RzW2tleV0pIHsKICAgICAgZGVsZXRlIHNsb3RzUHJveHlba2V5XTsKICAgIH0KICB9IC8vIHByb3h5IGZyZXNoIHNsb3RzCgoKICB2YXIgc2xvdE5hbWVzID0gT2JqZWN0LmtleXMoY3VyU2xvdHMpOwoKICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgc2xvdE5hbWVzLmxlbmd0aDsgaW5kZXgrKykgewogICAgdmFyIGtleSA9IHNsb3ROYW1lc1tpbmRleF07CgogICAgaWYgKCFzbG90c1Byb3h5W2tleV0pIHsKICAgICAgc2xvdHNQcm94eVtrZXldID0gY3JlYXRlU2xvdFByb3h5KHZtLCBrZXkpOwogICAgfQogIH0KCiAgdm1TdGF0ZU1hbmFnZXIuc2V0KHZtLCAnc2xvdHMnLCBzbG90TmFtZXMpOwp9CgpmdW5jdGlvbiBhY3RpdmF0ZUN1cnJlbnRJbnN0YW5jZSh2bSwgZm4sIG9uRXJyb3IpIHsKICB2YXIgcHJlVm0gPSBnZXRDdXJyZW50VnVlMkluc3RhbmNlKCk7CiAgc2V0Q3VycmVudEluc3RhbmNlKHZtKTsKCiAgdHJ5IHsKICAgIHJldHVybiBmbih2bSk7CiAgfSBjYXRjaCAoZXJyKSB7CiAgICBpZiAob25FcnJvcikgewogICAgICBvbkVycm9yKGVycik7CiAgICB9IGVsc2UgewogICAgICB0aHJvdyBlcnI7CiAgICB9CiAgfSBmaW5hbGx5IHsKICAgIHNldEN1cnJlbnRJbnN0YW5jZShwcmVWbSk7CiAgfQp9CgpmdW5jdGlvbiBtaXhpbihWdWUpIHsKICBWdWUubWl4aW4oewogICAgYmVmb3JlQ3JlYXRlOiBmdW5jdGlvbkFwaUluaXQsCiAgICBtb3VudGVkOiBmdW5jdGlvbiBtb3VudGVkKCkgewogICAgICB1cGRhdGVUZW1wbGF0ZVJlZih0aGlzKTsKICAgIH0sCiAgICB1cGRhdGVkOiBmdW5jdGlvbiB1cGRhdGVkKCkgewogICAgICB1cGRhdGVUZW1wbGF0ZVJlZih0aGlzKTsKICAgIH0KICB9KTsKICAvKioNCiAgICogVnVleCBpbml0IGhvb2ssIGluamVjdGVkIGludG8gZWFjaCBpbnN0YW5jZXMgaW5pdCBob29rcyBsaXN0Lg0KICAgKi8KCiAgZnVuY3Rpb24gZnVuY3Rpb25BcGlJbml0KCkgewogICAgdmFyIHZtID0gdGhpczsKICAgIHZhciAkb3B0aW9ucyA9IHZtLiRvcHRpb25zOwogICAgdmFyIHNldHVwID0gJG9wdGlvbnMuc2V0dXAsCiAgICAgICAgcmVuZGVyID0gJG9wdGlvbnMucmVuZGVyOwoKICAgIGlmIChyZW5kZXIpIHsKICAgICAgLy8ga2VlcCBjdXJyZW50SW5zdGFuY2UgYWNjZXNzaWJsZSBmb3IgY3JlYXRlRWxlbWVudAogICAgICAkb3B0aW9ucy5yZW5kZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgICAgdmFyIGFyZ3MgPSBbXTsKCiAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHsKICAgICAgICAgIGFyZ3NbX2ldID0gYXJndW1lbnRzW19pXTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBhY3RpdmF0ZUN1cnJlbnRJbnN0YW5jZSh2bSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIHJlbmRlci5hcHBseShfdGhpcywgYXJncyk7CiAgICAgICAgfSk7CiAgICAgIH07CiAgICB9CgogICAgaWYgKCFzZXR1cCkgewogICAgICByZXR1cm47CiAgICB9CgogICAgaWYgKHR5cGVvZiBzZXR1cCAhPT0gJ2Z1bmN0aW9uJykgewogICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgewogICAgICAgIHdhcm4kMSgnVGhlICJzZXR1cCIgb3B0aW9uIHNob3VsZCBiZSBhIGZ1bmN0aW9uIHRoYXQgcmV0dXJucyBhIG9iamVjdCBpbiBjb21wb25lbnQgZGVmaW5pdGlvbnMuJywgdm0pOwogICAgICB9CgogICAgICByZXR1cm47CiAgICB9CgogICAgdmFyIGRhdGEgPSAkb3B0aW9ucy5kYXRhOyAvLyB3cmFwcGVyIHRoZSBkYXRhIG9wdGlvbiwgc28gd2UgY2FuIGludm9rZSBzZXR1cCBiZWZvcmUgZGF0YSBnZXQgcmVzb2x2ZWQKCiAgICAkb3B0aW9ucy5kYXRhID0gZnVuY3Rpb24gd3JhcHBlZERhdGEoKSB7CiAgICAgIGluaXRTZXR1cCh2bSwgdm0uJHByb3BzKTsKICAgICAgcmV0dXJuIHR5cGVvZiBkYXRhID09PSAnZnVuY3Rpb24nID8gZGF0YS5jYWxsKHZtLCB2bSkgOiBkYXRhIHx8IHt9OwogICAgfTsKICB9CgogIGZ1bmN0aW9uIGluaXRTZXR1cCh2bSwgcHJvcHMpIHsKICAgIGlmIChwcm9wcyA9PT0gdm9pZCAwKSB7CiAgICAgIHByb3BzID0ge307CiAgICB9CgogICAgdmFyIHNldHVwID0gdm0uJG9wdGlvbnMuc2V0dXA7CiAgICB2YXIgY3R4ID0gY3JlYXRlU2V0dXBDb250ZXh0KHZtKTsgLy8gZmFrZSByZWFjdGl2ZSBmb3IgYHRvUmVmcyhwcm9wcylgCgogICAgZGVmKHByb3BzLCAnX19vYl9fJywgY3JlYXRlT2JzZXJ2ZXIoKSk7IC8vIHJlc29sdmUgc2NvcGVkU2xvdHMgYW5kIHNsb3RzIHRvIGZ1bmN0aW9ucwogICAgLy8gQHRzLWV4cGVjdC1lcnJvcgoKICAgIHJlc29sdmVTY29wZWRTbG90cyh2bSwgY3R4LnNsb3RzKTsKICAgIHZhciBiaW5kaW5nOwogICAgYWN0aXZhdGVDdXJyZW50SW5zdGFuY2Uodm0sIGZ1bmN0aW9uICgpIHsKICAgICAgLy8gbWFrZSBwcm9wcyB0byBiZSBmYWtlIHJlYWN0aXZlLCB0aGlzIGlzIGZvciBgdG9SZWZzKHByb3BzKWAKICAgICAgYmluZGluZyA9IHNldHVwKHByb3BzLCBjdHgpOwogICAgfSk7CiAgICBpZiAoIWJpbmRpbmcpIHJldHVybjsKCiAgICBpZiAoaXNGdW5jdGlvbihiaW5kaW5nKSkgewogICAgICAvLyBrZWVwIHR5cGVzY3JpcHQgaGFwcHkgd2l0aCB0aGUgYmluZGluZyB0eXBlLgogICAgICB2YXIgYmluZGluZ0Z1bmNfMSA9IGJpbmRpbmc7IC8vIGtlZXAgY3VycmVudEluc3RhbmNlIGFjY2Vzc2libGUgZm9yIGNyZWF0ZUVsZW1lbnQKCiAgICAgIHZtLiRvcHRpb25zLnJlbmRlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yCiAgICAgICAgcmVzb2x2ZVNjb3BlZFNsb3RzKHZtLCBjdHguc2xvdHMpOwogICAgICAgIHJldHVybiBhY3RpdmF0ZUN1cnJlbnRJbnN0YW5jZSh2bSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIGJpbmRpbmdGdW5jXzEoKTsKICAgICAgICB9KTsKICAgICAgfTsKCiAgICAgIHJldHVybjsKICAgIH0gZWxzZSBpZiAoaXNQbGFpbk9iamVjdChiaW5kaW5nKSkgewogICAgICBpZiAoaXNSZWFjdGl2ZShiaW5kaW5nKSkgewogICAgICAgIGJpbmRpbmcgPSB0b1JlZnMoYmluZGluZyk7CiAgICAgIH0KCiAgICAgIHZtU3RhdGVNYW5hZ2VyLnNldCh2bSwgJ3Jhd0JpbmRpbmdzJywgYmluZGluZyk7CiAgICAgIHZhciBiaW5kaW5nT2JqXzEgPSBiaW5kaW5nOwogICAgICBPYmplY3Qua2V5cyhiaW5kaW5nT2JqXzEpLmZvckVhY2goZnVuY3Rpb24gKG5hbWUpIHsKICAgICAgICB2YXIgYmluZGluZ1ZhbHVlID0gYmluZGluZ09ial8xW25hbWVdOwoKICAgICAgICBpZiAoIWlzUmVmKGJpbmRpbmdWYWx1ZSkpIHsKICAgICAgICAgIGlmICghaXNSZWFjdGl2ZShiaW5kaW5nVmFsdWUpKSB7CiAgICAgICAgICAgIGlmIChpc0Z1bmN0aW9uKGJpbmRpbmdWYWx1ZSkpIHsKICAgICAgICAgICAgICBiaW5kaW5nVmFsdWUgPSBiaW5kaW5nVmFsdWUuYmluZCh2bSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoIWlzT2JqZWN0KGJpbmRpbmdWYWx1ZSkpIHsKICAgICAgICAgICAgICBiaW5kaW5nVmFsdWUgPSByZWYoYmluZGluZ1ZhbHVlKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChoYXNSZWFjdGl2ZUFycmF5Q2hpbGQoYmluZGluZ1ZhbHVlKSkgewogICAgICAgICAgICAgIC8vIGNyZWF0ZXMgYSBjdXN0b20gcmVhY3RpdmUgcHJvcGVydGllcyB3aXRob3V0IG1ha2UgdGhlIG9iamVjdCBleHBsaWNpdGx5IHJlYWN0aXZlCiAgICAgICAgICAgICAgLy8gTk9URSB3ZSBzaG91bGQgdHJ5IHRvIGF2b2lkIHRoaXMsIGJldHRlciBpbXBsZW1lbnRhdGlvbiBuZWVkZWQKICAgICAgICAgICAgICBjdXN0b21SZWFjdGl2ZShiaW5kaW5nVmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgaWYgKGlzQXJyYXkoYmluZGluZ1ZhbHVlKSkgewogICAgICAgICAgICBiaW5kaW5nVmFsdWUgPSByZWYoYmluZGluZ1ZhbHVlKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGFzVm1Qcm9wZXJ0eSh2bSwgbmFtZSwgYmluZGluZ1ZhbHVlKTsKICAgICAgfSk7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgewogICAgICBhc3NlcnQoZmFsc2UsICJcInNldHVwXCIgbXVzdCByZXR1cm4gYSBcIk9iamVjdFwiIG9yIGEgXCJGdW5jdGlvblwiLCBnb3QgXCIiICsgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGJpbmRpbmcpLnNsaWNlKDgsIC0xKSArICJcIiIpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gY3VzdG9tUmVhY3RpdmUodGFyZ2V0KSB7CiAgICBpZiAoIWlzUGxhaW5PYmplY3QodGFyZ2V0KSB8fCBpc1JlZih0YXJnZXQpIHx8IGlzUmVhY3RpdmUodGFyZ2V0KSB8fCBpc1Jhdyh0YXJnZXQpKSByZXR1cm47CiAgICB2YXIgVnVlID0gZ2V0VnVlQ29uc3RydWN0b3IoKTsKICAgIHZhciBkZWZpbmVSZWFjdGl2ZSA9IFZ1ZS51dGlsLmRlZmluZVJlYWN0aXZlOwogICAgT2JqZWN0LmtleXModGFyZ2V0KS5mb3JFYWNoKGZ1bmN0aW9uIChrKSB7CiAgICAgIHZhciB2YWwgPSB0YXJnZXRba107CiAgICAgIGRlZmluZVJlYWN0aXZlKHRhcmdldCwgaywgdmFsKTsKCiAgICAgIGlmICh2YWwpIHsKICAgICAgICBjdXN0b21SZWFjdGl2ZSh2YWwpOwogICAgICB9CgogICAgICByZXR1cm47CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIGhhc1JlYWN0aXZlQXJyYXlDaGlsZCh0YXJnZXQsIHZpc2l0ZWQpIHsKICAgIGlmICh2aXNpdGVkID09PSB2b2lkIDApIHsKICAgICAgdmlzaXRlZCA9IG5ldyBNYXAoKTsKICAgIH0KCiAgICBpZiAodmlzaXRlZC5oYXModGFyZ2V0KSkgewogICAgICByZXR1cm4gdmlzaXRlZC5nZXQodGFyZ2V0KTsKICAgIH0KCiAgICB2aXNpdGVkLnNldCh0YXJnZXQsIGZhbHNlKTsKCiAgICBpZiAoQXJyYXkuaXNBcnJheSh0YXJnZXQpICYmIGlzUmVhY3RpdmUodGFyZ2V0KSkgewogICAgICB2aXNpdGVkLnNldCh0YXJnZXQsIHRydWUpOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBpZiAoIWlzUGxhaW5PYmplY3QodGFyZ2V0KSB8fCBpc1Jhdyh0YXJnZXQpKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICByZXR1cm4gT2JqZWN0LmtleXModGFyZ2V0KS5zb21lKGZ1bmN0aW9uICh4KSB7CiAgICAgIHJldHVybiBoYXNSZWFjdGl2ZUFycmF5Q2hpbGQodGFyZ2V0W3hdLCB2aXNpdGVkKTsKICAgIH0pOwogIH0KCiAgZnVuY3Rpb24gY3JlYXRlU2V0dXBDb250ZXh0KHZtKSB7CiAgICB2YXIgY3R4ID0gewogICAgICBzbG90czoge30KICAgIH07CiAgICB2YXIgcHJvcHNQbGFpbiA9IFsncm9vdCcsICdwYXJlbnQnLCAncmVmcycsICdsaXN0ZW5lcnMnLCAnaXNTZXJ2ZXInLCAnc3NyQ29udGV4dCddOwogICAgdmFyIHByb3BzUmVhY3RpdmVQcm94eSA9IFsnYXR0cnMnXTsKICAgIHZhciBtZXRob2RSZXR1cm5Wb2lkID0gWydlbWl0J107CiAgICBwcm9wc1BsYWluLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICB2YXIgc3JjS2V5ID0gIiQiICsga2V5OwogICAgICBwcm94eShjdHgsIGtleSwgewogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgcmV0dXJuIHZtW3NyY0tleV07CiAgICAgICAgfSwKICAgICAgICBzZXQ6IGZ1bmN0aW9uIHNldCgpIHsKICAgICAgICAgIHdhcm4kMSgiQ2Fubm90IGFzc2lnbiB0byAnIiArIGtleSArICInIGJlY2F1c2UgaXQgaXMgYSByZWFkLW9ubHkgcHJvcGVydHkiLCB2bSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0pOwogICAgcHJvcHNSZWFjdGl2ZVByb3h5LmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICB2YXIgc3JjS2V5ID0gIiQiICsga2V5OwogICAgICBwcm94eShjdHgsIGtleSwgewogICAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgdmFyIGVfMSwgX2E7CgogICAgICAgICAgdmFyIGRhdGEgPSByZWFjdGl2ZSh7fSk7CiAgICAgICAgICB2YXIgc291cmNlID0gdm1bc3JjS2V5XTsKCiAgICAgICAgICB2YXIgX2xvb3BfMSA9IGZ1bmN0aW9uIF9sb29wXzEoYXR0cikgewogICAgICAgICAgICBwcm94eShkYXRhLCBhdHRyLCB7CiAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgICAgICAvLyB0byBlbnN1cmUgaXQgYWx3YXlzIHJldHVybiB0aGUgbGF0ZXN0IHZhbHVlCiAgICAgICAgICAgICAgICByZXR1cm4gdm1bc3JjS2V5XVthdHRyXTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfTsKCiAgICAgICAgICB0cnkgewogICAgICAgICAgICBmb3IgKHZhciBfYiA9IF9fdmFsdWVzKE9iamVjdC5rZXlzKHNvdXJjZSkpLCBfYyA9IF9iLm5leHQoKTsgIV9jLmRvbmU7IF9jID0gX2IubmV4dCgpKSB7CiAgICAgICAgICAgICAgdmFyIGF0dHIgPSBfYy52YWx1ZTsKCiAgICAgICAgICAgICAgX2xvb3BfMShhdHRyKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBjYXRjaCAoZV8xXzEpIHsKICAgICAgICAgICAgZV8xID0gewogICAgICAgICAgICAgIGVycm9yOiBlXzFfMQogICAgICAgICAgICB9OwogICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBpZiAoX2MgJiYgIV9jLmRvbmUgJiYgKF9hID0gX2JbInJldHVybiJdKSkgX2EuY2FsbChfYik7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgaWYgKGVfMSkgdGhyb3cgZV8xLmVycm9yOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIGRhdGE7CiAgICAgICAgfSwKICAgICAgICBzZXQ6IGZ1bmN0aW9uIHNldCgpIHsKICAgICAgICAgIHdhcm4kMSgiQ2Fubm90IGFzc2lnbiB0byAnIiArIGtleSArICInIGJlY2F1c2UgaXQgaXMgYSByZWFkLW9ubHkgcHJvcGVydHkiLCB2bSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0pOwogICAgbWV0aG9kUmV0dXJuVm9pZC5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgdmFyIHNyY0tleSA9ICIkIiArIGtleTsKICAgICAgcHJveHkoY3R4LCBrZXksIHsKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBhcmdzID0gW107CgogICAgICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykgewogICAgICAgICAgICAgIGFyZ3NbX2ldID0gYXJndW1lbnRzW19pXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGZuID0gdm1bc3JjS2V5XTsKICAgICAgICAgICAgZm4uYXBwbHkodm0sIGFyZ3MpOwogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSk7CgogICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAndGVzdCcpIHsKICAgICAgY3R4Ll92bSA9IHZtOwogICAgfQoKICAgIHJldHVybiBjdHg7CiAgfQp9Ci8qKg0KICogSGVscGVyIHRoYXQgcmVjdXJzaXZlbHkgbWVyZ2VzIHR3byBkYXRhIG9iamVjdHMgdG9nZXRoZXIuDQogKi8KCgpmdW5jdGlvbiBtZXJnZURhdGEoZnJvbSwgdG8pIHsKICBpZiAoIWZyb20pIHJldHVybiB0bzsKICBpZiAoIXRvKSByZXR1cm4gZnJvbTsKICB2YXIga2V5OwogIHZhciB0b1ZhbDsKICB2YXIgZnJvbVZhbDsKICB2YXIga2V5cyA9IGhhc1N5bWJvbCA/IFJlZmxlY3Qub3duS2V5cyhmcm9tKSA6IE9iamVjdC5rZXlzKGZyb20pOwoKICBmb3IgKHZhciBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHsKICAgIGtleSA9IGtleXNbaV07IC8vIGluIGNhc2UgdGhlIG9iamVjdCBpcyBhbHJlYWR5IG9ic2VydmVkLi4uCgogICAgaWYgKGtleSA9PT0gJ19fb2JfXycpIGNvbnRpbnVlOwogICAgdG9WYWwgPSB0b1trZXldOwogICAgZnJvbVZhbCA9IGZyb21ba2V5XTsKCiAgICBpZiAoIWhhc093bih0bywga2V5KSkgewogICAgICB0b1trZXldID0gZnJvbVZhbDsKICAgIH0gZWxzZSBpZiAodG9WYWwgIT09IGZyb21WYWwgJiYgaXNQbGFpbk9iamVjdCh0b1ZhbCkgJiYgIWlzUmVmKHRvVmFsKSAmJiBpc1BsYWluT2JqZWN0KGZyb21WYWwpICYmICFpc1JlZihmcm9tVmFsKSkgewogICAgICBtZXJnZURhdGEoZnJvbVZhbCwgdG9WYWwpOwogICAgfQogIH0KCiAgcmV0dXJuIHRvOwp9CgpmdW5jdGlvbiBfaW5zdGFsbChWdWUpIHsKICBpZiAoaXNWdWVSZWdpc3RlcmVkKFZ1ZSkpIHsKICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICAgIHdhcm4kMSgnW3Z1ZS1jb21wb3NpdGlvbi1hcGldIGFscmVhZHkgaW5zdGFsbGVkLiBWdWUudXNlKFZ1ZUNvbXBvc2l0aW9uQVBJKSBzaG91bGQgYmUgY2FsbGVkIG9ubHkgb25jZS4nKTsKICAgIH0KCiAgICByZXR1cm47CiAgfQoKICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgewogICAgaWYgKFZ1ZS52ZXJzaW9uKSB7CiAgICAgIGlmIChWdWUudmVyc2lvblswXSAhPT0gJzInIHx8IFZ1ZS52ZXJzaW9uWzFdICE9PSAnLicpIHsKICAgICAgICB3YXJuJDEoIlt2dWUtY29tcG9zaXRpb24tYXBpXSBvbmx5IHdvcmtzIHdpdGggVnVlIDIsIHYiICsgVnVlLnZlcnNpb24gKyAiIGZvdW5kLiIpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICB3YXJuJDEoJ1t2dWUtY29tcG9zaXRpb24tYXBpXSBubyBWdWUgdmVyc2lvbiBmb3VuZCcpOwogICAgfQogIH0KCiAgVnVlLmNvbmZpZy5vcHRpb25NZXJnZVN0cmF0ZWdpZXMuc2V0dXAgPSBmdW5jdGlvbiAocGFyZW50LCBjaGlsZCkgewogICAgcmV0dXJuIGZ1bmN0aW9uIG1lcmdlZFNldHVwRm4ocHJvcHMsIGNvbnRleHQpIHsKICAgICAgcmV0dXJuIG1lcmdlRGF0YSh0eXBlb2YgcGFyZW50ID09PSAnZnVuY3Rpb24nID8gcGFyZW50KHByb3BzLCBjb250ZXh0KSB8fCB7fSA6IHVuZGVmaW5lZCwgdHlwZW9mIGNoaWxkID09PSAnZnVuY3Rpb24nID8gY2hpbGQocHJvcHMsIGNvbnRleHQpIHx8IHt9IDogdW5kZWZpbmVkKTsKICAgIH07CiAgfTsKCiAgc2V0VnVlQ29uc3RydWN0b3IoVnVlKTsKICBtaXhpbihWdWUpOwp9Cgp2YXIgUGx1Z2luID0gewogIGluc3RhbGw6IGZ1bmN0aW9uIGluc3RhbGwoVnVlKSB7CiAgICByZXR1cm4gX2luc3RhbGwoVnVlKTsKICB9Cn07IC8vIGltcGxlbWVudGF0aW9uLCBjbG9zZSB0byBuby1vcAoKZnVuY3Rpb24gZGVmaW5lQ29tcG9uZW50KG9wdGlvbnMpIHsKICByZXR1cm4gb3B0aW9uczsKfQoKZnVuY3Rpb24gZGVmaW5lQXN5bmNDb21wb25lbnQoc291cmNlKSB7CiAgaWYgKGlzRnVuY3Rpb24oc291cmNlKSkgewogICAgc291cmNlID0gewogICAgICBsb2FkZXI6IHNvdXJjZQogICAgfTsKICB9CgogIHZhciBsb2FkZXIgPSBzb3VyY2UubG9hZGVyLAogICAgICBsb2FkaW5nQ29tcG9uZW50ID0gc291cmNlLmxvYWRpbmdDb21wb25lbnQsCiAgICAgIGVycm9yQ29tcG9uZW50ID0gc291cmNlLmVycm9yQ29tcG9uZW50LAogICAgICBfYSA9IHNvdXJjZS5kZWxheSwKICAgICAgZGVsYXkgPSBfYSA9PT0gdm9pZCAwID8gMjAwIDogX2EsCiAgICAgIHRpbWVvdXQgPSBzb3VyY2UudGltZW91dCwKICAgICAgLy8gdW5kZWZpbmVkID0gbmV2ZXIgdGltZXMgb3V0CiAgX2IgPSBzb3VyY2Uuc3VzcGVuc2libGUsCiAgICAgIC8vIHVuZGVmaW5lZCA9IG5ldmVyIHRpbWVzIG91dAogIHN1c3BlbnNpYmxlID0gX2IgPT09IHZvaWQgMCA/IGZhbHNlIDogX2IsCiAgICAgIC8vIGluIFZ1ZSAzIGRlZmF1bHQgaXMgdHJ1ZQogIHVzZXJPbkVycm9yID0gc291cmNlLm9uRXJyb3I7CgogIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nICYmIHN1c3BlbnNpYmxlKSB7CiAgICB3YXJuJDEoIlRoZSBzdXNwZW5zaWJsYmUgb3B0aW9uIGZvciBhc3luYyBjb21wb25lbnRzIGlzIG5vdCBzdXBwb3J0ZWQgaW4gVnVlMi4gSXQgaXMgaWdub3JlZC4iKTsKICB9CgogIHZhciBwZW5kaW5nUmVxdWVzdCA9IG51bGw7CiAgdmFyIHJldHJpZXMgPSAwOwoKICB2YXIgcmV0cnkgPSBmdW5jdGlvbiByZXRyeSgpIHsKICAgIHJldHJpZXMrKzsKICAgIHBlbmRpbmdSZXF1ZXN0ID0gbnVsbDsKICAgIHJldHVybiBsb2FkKCk7CiAgfTsKCiAgdmFyIGxvYWQgPSBmdW5jdGlvbiBsb2FkKCkgewogICAgdmFyIHRoaXNSZXF1ZXN0OwogICAgcmV0dXJuIHBlbmRpbmdSZXF1ZXN0IHx8ICh0aGlzUmVxdWVzdCA9IHBlbmRpbmdSZXF1ZXN0ID0gbG9hZGVyKClbImNhdGNoIl0oZnVuY3Rpb24gKGVycikgewogICAgICBlcnIgPSBlcnIgaW5zdGFuY2VvZiBFcnJvciA/IGVyciA6IG5ldyBFcnJvcihTdHJpbmcoZXJyKSk7CgogICAgICBpZiAodXNlck9uRXJyb3IpIHsKICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgICAgdmFyIHVzZXJSZXRyeSA9IGZ1bmN0aW9uIHVzZXJSZXRyeSgpIHsKICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUocmV0cnkoKSk7CiAgICAgICAgICB9OwoKICAgICAgICAgIHZhciB1c2VyRmFpbCA9IGZ1bmN0aW9uIHVzZXJGYWlsKCkgewogICAgICAgICAgICByZXR1cm4gcmVqZWN0KGVycik7CiAgICAgICAgICB9OwoKICAgICAgICAgIHVzZXJPbkVycm9yKGVyciwgdXNlclJldHJ5LCB1c2VyRmFpbCwgcmV0cmllcyArIDEpOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIHRocm93IGVycjsKICAgICAgfQogICAgfSkudGhlbihmdW5jdGlvbiAoY29tcCkgewogICAgICBpZiAodGhpc1JlcXVlc3QgIT09IHBlbmRpbmdSZXF1ZXN0ICYmIHBlbmRpbmdSZXF1ZXN0KSB7CiAgICAgICAgcmV0dXJuIHBlbmRpbmdSZXF1ZXN0OwogICAgICB9CgogICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJyAmJiAhY29tcCkgewogICAgICAgIHdhcm4kMSgiQXN5bmMgY29tcG9uZW50IGxvYWRlciByZXNvbHZlZCB0byB1bmRlZmluZWQuICIgKyAiSWYgeW91IGFyZSB1c2luZyByZXRyeSgpLCBtYWtlIHN1cmUgdG8gcmV0dXJuIGl0cyByZXR1cm4gdmFsdWUuIik7CiAgICAgIH0gLy8gaW50ZXJvcCBtb2R1bGUgZGVmYXVsdAoKCiAgICAgIGlmIChjb21wICYmIChjb21wLl9fZXNNb2R1bGUgfHwgY29tcFtTeW1ib2wudG9TdHJpbmdUYWddID09PSAnTW9kdWxlJykpIHsKICAgICAgICBjb21wID0gY29tcFsiZGVmYXVsdCJdOwogICAgICB9CgogICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJyAmJiBjb21wICYmICFpc09iamVjdChjb21wKSAmJiAhaXNGdW5jdGlvbihjb21wKSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCBhc3luYyBjb21wb25lbnQgbG9hZCByZXN1bHQ6ICIgKyBjb21wKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGNvbXA7CiAgICB9KSk7CiAgfTsKCiAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgIHZhciBjb21wb25lbnQgPSBsb2FkKCk7CiAgICByZXR1cm4gewogICAgICBjb21wb25lbnQ6IGNvbXBvbmVudCwKICAgICAgZGVsYXk6IGRlbGF5LAogICAgICB0aW1lb3V0OiB0aW1lb3V0LAogICAgICBlcnJvcjogZXJyb3JDb21wb25lbnQsCiAgICAgIGxvYWRpbmc6IGxvYWRpbmdDb21wb25lbnQKICAgIH07CiAgfTsKfQoKdmFyIHZlcnNpb24gPSAiMS4wLjAtcmMuOCI7IC8vIGF1dG8gaW5zdGFsbCB3aGVuIHVzaW5nIENETgoKaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmIHdpbmRvdy5WdWUpIHsKICB3aW5kb3cuVnVlLnVzZShQbHVnaW4pOwp9CgpleHBvcnQgZGVmYXVsdCBQbHVnaW47CmV4cG9ydCB7IGNvbXB1dGVkLCBjcmVhdGVBcHAsIGNyZWF0ZVJlZiwgY3VzdG9tUmVmLCBkZWZpbmVBc3luY0NvbXBvbmVudCwgZGVmaW5lQ29tcG9uZW50LCBkZWwsIGdldEN1cnJlbnRJbnN0YW5jZSwgY3JlYXRlRWxlbWVudCBhcyBoLCBpbmplY3QsIGlzUmF3LCBpc1JlYWN0aXZlLCBpc1JlYWRvbmx5LCBpc1JlZiwgbWFya1JhdywgbmV4dFRpY2ssIG9uQWN0aXZhdGVkLCBvbkJlZm9yZU1vdW50LCBvbkJlZm9yZVVubW91bnQsIG9uQmVmb3JlVXBkYXRlLCBvbkRlYWN0aXZhdGVkLCBvbkVycm9yQ2FwdHVyZWQsIG9uTW91bnRlZCwgb25TZXJ2ZXJQcmVmZXRjaCwgb25Vbm1vdW50ZWQsIG9uVXBkYXRlZCwgcHJvdmlkZSwgcHJveHlSZWZzLCByZWFjdGl2ZSwgcmVhZG9ubHksIHJlZiwgc2V0JDEgYXMgc2V0LCBzaGFsbG93UmVhY3RpdmUsIHNoYWxsb3dSZWFkb25seSwgc2hhbGxvd1JlZiwgdG9SYXcsIHRvUmVmLCB0b1JlZnMsIHRyaWdnZXJSZWYsIHVucmVmLCB1c2VDU1NNb2R1bGUsIHVzZUNzc01vZHVsZSwgdmVyc2lvbiwgd2Fybiwgd2F0Y2gsIHdhdGNoRWZmZWN0IH07"},null]}