{"remainingRequest":"D:\\vscodeprojects\\vuepress-theme-reco\\myblogs\\node_modules\\babel-loader\\lib\\index.js??ref--3-1!D:\\vscodeprojects\\vuepress-theme-reco\\myblogs\\node_modules\\vue-i18n\\dist\\vue-i18n.esm.js","dependencies":[{"path":"D:\\vscodeprojects\\vuepress-theme-reco\\myblogs\\node_modules\\vue-i18n\\dist\\vue-i18n.esm.js","mtime":499162500000},{"path":"D:\\vscodeprojects\\vuepress-theme-reco\\myblogs\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\vscodeprojects\\vuepress-theme-reco\\myblogs\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF90eXBlb2YgZnJvbSAiRDovdnNjb2RlcHJvamVjdHMvdnVlcHJlc3MtdGhlbWUtcmVjby9teWJsb2dzL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS90eXBlb2YiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5pcy1hcnJheS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmcuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5pbmRleC1vZi5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmV2ZXJ5LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmtleXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5yZXBsYWNlLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZm9yLWVhY2guanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmRlZmluZS1wcm9wZXJ0eS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmNvbmNhdC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbHRlci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy50cmltLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucmVkdWNlLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMubnVtYmVyLmNvbnN0cnVjdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkubWFwLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNwbGl0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5jcmVhdGUuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5wYXJzZS1pbnQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zbGljZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnNldC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuaXRlcmF0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuZ2V0LXByb3RvdHlwZS1vZi5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmpvaW4uanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zb3J0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmNvbnN0cnVjdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLnRvLXN0cmluZy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5tYXRjaC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnJldmVyc2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zcGxpY2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuZGVmaW5lLXByb3BlcnRpZXMuanMiOwoKLyohCiAqIHZ1ZS1pMThuIHY4LjI0LjQgCiAqIChjKSAyMDIxIGthenV5YSBrYXdhZ3VjaGkKICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLgogKi8KCi8qICAqLwoKLyoqCiAqIGNvbnN0YW50cwogKi8KdmFyIG51bWJlckZvcm1hdEtleXMgPSBbJ2NvbXBhY3REaXNwbGF5JywgJ2N1cnJlbmN5JywgJ2N1cnJlbmN5RGlzcGxheScsICdjdXJyZW5jeVNpZ24nLCAnbG9jYWxlTWF0Y2hlcicsICdub3RhdGlvbicsICdudW1iZXJpbmdTeXN0ZW0nLCAnc2lnbkRpc3BsYXknLCAnc3R5bGUnLCAndW5pdCcsICd1bml0RGlzcGxheScsICd1c2VHcm91cGluZycsICdtaW5pbXVtSW50ZWdlckRpZ2l0cycsICdtaW5pbXVtRnJhY3Rpb25EaWdpdHMnLCAnbWF4aW11bUZyYWN0aW9uRGlnaXRzJywgJ21pbmltdW1TaWduaWZpY2FudERpZ2l0cycsICdtYXhpbXVtU2lnbmlmaWNhbnREaWdpdHMnXTsKLyoqCiAqIHV0aWxpdGllcwogKi8KCmZ1bmN0aW9uIHdhcm4obXNnLCBlcnIpIHsKICBpZiAodHlwZW9mIGNvbnNvbGUgIT09ICd1bmRlZmluZWQnKSB7CiAgICBjb25zb2xlLndhcm4oJ1t2dWUtaTE4bl0gJyArIG1zZyk7CiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KCiAgICBpZiAoZXJyKSB7CiAgICAgIGNvbnNvbGUud2FybihlcnIuc3RhY2spOwogICAgfQogIH0KfQoKZnVuY3Rpb24gZXJyb3IobXNnLCBlcnIpIHsKICBpZiAodHlwZW9mIGNvbnNvbGUgIT09ICd1bmRlZmluZWQnKSB7CiAgICBjb25zb2xlLmVycm9yKCdbdnVlLWkxOG5dICcgKyBtc2cpOwogICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCgogICAgaWYgKGVycikgewogICAgICBjb25zb2xlLmVycm9yKGVyci5zdGFjayk7CiAgICB9CiAgfQp9Cgp2YXIgaXNBcnJheSA9IEFycmF5LmlzQXJyYXk7CgpmdW5jdGlvbiBpc09iamVjdChvYmopIHsKICByZXR1cm4gb2JqICE9PSBudWxsICYmIF90eXBlb2Yob2JqKSA9PT0gJ29iamVjdCc7Cn0KCmZ1bmN0aW9uIGlzQm9vbGVhbih2YWwpIHsKICByZXR1cm4gdHlwZW9mIHZhbCA9PT0gJ2Jvb2xlYW4nOwp9CgpmdW5jdGlvbiBpc1N0cmluZyh2YWwpIHsKICByZXR1cm4gdHlwZW9mIHZhbCA9PT0gJ3N0cmluZyc7Cn0KCnZhciB0b1N0cmluZyA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmc7CnZhciBPQkpFQ1RfU1RSSU5HID0gJ1tvYmplY3QgT2JqZWN0XSc7CgpmdW5jdGlvbiBpc1BsYWluT2JqZWN0KG9iaikgewogIHJldHVybiB0b1N0cmluZy5jYWxsKG9iaikgPT09IE9CSkVDVF9TVFJJTkc7Cn0KCmZ1bmN0aW9uIGlzTnVsbCh2YWwpIHsKICByZXR1cm4gdmFsID09PSBudWxsIHx8IHZhbCA9PT0gdW5kZWZpbmVkOwp9CgpmdW5jdGlvbiBpc0Z1bmN0aW9uKHZhbCkgewogIHJldHVybiB0eXBlb2YgdmFsID09PSAnZnVuY3Rpb24nOwp9CgpmdW5jdGlvbiBwYXJzZUFyZ3MoKSB7CiAgdmFyIGFyZ3MgPSBbXSwKICAgICAgbGVuID0gYXJndW1lbnRzLmxlbmd0aDsKCiAgd2hpbGUgKGxlbi0tKSB7CiAgICBhcmdzW2xlbl0gPSBhcmd1bWVudHNbbGVuXTsKICB9CgogIHZhciBsb2NhbGUgPSBudWxsOwogIHZhciBwYXJhbXMgPSBudWxsOwoKICBpZiAoYXJncy5sZW5ndGggPT09IDEpIHsKICAgIGlmIChpc09iamVjdChhcmdzWzBdKSB8fCBpc0FycmF5KGFyZ3NbMF0pKSB7CiAgICAgIHBhcmFtcyA9IGFyZ3NbMF07CiAgICB9IGVsc2UgaWYgKHR5cGVvZiBhcmdzWzBdID09PSAnc3RyaW5nJykgewogICAgICBsb2NhbGUgPSBhcmdzWzBdOwogICAgfQogIH0gZWxzZSBpZiAoYXJncy5sZW5ndGggPT09IDIpIHsKICAgIGlmICh0eXBlb2YgYXJnc1swXSA9PT0gJ3N0cmluZycpIHsKICAgICAgbG9jYWxlID0gYXJnc1swXTsKICAgIH0KICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwoKCiAgICBpZiAoaXNPYmplY3QoYXJnc1sxXSkgfHwgaXNBcnJheShhcmdzWzFdKSkgewogICAgICBwYXJhbXMgPSBhcmdzWzFdOwogICAgfQogIH0KCiAgcmV0dXJuIHsKICAgIGxvY2FsZTogbG9jYWxlLAogICAgcGFyYW1zOiBwYXJhbXMKICB9Owp9CgpmdW5jdGlvbiBsb29zZUNsb25lKG9iaikgewogIHJldHVybiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KG9iaikpOwp9CgpmdW5jdGlvbiByZW1vdmUoYXJyLCBpdGVtKSB7CiAgaWYgKGFyclsiZGVsZXRlIl0oaXRlbSkpIHsKICAgIHJldHVybiBhcnI7CiAgfQp9CgpmdW5jdGlvbiBpbmNsdWRlcyhhcnIsIGl0ZW0pIHsKICByZXR1cm4gISF+YXJyLmluZGV4T2YoaXRlbSk7Cn0KCnZhciBoYXNPd25Qcm9wZXJ0eSA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk7CgpmdW5jdGlvbiBoYXNPd24ob2JqLCBrZXkpIHsKICByZXR1cm4gaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSk7Cn0KCmZ1bmN0aW9uIG1lcmdlKHRhcmdldCkgewogIHZhciBhcmd1bWVudHMkMSA9IGFyZ3VtZW50czsKICB2YXIgb3V0cHV0ID0gT2JqZWN0KHRhcmdldCk7CgogIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgc291cmNlID0gYXJndW1lbnRzJDFbaV07CgogICAgaWYgKHNvdXJjZSAhPT0gdW5kZWZpbmVkICYmIHNvdXJjZSAhPT0gbnVsbCkgewogICAgICB2YXIga2V5ID0gdm9pZCAwOwoKICAgICAgZm9yIChrZXkgaW4gc291cmNlKSB7CiAgICAgICAgaWYgKGhhc093bihzb3VyY2UsIGtleSkpIHsKICAgICAgICAgIGlmIChpc09iamVjdChzb3VyY2Vba2V5XSkpIHsKICAgICAgICAgICAgb3V0cHV0W2tleV0gPSBtZXJnZShvdXRwdXRba2V5XSwgc291cmNlW2tleV0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgb3V0cHV0W2tleV0gPSBzb3VyY2Vba2V5XTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CgogIHJldHVybiBvdXRwdXQ7Cn0KCmZ1bmN0aW9uIGxvb3NlRXF1YWwoYSwgYikgewogIGlmIChhID09PSBiKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIHZhciBpc09iamVjdEEgPSBpc09iamVjdChhKTsKICB2YXIgaXNPYmplY3RCID0gaXNPYmplY3QoYik7CgogIGlmIChpc09iamVjdEEgJiYgaXNPYmplY3RCKSB7CiAgICB0cnkgewogICAgICB2YXIgaXNBcnJheUEgPSBpc0FycmF5KGEpOwogICAgICB2YXIgaXNBcnJheUIgPSBpc0FycmF5KGIpOwoKICAgICAgaWYgKGlzQXJyYXlBICYmIGlzQXJyYXlCKSB7CiAgICAgICAgcmV0dXJuIGEubGVuZ3RoID09PSBiLmxlbmd0aCAmJiBhLmV2ZXJ5KGZ1bmN0aW9uIChlLCBpKSB7CiAgICAgICAgICByZXR1cm4gbG9vc2VFcXVhbChlLCBiW2ldKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmICghaXNBcnJheUEgJiYgIWlzQXJyYXlCKSB7CiAgICAgICAgdmFyIGtleXNBID0gT2JqZWN0LmtleXMoYSk7CiAgICAgICAgdmFyIGtleXNCID0gT2JqZWN0LmtleXMoYik7CiAgICAgICAgcmV0dXJuIGtleXNBLmxlbmd0aCA9PT0ga2V5c0IubGVuZ3RoICYmIGtleXNBLmV2ZXJ5KGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICAgIHJldHVybiBsb29zZUVxdWFsKGFba2V5XSwgYltrZXldKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfSBjYXRjaCAoZSkgewogICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfSBlbHNlIGlmICghaXNPYmplY3RBICYmICFpc09iamVjdEIpIHsKICAgIHJldHVybiBTdHJpbmcoYSkgPT09IFN0cmluZyhiKTsKICB9IGVsc2UgewogICAgcmV0dXJuIGZhbHNlOwogIH0KfQovKioKICogU2FuaXRpemVzIGh0bWwgc3BlY2lhbCBjaGFyYWN0ZXJzIGZyb20gaW5wdXQgc3RyaW5ncy4gRm9yIG1pdGlnYXRpbmcgcmlzayBvZiBYU1MgYXR0YWNrcy4KICogQHBhcmFtIHJhd1RleHQgVGhlIHJhdyBpbnB1dCBmcm9tIHRoZSB1c2VyIHRoYXQgc2hvdWxkIGJlIGVzY2FwZWQuCiAqLwoKCmZ1bmN0aW9uIGVzY2FwZUh0bWwocmF3VGV4dCkgewogIHJldHVybiByYXdUZXh0LnJlcGxhY2UoLzwvZywgJyZsdDsnKS5yZXBsYWNlKC8+L2csICcmZ3Q7JykucmVwbGFjZSgvIi9nLCAnJnF1b3Q7JykucmVwbGFjZSgvJy9nLCAnJmFwb3M7Jyk7Cn0KLyoqCiAqIEVzY2FwZXMgaHRtbCB0YWdzIGFuZCBzcGVjaWFsIHN5bWJvbHMgZnJvbSBhbGwgcHJvdmlkZWQgcGFyYW1zIHdoaWNoIHdlcmUgcmV0dXJuZWQgZnJvbSBwYXJzZUFyZ3MoKS5wYXJhbXMuCiAqIFRoaXMgbWV0aG9kIHBlcmZvcm1zIGFuIGluLXBsYWNlIG9wZXJhdGlvbiBvbiB0aGUgcGFyYW1zIG9iamVjdC4KICoKICogQHBhcmFtIHthbnl9IHBhcmFtcyBQYXJhbWV0ZXJzIGFzIHByb3ZpZGVkIGZyb20gYHBhcnNlQXJncygpLnBhcmFtc2AuCiAqICAgICAgICAgICAgICAgICAgICAgTWF5IGJlIGVpdGhlciBhbiBhcnJheSBvZiBzdHJpbmdzIG9yIGEgc3RyaW5nLT5hbnkgbWFwLgogKgogKiBAcmV0dXJucyBUaGUgbWFuaXB1bGF0ZWQgYHBhcmFtc2Agb2JqZWN0LgogKi8KCgpmdW5jdGlvbiBlc2NhcGVQYXJhbXMocGFyYW1zKSB7CiAgaWYgKHBhcmFtcyAhPSBudWxsKSB7CiAgICBPYmplY3Qua2V5cyhwYXJhbXMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICBpZiAodHlwZW9mIHBhcmFtc1trZXldID09ICdzdHJpbmcnKSB7CiAgICAgICAgcGFyYW1zW2tleV0gPSBlc2NhcGVIdG1sKHBhcmFtc1trZXldKTsKICAgICAgfQogICAgfSk7CiAgfQoKICByZXR1cm4gcGFyYW1zOwp9Ci8qICAqLwoKCmZ1bmN0aW9uIGV4dGVuZChWdWUpIHsKICBpZiAoIVZ1ZS5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkoJyRpMThuJykpIHsKICAgIC8vICRGbG93Rml4TWUKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShWdWUucHJvdG90eXBlLCAnJGkxOG4nLCB7CiAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgIHJldHVybiB0aGlzLl9pMThuOwogICAgICB9CiAgICB9KTsKICB9CgogIFZ1ZS5wcm90b3R5cGUuJHQgPSBmdW5jdGlvbiAoa2V5KSB7CiAgICB2YXIgdmFsdWVzID0gW10sCiAgICAgICAgbGVuID0gYXJndW1lbnRzLmxlbmd0aCAtIDE7CgogICAgd2hpbGUgKGxlbi0tID4gMCkgewogICAgICB2YWx1ZXNbbGVuXSA9IGFyZ3VtZW50c1tsZW4gKyAxXTsKICAgIH0KCiAgICB2YXIgaTE4biA9IHRoaXMuJGkxOG47CiAgICByZXR1cm4gaTE4bi5fdC5hcHBseShpMThuLCBba2V5LCBpMThuLmxvY2FsZSwgaTE4bi5fZ2V0TWVzc2FnZXMoKSwgdGhpc10uY29uY2F0KHZhbHVlcykpOwogIH07CgogIFZ1ZS5wcm90b3R5cGUuJHRjID0gZnVuY3Rpb24gKGtleSwgY2hvaWNlKSB7CiAgICB2YXIgdmFsdWVzID0gW10sCiAgICAgICAgbGVuID0gYXJndW1lbnRzLmxlbmd0aCAtIDI7CgogICAgd2hpbGUgKGxlbi0tID4gMCkgewogICAgICB2YWx1ZXNbbGVuXSA9IGFyZ3VtZW50c1tsZW4gKyAyXTsKICAgIH0KCiAgICB2YXIgaTE4biA9IHRoaXMuJGkxOG47CiAgICByZXR1cm4gaTE4bi5fdGMuYXBwbHkoaTE4biwgW2tleSwgaTE4bi5sb2NhbGUsIGkxOG4uX2dldE1lc3NhZ2VzKCksIHRoaXMsIGNob2ljZV0uY29uY2F0KHZhbHVlcykpOwogIH07CgogIFZ1ZS5wcm90b3R5cGUuJHRlID0gZnVuY3Rpb24gKGtleSwgbG9jYWxlKSB7CiAgICB2YXIgaTE4biA9IHRoaXMuJGkxOG47CiAgICByZXR1cm4gaTE4bi5fdGUoa2V5LCBpMThuLmxvY2FsZSwgaTE4bi5fZ2V0TWVzc2FnZXMoKSwgbG9jYWxlKTsKICB9OwoKICBWdWUucHJvdG90eXBlLiRkID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgICB2YXIgcmVmOwogICAgdmFyIGFyZ3MgPSBbXSwKICAgICAgICBsZW4gPSBhcmd1bWVudHMubGVuZ3RoIC0gMTsKCiAgICB3aGlsZSAobGVuLS0gPiAwKSB7CiAgICAgIGFyZ3NbbGVuXSA9IGFyZ3VtZW50c1tsZW4gKyAxXTsKICAgIH0KCiAgICByZXR1cm4gKHJlZiA9IHRoaXMuJGkxOG4pLmQuYXBwbHkocmVmLCBbdmFsdWVdLmNvbmNhdChhcmdzKSk7CiAgfTsKCiAgVnVlLnByb3RvdHlwZS4kbiA9IGZ1bmN0aW9uICh2YWx1ZSkgewogICAgdmFyIHJlZjsKICAgIHZhciBhcmdzID0gW10sCiAgICAgICAgbGVuID0gYXJndW1lbnRzLmxlbmd0aCAtIDE7CgogICAgd2hpbGUgKGxlbi0tID4gMCkgewogICAgICBhcmdzW2xlbl0gPSBhcmd1bWVudHNbbGVuICsgMV07CiAgICB9CgogICAgcmV0dXJuIChyZWYgPSB0aGlzLiRpMThuKS5uLmFwcGx5KHJlZiwgW3ZhbHVlXS5jb25jYXQoYXJncykpOwogIH07Cn0KLyogICovCgoKdmFyIG1peGluID0gewogIGJlZm9yZUNyZWF0ZTogZnVuY3Rpb24gYmVmb3JlQ3JlYXRlKCkgewogICAgdmFyIG9wdGlvbnMgPSB0aGlzLiRvcHRpb25zOwogICAgb3B0aW9ucy5pMThuID0gb3B0aW9ucy5pMThuIHx8IChvcHRpb25zLl9faTE4biA/IHt9IDogbnVsbCk7CgogICAgaWYgKG9wdGlvbnMuaTE4bikgewogICAgICBpZiAob3B0aW9ucy5pMThuIGluc3RhbmNlb2YgVnVlSTE4bikgewogICAgICAgIC8vIGluaXQgbG9jYWxlIG1lc3NhZ2VzIHZpYSBjdXN0b20gYmxvY2tzCiAgICAgICAgaWYgKG9wdGlvbnMuX19pMThuKSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICB2YXIgbG9jYWxlTWVzc2FnZXMgPSBvcHRpb25zLmkxOG4gJiYgb3B0aW9ucy5pMThuLm1lc3NhZ2VzID8gb3B0aW9ucy5pMThuLm1lc3NhZ2VzIDoge307CgogICAgICAgICAgICBvcHRpb25zLl9faTE4bi5mb3JFYWNoKGZ1bmN0aW9uIChyZXNvdXJjZSkgewogICAgICAgICAgICAgIGxvY2FsZU1lc3NhZ2VzID0gbWVyZ2UobG9jYWxlTWVzc2FnZXMsIEpTT04ucGFyc2UocmVzb3VyY2UpKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBPYmplY3Qua2V5cyhsb2NhbGVNZXNzYWdlcykuZm9yRWFjaChmdW5jdGlvbiAobG9jYWxlKSB7CiAgICAgICAgICAgICAgb3B0aW9ucy5pMThuLm1lcmdlTG9jYWxlTWVzc2FnZShsb2NhbGUsIGxvY2FsZU1lc3NhZ2VzW2xvY2FsZV0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHsKICAgICAgICAgICAgICBlcnJvcigiQ2Fubm90IHBhcnNlIGxvY2FsZSBtZXNzYWdlcyB2aWEgY3VzdG9tIGJsb2Nrcy4iLCBlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdGhpcy5faTE4biA9IG9wdGlvbnMuaTE4bjsKICAgICAgICB0aGlzLl9pMThuV2F0Y2hlciA9IHRoaXMuX2kxOG4ud2F0Y2hJMThuRGF0YSgpOwogICAgICB9IGVsc2UgaWYgKGlzUGxhaW5PYmplY3Qob3B0aW9ucy5pMThuKSkgewogICAgICAgIHZhciByb290STE4biA9IHRoaXMuJHJvb3QgJiYgdGhpcy4kcm9vdC4kaTE4biAmJiB0aGlzLiRyb290LiRpMThuIGluc3RhbmNlb2YgVnVlSTE4biA/IHRoaXMuJHJvb3QuJGkxOG4gOiBudWxsOyAvLyBjb21wb25lbnQgbG9jYWwgaTE4bgoKICAgICAgICBpZiAocm9vdEkxOG4pIHsKICAgICAgICAgIG9wdGlvbnMuaTE4bi5yb290ID0gdGhpcy4kcm9vdDsKICAgICAgICAgIG9wdGlvbnMuaTE4bi5mb3JtYXR0ZXIgPSByb290STE4bi5mb3JtYXR0ZXI7CiAgICAgICAgICBvcHRpb25zLmkxOG4uZmFsbGJhY2tMb2NhbGUgPSByb290STE4bi5mYWxsYmFja0xvY2FsZTsKICAgICAgICAgIG9wdGlvbnMuaTE4bi5mb3JtYXRGYWxsYmFja01lc3NhZ2VzID0gcm9vdEkxOG4uZm9ybWF0RmFsbGJhY2tNZXNzYWdlczsKICAgICAgICAgIG9wdGlvbnMuaTE4bi5zaWxlbnRUcmFuc2xhdGlvbldhcm4gPSByb290STE4bi5zaWxlbnRUcmFuc2xhdGlvbldhcm47CiAgICAgICAgICBvcHRpb25zLmkxOG4uc2lsZW50RmFsbGJhY2tXYXJuID0gcm9vdEkxOG4uc2lsZW50RmFsbGJhY2tXYXJuOwogICAgICAgICAgb3B0aW9ucy5pMThuLnBsdXJhbGl6YXRpb25SdWxlcyA9IHJvb3RJMThuLnBsdXJhbGl6YXRpb25SdWxlczsKICAgICAgICAgIG9wdGlvbnMuaTE4bi5wcmVzZXJ2ZURpcmVjdGl2ZUNvbnRlbnQgPSByb290STE4bi5wcmVzZXJ2ZURpcmVjdGl2ZUNvbnRlbnQ7CiAgICAgICAgfSAvLyBpbml0IGxvY2FsZSBtZXNzYWdlcyB2aWEgY3VzdG9tIGJsb2NrcwoKCiAgICAgICAgaWYgKG9wdGlvbnMuX19pMThuKSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICB2YXIgbG9jYWxlTWVzc2FnZXMkMSA9IG9wdGlvbnMuaTE4biAmJiBvcHRpb25zLmkxOG4ubWVzc2FnZXMgPyBvcHRpb25zLmkxOG4ubWVzc2FnZXMgOiB7fTsKCiAgICAgICAgICAgIG9wdGlvbnMuX19pMThuLmZvckVhY2goZnVuY3Rpb24gKHJlc291cmNlKSB7CiAgICAgICAgICAgICAgbG9jYWxlTWVzc2FnZXMkMSA9IG1lcmdlKGxvY2FsZU1lc3NhZ2VzJDEsIEpTT04ucGFyc2UocmVzb3VyY2UpKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBvcHRpb25zLmkxOG4ubWVzc2FnZXMgPSBsb2NhbGVNZXNzYWdlcyQxOwogICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgewogICAgICAgICAgICAgIHdhcm4oIkNhbm5vdCBwYXJzZSBsb2NhbGUgbWVzc2FnZXMgdmlhIGN1c3RvbSBibG9ja3MuIiwgZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHZhciByZWYgPSBvcHRpb25zLmkxOG47CiAgICAgICAgdmFyIHNoYXJlZE1lc3NhZ2VzID0gcmVmLnNoYXJlZE1lc3NhZ2VzOwoKICAgICAgICBpZiAoc2hhcmVkTWVzc2FnZXMgJiYgaXNQbGFpbk9iamVjdChzaGFyZWRNZXNzYWdlcykpIHsKICAgICAgICAgIG9wdGlvbnMuaTE4bi5tZXNzYWdlcyA9IG1lcmdlKG9wdGlvbnMuaTE4bi5tZXNzYWdlcywgc2hhcmVkTWVzc2FnZXMpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5faTE4biA9IG5ldyBWdWVJMThuKG9wdGlvbnMuaTE4bik7CiAgICAgICAgdGhpcy5faTE4bldhdGNoZXIgPSB0aGlzLl9pMThuLndhdGNoSTE4bkRhdGEoKTsKCiAgICAgICAgaWYgKG9wdGlvbnMuaTE4bi5zeW5jID09PSB1bmRlZmluZWQgfHwgISFvcHRpb25zLmkxOG4uc3luYykgewogICAgICAgICAgdGhpcy5fbG9jYWxlV2F0Y2hlciA9IHRoaXMuJGkxOG4ud2F0Y2hMb2NhbGUoKTsKICAgICAgICB9CgogICAgICAgIGlmIChyb290STE4bikgewogICAgICAgICAgcm9vdEkxOG4ub25Db21wb25lbnRJbnN0YW5jZUNyZWF0ZWQodGhpcy5faTE4bik7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICAgICAgICB3YXJuKCJDYW5ub3QgYmUgaW50ZXJwcmV0ZWQgJ2kxOG4nIG9wdGlvbi4iKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSBpZiAodGhpcy4kcm9vdCAmJiB0aGlzLiRyb290LiRpMThuICYmIHRoaXMuJHJvb3QuJGkxOG4gaW5zdGFuY2VvZiBWdWVJMThuKSB7CiAgICAgIC8vIHJvb3QgaTE4bgogICAgICB0aGlzLl9pMThuID0gdGhpcy4kcm9vdC4kaTE4bjsKICAgIH0gZWxzZSBpZiAob3B0aW9ucy5wYXJlbnQgJiYgb3B0aW9ucy5wYXJlbnQuJGkxOG4gJiYgb3B0aW9ucy5wYXJlbnQuJGkxOG4gaW5zdGFuY2VvZiBWdWVJMThuKSB7CiAgICAgIC8vIHBhcmVudCBpMThuCiAgICAgIHRoaXMuX2kxOG4gPSBvcHRpb25zLnBhcmVudC4kaTE4bjsKICAgIH0KICB9LAogIGJlZm9yZU1vdW50OiBmdW5jdGlvbiBiZWZvcmVNb3VudCgpIHsKICAgIHZhciBvcHRpb25zID0gdGhpcy4kb3B0aW9uczsKICAgIG9wdGlvbnMuaTE4biA9IG9wdGlvbnMuaTE4biB8fCAob3B0aW9ucy5fX2kxOG4gPyB7fSA6IG51bGwpOwoKICAgIGlmIChvcHRpb25zLmkxOG4pIHsKICAgICAgaWYgKG9wdGlvbnMuaTE4biBpbnN0YW5jZW9mIFZ1ZUkxOG4pIHsKICAgICAgICAvLyBpbml0IGxvY2FsZSBtZXNzYWdlcyB2aWEgY3VzdG9tIGJsb2NrcwogICAgICAgIHRoaXMuX2kxOG4uc3Vic2NyaWJlRGF0YUNoYW5naW5nKHRoaXMpOwoKICAgICAgICB0aGlzLl9zdWJzY3JpYmluZyA9IHRydWU7CiAgICAgIH0gZWxzZSBpZiAoaXNQbGFpbk9iamVjdChvcHRpb25zLmkxOG4pKSB7CiAgICAgICAgdGhpcy5faTE4bi5zdWJzY3JpYmVEYXRhQ2hhbmdpbmcodGhpcyk7CgogICAgICAgIHRoaXMuX3N1YnNjcmliaW5nID0gdHJ1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgewogICAgICAgICAgd2FybigiQ2Fubm90IGJlIGludGVycHJldGVkICdpMThuJyBvcHRpb24uIik7CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgaWYgKHRoaXMuJHJvb3QgJiYgdGhpcy4kcm9vdC4kaTE4biAmJiB0aGlzLiRyb290LiRpMThuIGluc3RhbmNlb2YgVnVlSTE4bikgewogICAgICB0aGlzLl9pMThuLnN1YnNjcmliZURhdGFDaGFuZ2luZyh0aGlzKTsKCiAgICAgIHRoaXMuX3N1YnNjcmliaW5nID0gdHJ1ZTsKICAgIH0gZWxzZSBpZiAob3B0aW9ucy5wYXJlbnQgJiYgb3B0aW9ucy5wYXJlbnQuJGkxOG4gJiYgb3B0aW9ucy5wYXJlbnQuJGkxOG4gaW5zdGFuY2VvZiBWdWVJMThuKSB7CiAgICAgIHRoaXMuX2kxOG4uc3Vic2NyaWJlRGF0YUNoYW5naW5nKHRoaXMpOwoKICAgICAgdGhpcy5fc3Vic2NyaWJpbmcgPSB0cnVlOwogICAgfQogIH0sCiAgbW91bnRlZDogZnVuY3Rpb24gbW91bnRlZCgpIHsKICAgIGlmICh0aGlzICE9PSB0aGlzLiRyb290ICYmIHRoaXMuJG9wdGlvbnMuX19JTlRMSUZZX01FVEFfXyAmJiB0aGlzLiRlbCkgewogICAgICB0aGlzLiRlbC5zZXRBdHRyaWJ1dGUoJ2RhdGEtaW50bGlmeScsIHRoaXMuJG9wdGlvbnMuX19JTlRMSUZZX01FVEFfXyk7CiAgICB9CiAgfSwKICBiZWZvcmVEZXN0cm95OiBmdW5jdGlvbiBiZWZvcmVEZXN0cm95KCkgewogICAgaWYgKCF0aGlzLl9pMThuKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICB0aGlzLiRuZXh0VGljayhmdW5jdGlvbiAoKSB7CiAgICAgIGlmIChzZWxmLl9zdWJzY3JpYmluZykgewogICAgICAgIHNlbGYuX2kxOG4udW5zdWJzY3JpYmVEYXRhQ2hhbmdpbmcoc2VsZik7CgogICAgICAgIGRlbGV0ZSBzZWxmLl9zdWJzY3JpYmluZzsKICAgICAgfQoKICAgICAgaWYgKHNlbGYuX2kxOG5XYXRjaGVyKSB7CiAgICAgICAgc2VsZi5faTE4bldhdGNoZXIoKTsKCiAgICAgICAgc2VsZi5faTE4bi5kZXN0cm95Vk0oKTsKCiAgICAgICAgZGVsZXRlIHNlbGYuX2kxOG5XYXRjaGVyOwogICAgICB9CgogICAgICBpZiAoc2VsZi5fbG9jYWxlV2F0Y2hlcikgewogICAgICAgIHNlbGYuX2xvY2FsZVdhdGNoZXIoKTsKCiAgICAgICAgZGVsZXRlIHNlbGYuX2xvY2FsZVdhdGNoZXI7CiAgICAgIH0KICAgIH0pOwogIH0KfTsKLyogICovCgp2YXIgaW50ZXJwb2xhdGlvbkNvbXBvbmVudCA9IHsKICBuYW1lOiAnaTE4bicsCiAgZnVuY3Rpb25hbDogdHJ1ZSwKICBwcm9wczogewogICAgdGFnOiB7CiAgICAgIHR5cGU6IFtTdHJpbmcsIEJvb2xlYW4sIE9iamVjdF0sCiAgICAgICJkZWZhdWx0IjogJ3NwYW4nCiAgICB9LAogICAgcGF0aDogewogICAgICB0eXBlOiBTdHJpbmcsCiAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICB9LAogICAgbG9jYWxlOiB7CiAgICAgIHR5cGU6IFN0cmluZwogICAgfSwKICAgIHBsYWNlczogewogICAgICB0eXBlOiBbQXJyYXksIE9iamVjdF0KICAgIH0KICB9LAogIHJlbmRlcjogZnVuY3Rpb24gcmVuZGVyKGgsIHJlZikgewogICAgdmFyIGRhdGEgPSByZWYuZGF0YTsKICAgIHZhciBwYXJlbnQgPSByZWYucGFyZW50OwogICAgdmFyIHByb3BzID0gcmVmLnByb3BzOwogICAgdmFyIHNsb3RzID0gcmVmLnNsb3RzOwogICAgdmFyICRpMThuID0gcGFyZW50LiRpMThuOwoKICAgIGlmICghJGkxOG4pIHsKICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHsKICAgICAgICB3YXJuKCdDYW5ub3QgZmluZCBWdWVJMThuIGluc3RhbmNlIScpOwogICAgICB9CgogICAgICByZXR1cm47CiAgICB9CgogICAgdmFyIHBhdGggPSBwcm9wcy5wYXRoOwogICAgdmFyIGxvY2FsZSA9IHByb3BzLmxvY2FsZTsKICAgIHZhciBwbGFjZXMgPSBwcm9wcy5wbGFjZXM7CiAgICB2YXIgcGFyYW1zID0gc2xvdHMoKTsKICAgIHZhciBjaGlsZHJlbiA9ICRpMThuLmkocGF0aCwgbG9jYWxlLCBvbmx5SGFzRGVmYXVsdFBsYWNlKHBhcmFtcykgfHwgcGxhY2VzID8gdXNlTGVnYWN5UGxhY2VzKHBhcmFtc1siZGVmYXVsdCJdLCBwbGFjZXMpIDogcGFyYW1zKTsKICAgIHZhciB0YWcgPSAhIXByb3BzLnRhZyAmJiBwcm9wcy50YWcgIT09IHRydWUgfHwgcHJvcHMudGFnID09PSBmYWxzZSA/IHByb3BzLnRhZyA6ICdzcGFuJzsKICAgIHJldHVybiB0YWcgPyBoKHRhZywgZGF0YSwgY2hpbGRyZW4pIDogY2hpbGRyZW47CiAgfQp9OwoKZnVuY3Rpb24gb25seUhhc0RlZmF1bHRQbGFjZShwYXJhbXMpIHsKICB2YXIgcHJvcDsKCiAgZm9yIChwcm9wIGluIHBhcmFtcykgewogICAgaWYgKHByb3AgIT09ICdkZWZhdWx0JykgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfQoKICByZXR1cm4gQm9vbGVhbihwcm9wKTsKfQoKZnVuY3Rpb24gdXNlTGVnYWN5UGxhY2VzKGNoaWxkcmVuLCBwbGFjZXMpIHsKICB2YXIgcGFyYW1zID0gcGxhY2VzID8gY3JlYXRlUGFyYW1zRnJvbVBsYWNlcyhwbGFjZXMpIDoge307CgogIGlmICghY2hpbGRyZW4pIHsKICAgIHJldHVybiBwYXJhbXM7CiAgfSAvLyBGaWx0ZXIgZW1wdHkgdGV4dCBub2RlcwoKCiAgY2hpbGRyZW4gPSBjaGlsZHJlbi5maWx0ZXIoZnVuY3Rpb24gKGNoaWxkKSB7CiAgICByZXR1cm4gY2hpbGQudGFnIHx8IGNoaWxkLnRleHQudHJpbSgpICE9PSAnJzsKICB9KTsKICB2YXIgZXZlcnlQbGFjZSA9IGNoaWxkcmVuLmV2ZXJ5KHZub2RlSGFzUGxhY2VBdHRyaWJ1dGUpOwoKICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJyAmJiBldmVyeVBsYWNlKSB7CiAgICB3YXJuKCdgcGxhY2VgIGF0dHJpYnV0ZSBpcyBkZXByZWNhdGVkIGluIG5leHQgbWFqb3IgdmVyc2lvbi4gUGxlYXNlIHN3aXRjaCB0byBWdWUgc2xvdHMuJyk7CiAgfQoKICByZXR1cm4gY2hpbGRyZW4ucmVkdWNlKGV2ZXJ5UGxhY2UgPyBhc3NpZ25DaGlsZFBsYWNlIDogYXNzaWduQ2hpbGRJbmRleCwgcGFyYW1zKTsKfQoKZnVuY3Rpb24gY3JlYXRlUGFyYW1zRnJvbVBsYWNlcyhwbGFjZXMpIHsKICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgewogICAgd2FybignYHBsYWNlc2AgcHJvcCBpcyBkZXByZWNhdGVkIGluIG5leHQgbWFqb3IgdmVyc2lvbi4gUGxlYXNlIHN3aXRjaCB0byBWdWUgc2xvdHMuJyk7CiAgfQoKICByZXR1cm4gQXJyYXkuaXNBcnJheShwbGFjZXMpID8gcGxhY2VzLnJlZHVjZShhc3NpZ25DaGlsZEluZGV4LCB7fSkgOiBPYmplY3QuYXNzaWduKHt9LCBwbGFjZXMpOwp9CgpmdW5jdGlvbiBhc3NpZ25DaGlsZFBsYWNlKHBhcmFtcywgY2hpbGQpIHsKICBpZiAoY2hpbGQuZGF0YSAmJiBjaGlsZC5kYXRhLmF0dHJzICYmIGNoaWxkLmRhdGEuYXR0cnMucGxhY2UpIHsKICAgIHBhcmFtc1tjaGlsZC5kYXRhLmF0dHJzLnBsYWNlXSA9IGNoaWxkOwogIH0KCiAgcmV0dXJuIHBhcmFtczsKfQoKZnVuY3Rpb24gYXNzaWduQ2hpbGRJbmRleChwYXJhbXMsIGNoaWxkLCBpbmRleCkgewogIHBhcmFtc1tpbmRleF0gPSBjaGlsZDsKICByZXR1cm4gcGFyYW1zOwp9CgpmdW5jdGlvbiB2bm9kZUhhc1BsYWNlQXR0cmlidXRlKHZub2RlKSB7CiAgcmV0dXJuIEJvb2xlYW4odm5vZGUuZGF0YSAmJiB2bm9kZS5kYXRhLmF0dHJzICYmIHZub2RlLmRhdGEuYXR0cnMucGxhY2UpOwp9Ci8qICAqLwoKCnZhciBudW1iZXJDb21wb25lbnQgPSB7CiAgbmFtZTogJ2kxOG4tbicsCiAgZnVuY3Rpb25hbDogdHJ1ZSwKICBwcm9wczogewogICAgdGFnOiB7CiAgICAgIHR5cGU6IFtTdHJpbmcsIEJvb2xlYW4sIE9iamVjdF0sCiAgICAgICJkZWZhdWx0IjogJ3NwYW4nCiAgICB9LAogICAgdmFsdWU6IHsKICAgICAgdHlwZTogTnVtYmVyLAogICAgICByZXF1aXJlZDogdHJ1ZQogICAgfSwKICAgIGZvcm1hdDogewogICAgICB0eXBlOiBbU3RyaW5nLCBPYmplY3RdCiAgICB9LAogICAgbG9jYWxlOiB7CiAgICAgIHR5cGU6IFN0cmluZwogICAgfQogIH0sCiAgcmVuZGVyOiBmdW5jdGlvbiByZW5kZXIoaCwgcmVmKSB7CiAgICB2YXIgcHJvcHMgPSByZWYucHJvcHM7CiAgICB2YXIgcGFyZW50ID0gcmVmLnBhcmVudDsKICAgIHZhciBkYXRhID0gcmVmLmRhdGE7CiAgICB2YXIgaTE4biA9IHBhcmVudC4kaTE4bjsKCiAgICBpZiAoIWkxOG4pIHsKICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHsKICAgICAgICB3YXJuKCdDYW5ub3QgZmluZCBWdWVJMThuIGluc3RhbmNlIScpOwogICAgICB9CgogICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICB2YXIga2V5ID0gbnVsbDsKICAgIHZhciBvcHRpb25zID0gbnVsbDsKCiAgICBpZiAoaXNTdHJpbmcocHJvcHMuZm9ybWF0KSkgewogICAgICBrZXkgPSBwcm9wcy5mb3JtYXQ7CiAgICB9IGVsc2UgaWYgKGlzT2JqZWN0KHByb3BzLmZvcm1hdCkpIHsKICAgICAgaWYgKHByb3BzLmZvcm1hdC5rZXkpIHsKICAgICAgICBrZXkgPSBwcm9wcy5mb3JtYXQua2V5OwogICAgICB9IC8vIEZpbHRlciBvdXQgbnVtYmVyIGZvcm1hdCBvcHRpb25zIG9ubHkKCgogICAgICBvcHRpb25zID0gT2JqZWN0LmtleXMocHJvcHMuZm9ybWF0KS5yZWR1Y2UoZnVuY3Rpb24gKGFjYywgcHJvcCkgewogICAgICAgIHZhciBvYmo7CgogICAgICAgIGlmIChpbmNsdWRlcyhudW1iZXJGb3JtYXRLZXlzLCBwcm9wKSkgewogICAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oe30sIGFjYywgKG9iaiA9IHt9LCBvYmpbcHJvcF0gPSBwcm9wcy5mb3JtYXRbcHJvcF0sIG9iaikpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGFjYzsKICAgICAgfSwgbnVsbCk7CiAgICB9CgogICAgdmFyIGxvY2FsZSA9IHByb3BzLmxvY2FsZSB8fCBpMThuLmxvY2FsZTsKCiAgICB2YXIgcGFydHMgPSBpMThuLl9udHAocHJvcHMudmFsdWUsIGxvY2FsZSwga2V5LCBvcHRpb25zKTsKCiAgICB2YXIgdmFsdWVzID0gcGFydHMubWFwKGZ1bmN0aW9uIChwYXJ0LCBpbmRleCkgewogICAgICB2YXIgb2JqOwogICAgICB2YXIgc2xvdCA9IGRhdGEuc2NvcGVkU2xvdHMgJiYgZGF0YS5zY29wZWRTbG90c1twYXJ0LnR5cGVdOwogICAgICByZXR1cm4gc2xvdCA/IHNsb3QoKG9iaiA9IHt9LCBvYmpbcGFydC50eXBlXSA9IHBhcnQudmFsdWUsIG9iai5pbmRleCA9IGluZGV4LCBvYmoucGFydHMgPSBwYXJ0cywgb2JqKSkgOiBwYXJ0LnZhbHVlOwogICAgfSk7CiAgICB2YXIgdGFnID0gISFwcm9wcy50YWcgJiYgcHJvcHMudGFnICE9PSB0cnVlIHx8IHByb3BzLnRhZyA9PT0gZmFsc2UgPyBwcm9wcy50YWcgOiAnc3Bhbic7CiAgICByZXR1cm4gdGFnID8gaCh0YWcsIHsKICAgICAgYXR0cnM6IGRhdGEuYXR0cnMsCiAgICAgICdjbGFzcyc6IGRhdGFbJ2NsYXNzJ10sCiAgICAgIHN0YXRpY0NsYXNzOiBkYXRhLnN0YXRpY0NsYXNzCiAgICB9LCB2YWx1ZXMpIDogdmFsdWVzOwogIH0KfTsKLyogICovCgpmdW5jdGlvbiBiaW5kKGVsLCBiaW5kaW5nLCB2bm9kZSkgewogIGlmICghYXNzZXJ0KGVsLCB2bm9kZSkpIHsKICAgIHJldHVybjsKICB9CgogIHQoZWwsIGJpbmRpbmcsIHZub2RlKTsKfQoKZnVuY3Rpb24gdXBkYXRlKGVsLCBiaW5kaW5nLCB2bm9kZSwgb2xkVk5vZGUpIHsKICBpZiAoIWFzc2VydChlbCwgdm5vZGUpKSB7CiAgICByZXR1cm47CiAgfQoKICB2YXIgaTE4biA9IHZub2RlLmNvbnRleHQuJGkxOG47CgogIGlmIChsb2NhbGVFcXVhbChlbCwgdm5vZGUpICYmIGxvb3NlRXF1YWwoYmluZGluZy52YWx1ZSwgYmluZGluZy5vbGRWYWx1ZSkgJiYgbG9vc2VFcXVhbChlbC5fbG9jYWxlTWVzc2FnZSwgaTE4bi5nZXRMb2NhbGVNZXNzYWdlKGkxOG4ubG9jYWxlKSkpIHsKICAgIHJldHVybjsKICB9CgogIHQoZWwsIGJpbmRpbmcsIHZub2RlKTsKfQoKZnVuY3Rpb24gdW5iaW5kKGVsLCBiaW5kaW5nLCB2bm9kZSwgb2xkVk5vZGUpIHsKICB2YXIgdm0gPSB2bm9kZS5jb250ZXh0OwoKICBpZiAoIXZtKSB7CiAgICB3YXJuKCdWdWUgaW5zdGFuY2UgZG9lcyBub3QgZXhpc3RzIGluIFZOb2RlIGNvbnRleHQnKTsKICAgIHJldHVybjsKICB9CgogIHZhciBpMThuID0gdm5vZGUuY29udGV4dC4kaTE4biB8fCB7fTsKCiAgaWYgKCFiaW5kaW5nLm1vZGlmaWVycy5wcmVzZXJ2ZSAmJiAhaTE4bi5wcmVzZXJ2ZURpcmVjdGl2ZUNvbnRlbnQpIHsKICAgIGVsLnRleHRDb250ZW50ID0gJyc7CiAgfQoKICBlbC5fdnQgPSB1bmRlZmluZWQ7CiAgZGVsZXRlIGVsWydfdnQnXTsKICBlbC5fbG9jYWxlID0gdW5kZWZpbmVkOwogIGRlbGV0ZSBlbFsnX2xvY2FsZSddOwogIGVsLl9sb2NhbGVNZXNzYWdlID0gdW5kZWZpbmVkOwogIGRlbGV0ZSBlbFsnX2xvY2FsZU1lc3NhZ2UnXTsKfQoKZnVuY3Rpb24gYXNzZXJ0KGVsLCB2bm9kZSkgewogIHZhciB2bSA9IHZub2RlLmNvbnRleHQ7CgogIGlmICghdm0pIHsKICAgIHdhcm4oJ1Z1ZSBpbnN0YW5jZSBkb2VzIG5vdCBleGlzdHMgaW4gVk5vZGUgY29udGV4dCcpOwogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgaWYgKCF2bS4kaTE4bikgewogICAgd2FybignVnVlSTE4biBpbnN0YW5jZSBkb2VzIG5vdCBleGlzdHMgaW4gVnVlIGluc3RhbmNlJyk7CiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICByZXR1cm4gdHJ1ZTsKfQoKZnVuY3Rpb24gbG9jYWxlRXF1YWwoZWwsIHZub2RlKSB7CiAgdmFyIHZtID0gdm5vZGUuY29udGV4dDsKICByZXR1cm4gZWwuX2xvY2FsZSA9PT0gdm0uJGkxOG4ubG9jYWxlOwp9CgpmdW5jdGlvbiB0KGVsLCBiaW5kaW5nLCB2bm9kZSkgewogIHZhciByZWYkMSwgcmVmJDI7CiAgdmFyIHZhbHVlID0gYmluZGluZy52YWx1ZTsKICB2YXIgcmVmID0gcGFyc2VWYWx1ZSh2YWx1ZSk7CiAgdmFyIHBhdGggPSByZWYucGF0aDsKICB2YXIgbG9jYWxlID0gcmVmLmxvY2FsZTsKICB2YXIgYXJncyA9IHJlZi5hcmdzOwogIHZhciBjaG9pY2UgPSByZWYuY2hvaWNlOwoKICBpZiAoIXBhdGggJiYgIWxvY2FsZSAmJiAhYXJncykgewogICAgd2FybigndmFsdWUgdHlwZSBub3Qgc3VwcG9ydGVkJyk7CiAgICByZXR1cm47CiAgfQoKICBpZiAoIXBhdGgpIHsKICAgIHdhcm4oJ2BwYXRoYCBpcyByZXF1aXJlZCBpbiB2LXQgZGlyZWN0aXZlJyk7CiAgICByZXR1cm47CiAgfQoKICB2YXIgdm0gPSB2bm9kZS5jb250ZXh0OwoKICBpZiAoY2hvaWNlICE9IG51bGwpIHsKICAgIGVsLl92dCA9IGVsLnRleHRDb250ZW50ID0gKHJlZiQxID0gdm0uJGkxOG4pLnRjLmFwcGx5KHJlZiQxLCBbcGF0aCwgY2hvaWNlXS5jb25jYXQobWFrZVBhcmFtcyhsb2NhbGUsIGFyZ3MpKSk7CiAgfSBlbHNlIHsKICAgIGVsLl92dCA9IGVsLnRleHRDb250ZW50ID0gKHJlZiQyID0gdm0uJGkxOG4pLnQuYXBwbHkocmVmJDIsIFtwYXRoXS5jb25jYXQobWFrZVBhcmFtcyhsb2NhbGUsIGFyZ3MpKSk7CiAgfQoKICBlbC5fbG9jYWxlID0gdm0uJGkxOG4ubG9jYWxlOwogIGVsLl9sb2NhbGVNZXNzYWdlID0gdm0uJGkxOG4uZ2V0TG9jYWxlTWVzc2FnZSh2bS4kaTE4bi5sb2NhbGUpOwp9CgpmdW5jdGlvbiBwYXJzZVZhbHVlKHZhbHVlKSB7CiAgdmFyIHBhdGg7CiAgdmFyIGxvY2FsZTsKICB2YXIgYXJnczsKICB2YXIgY2hvaWNlOwoKICBpZiAoaXNTdHJpbmcodmFsdWUpKSB7CiAgICBwYXRoID0gdmFsdWU7CiAgfSBlbHNlIGlmIChpc1BsYWluT2JqZWN0KHZhbHVlKSkgewogICAgcGF0aCA9IHZhbHVlLnBhdGg7CiAgICBsb2NhbGUgPSB2YWx1ZS5sb2NhbGU7CiAgICBhcmdzID0gdmFsdWUuYXJnczsKICAgIGNob2ljZSA9IHZhbHVlLmNob2ljZTsKICB9CgogIHJldHVybiB7CiAgICBwYXRoOiBwYXRoLAogICAgbG9jYWxlOiBsb2NhbGUsCiAgICBhcmdzOiBhcmdzLAogICAgY2hvaWNlOiBjaG9pY2UKICB9Owp9CgpmdW5jdGlvbiBtYWtlUGFyYW1zKGxvY2FsZSwgYXJncykgewogIHZhciBwYXJhbXMgPSBbXTsKICBsb2NhbGUgJiYgcGFyYW1zLnB1c2gobG9jYWxlKTsKCiAgaWYgKGFyZ3MgJiYgKEFycmF5LmlzQXJyYXkoYXJncykgfHwgaXNQbGFpbk9iamVjdChhcmdzKSkpIHsKICAgIHBhcmFtcy5wdXNoKGFyZ3MpOwogIH0KCiAgcmV0dXJuIHBhcmFtczsKfQoKdmFyIFZ1ZTsKCmZ1bmN0aW9uIGluc3RhbGwoX1Z1ZSkgewogIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nICYmIGluc3RhbGwuaW5zdGFsbGVkICYmIF9WdWUgPT09IFZ1ZSkgewogICAgd2FybignYWxyZWFkeSBpbnN0YWxsZWQuJyk7CiAgICByZXR1cm47CiAgfQoKICBpbnN0YWxsLmluc3RhbGxlZCA9IHRydWU7CiAgVnVlID0gX1Z1ZTsKICB2YXIgdmVyc2lvbiA9IFZ1ZS52ZXJzaW9uICYmIE51bWJlcihWdWUudmVyc2lvbi5zcGxpdCgnLicpWzBdKSB8fCAtMTsKICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KCiAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicgJiYgdmVyc2lvbiA8IDIpIHsKICAgIHdhcm4oInZ1ZS1pMThuICgiICsgaW5zdGFsbC52ZXJzaW9uICsgIikgbmVlZCB0byB1c2UgVnVlIDIuMCBvciBsYXRlciAoVnVlOiAiICsgVnVlLnZlcnNpb24gKyAiKS4iKTsKICAgIHJldHVybjsKICB9CgogIGV4dGVuZChWdWUpOwogIFZ1ZS5taXhpbihtaXhpbik7CiAgVnVlLmRpcmVjdGl2ZSgndCcsIHsKICAgIGJpbmQ6IGJpbmQsCiAgICB1cGRhdGU6IHVwZGF0ZSwKICAgIHVuYmluZDogdW5iaW5kCiAgfSk7CiAgVnVlLmNvbXBvbmVudChpbnRlcnBvbGF0aW9uQ29tcG9uZW50Lm5hbWUsIGludGVycG9sYXRpb25Db21wb25lbnQpOwogIFZ1ZS5jb21wb25lbnQobnVtYmVyQ29tcG9uZW50Lm5hbWUsIG51bWJlckNvbXBvbmVudCk7IC8vIHVzZSBzaW1wbGUgbWVyZ2VTdHJhdGVnaWVzIHRvIHByZXZlbnQgaTE4biBpbnN0YW5jZSBsb3NlICdfX3Byb3RvX18nCgogIHZhciBzdHJhdHMgPSBWdWUuY29uZmlnLm9wdGlvbk1lcmdlU3RyYXRlZ2llczsKCiAgc3RyYXRzLmkxOG4gPSBmdW5jdGlvbiAocGFyZW50VmFsLCBjaGlsZFZhbCkgewogICAgcmV0dXJuIGNoaWxkVmFsID09PSB1bmRlZmluZWQgPyBwYXJlbnRWYWwgOiBjaGlsZFZhbDsKICB9Owp9Ci8qICAqLwoKCnZhciBCYXNlRm9ybWF0dGVyID0gZnVuY3Rpb24gQmFzZUZvcm1hdHRlcigpIHsKICB0aGlzLl9jYWNoZXMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwp9OwoKQmFzZUZvcm1hdHRlci5wcm90b3R5cGUuaW50ZXJwb2xhdGUgPSBmdW5jdGlvbiBpbnRlcnBvbGF0ZShtZXNzYWdlLCB2YWx1ZXMpIHsKICBpZiAoIXZhbHVlcykgewogICAgcmV0dXJuIFttZXNzYWdlXTsKICB9CgogIHZhciB0b2tlbnMgPSB0aGlzLl9jYWNoZXNbbWVzc2FnZV07CgogIGlmICghdG9rZW5zKSB7CiAgICB0b2tlbnMgPSBwYXJzZShtZXNzYWdlKTsKICAgIHRoaXMuX2NhY2hlc1ttZXNzYWdlXSA9IHRva2VuczsKICB9CgogIHJldHVybiBjb21waWxlKHRva2VucywgdmFsdWVzKTsKfTsKCnZhciBSRV9UT0tFTl9MSVNUX1ZBTFVFID0gL14oPzpcZCkrLzsKdmFyIFJFX1RPS0VOX05BTUVEX1ZBTFVFID0gL14oPzpcdykrLzsKCmZ1bmN0aW9uIHBhcnNlKGZvcm1hdCkgewogIHZhciB0b2tlbnMgPSBbXTsKICB2YXIgcG9zaXRpb24gPSAwOwogIHZhciB0ZXh0ID0gJyc7CgogIHdoaWxlIChwb3NpdGlvbiA8IGZvcm1hdC5sZW5ndGgpIHsKICAgIHZhciBfY2hhciA9IGZvcm1hdFtwb3NpdGlvbisrXTsKCiAgICBpZiAoX2NoYXIgPT09ICd7JykgewogICAgICBpZiAodGV4dCkgewogICAgICAgIHRva2Vucy5wdXNoKHsKICAgICAgICAgIHR5cGU6ICd0ZXh0JywKICAgICAgICAgIHZhbHVlOiB0ZXh0CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHRleHQgPSAnJzsKICAgICAgdmFyIHN1YiA9ICcnOwogICAgICBfY2hhciA9IGZvcm1hdFtwb3NpdGlvbisrXTsKCiAgICAgIHdoaWxlIChfY2hhciAhPT0gdW5kZWZpbmVkICYmIF9jaGFyICE9PSAnfScpIHsKICAgICAgICBzdWIgKz0gX2NoYXI7CiAgICAgICAgX2NoYXIgPSBmb3JtYXRbcG9zaXRpb24rK107CiAgICAgIH0KCiAgICAgIHZhciBpc0Nsb3NlZCA9IF9jaGFyID09PSAnfSc7CiAgICAgIHZhciB0eXBlID0gUkVfVE9LRU5fTElTVF9WQUxVRS50ZXN0KHN1YikgPyAnbGlzdCcgOiBpc0Nsb3NlZCAmJiBSRV9UT0tFTl9OQU1FRF9WQUxVRS50ZXN0KHN1YikgPyAnbmFtZWQnIDogJ3Vua25vd24nOwogICAgICB0b2tlbnMucHVzaCh7CiAgICAgICAgdmFsdWU6IHN1YiwKICAgICAgICB0eXBlOiB0eXBlCiAgICAgIH0pOwogICAgfSBlbHNlIGlmIChfY2hhciA9PT0gJyUnKSB7CiAgICAgIC8vIHdoZW4gZm91bmQgcmFpbHMgaTE4biBzeW50YXgsIHNraXAgdGV4dCBjYXB0dXJlCiAgICAgIGlmIChmb3JtYXRbcG9zaXRpb25dICE9PSAneycpIHsKICAgICAgICB0ZXh0ICs9IF9jaGFyOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICB0ZXh0ICs9IF9jaGFyOwogICAgfQogIH0KCiAgdGV4dCAmJiB0b2tlbnMucHVzaCh7CiAgICB0eXBlOiAndGV4dCcsCiAgICB2YWx1ZTogdGV4dAogIH0pOwogIHJldHVybiB0b2tlbnM7Cn0KCmZ1bmN0aW9uIGNvbXBpbGUodG9rZW5zLCB2YWx1ZXMpIHsKICB2YXIgY29tcGlsZWQgPSBbXTsKICB2YXIgaW5kZXggPSAwOwogIHZhciBtb2RlID0gQXJyYXkuaXNBcnJheSh2YWx1ZXMpID8gJ2xpc3QnIDogaXNPYmplY3QodmFsdWVzKSA/ICduYW1lZCcgOiAndW5rbm93bic7CgogIGlmIChtb2RlID09PSAndW5rbm93bicpIHsKICAgIHJldHVybiBjb21waWxlZDsKICB9CgogIHdoaWxlIChpbmRleCA8IHRva2Vucy5sZW5ndGgpIHsKICAgIHZhciB0b2tlbiA9IHRva2Vuc1tpbmRleF07CgogICAgc3dpdGNoICh0b2tlbi50eXBlKSB7CiAgICAgIGNhc2UgJ3RleHQnOgogICAgICAgIGNvbXBpbGVkLnB1c2godG9rZW4udmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnbGlzdCc6CiAgICAgICAgY29tcGlsZWQucHVzaCh2YWx1ZXNbcGFyc2VJbnQodG9rZW4udmFsdWUsIDEwKV0pOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnbmFtZWQnOgogICAgICAgIGlmIChtb2RlID09PSAnbmFtZWQnKSB7CiAgICAgICAgICBjb21waWxlZC5wdXNoKHZhbHVlc1t0b2tlbi52YWx1ZV0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgewogICAgICAgICAgICB3YXJuKCJUeXBlIG9mIHRva2VuICciICsgdG9rZW4udHlwZSArICInIGFuZCBmb3JtYXQgb2YgdmFsdWUgJyIgKyBtb2RlICsgIicgZG9uJ3QgbWF0Y2ghIik7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3Vua25vd24nOgogICAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICAgICAgICB3YXJuKCJEZXRlY3QgJ3Vua25vd24nIHR5cGUgb2YgdG9rZW4hIik7CiAgICAgICAgfQoKICAgICAgICBicmVhazsKICAgIH0KCiAgICBpbmRleCsrOwogIH0KCiAgcmV0dXJuIGNvbXBpbGVkOwp9Ci8qICAqLwoKLyoqCiAqICBQYXRoIHBhcnNlcgogKiAgLSBJbnNwaXJlZDoKICogICAgVnVlLmpzIFBhdGggcGFyc2VyCiAqLwovLyBhY3Rpb25zCgoKdmFyIEFQUEVORCA9IDA7CnZhciBQVVNIID0gMTsKdmFyIElOQ19TVUJfUEFUSF9ERVBUSCA9IDI7CnZhciBQVVNIX1NVQl9QQVRIID0gMzsgLy8gc3RhdGVzCgp2YXIgQkVGT1JFX1BBVEggPSAwOwp2YXIgSU5fUEFUSCA9IDE7CnZhciBCRUZPUkVfSURFTlQgPSAyOwp2YXIgSU5fSURFTlQgPSAzOwp2YXIgSU5fU1VCX1BBVEggPSA0Owp2YXIgSU5fU0lOR0xFX1FVT1RFID0gNTsKdmFyIElOX0RPVUJMRV9RVU9URSA9IDY7CnZhciBBRlRFUl9QQVRIID0gNzsKdmFyIEVSUk9SID0gODsKdmFyIHBhdGhTdGF0ZU1hY2hpbmUgPSBbXTsKcGF0aFN0YXRlTWFjaGluZVtCRUZPUkVfUEFUSF0gPSB7CiAgJ3dzJzogW0JFRk9SRV9QQVRIXSwKICAnaWRlbnQnOiBbSU5fSURFTlQsIEFQUEVORF0sCiAgJ1snOiBbSU5fU1VCX1BBVEhdLAogICdlb2YnOiBbQUZURVJfUEFUSF0KfTsKcGF0aFN0YXRlTWFjaGluZVtJTl9QQVRIXSA9IHsKICAnd3MnOiBbSU5fUEFUSF0sCiAgJy4nOiBbQkVGT1JFX0lERU5UXSwKICAnWyc6IFtJTl9TVUJfUEFUSF0sCiAgJ2VvZic6IFtBRlRFUl9QQVRIXQp9OwpwYXRoU3RhdGVNYWNoaW5lW0JFRk9SRV9JREVOVF0gPSB7CiAgJ3dzJzogW0JFRk9SRV9JREVOVF0sCiAgJ2lkZW50JzogW0lOX0lERU5ULCBBUFBFTkRdLAogICcwJzogW0lOX0lERU5ULCBBUFBFTkRdLAogICdudW1iZXInOiBbSU5fSURFTlQsIEFQUEVORF0KfTsKcGF0aFN0YXRlTWFjaGluZVtJTl9JREVOVF0gPSB7CiAgJ2lkZW50JzogW0lOX0lERU5ULCBBUFBFTkRdLAogICcwJzogW0lOX0lERU5ULCBBUFBFTkRdLAogICdudW1iZXInOiBbSU5fSURFTlQsIEFQUEVORF0sCiAgJ3dzJzogW0lOX1BBVEgsIFBVU0hdLAogICcuJzogW0JFRk9SRV9JREVOVCwgUFVTSF0sCiAgJ1snOiBbSU5fU1VCX1BBVEgsIFBVU0hdLAogICdlb2YnOiBbQUZURVJfUEFUSCwgUFVTSF0KfTsKcGF0aFN0YXRlTWFjaGluZVtJTl9TVUJfUEFUSF0gPSB7CiAgIiciOiBbSU5fU0lOR0xFX1FVT1RFLCBBUFBFTkRdLAogICciJzogW0lOX0RPVUJMRV9RVU9URSwgQVBQRU5EXSwKICAnWyc6IFtJTl9TVUJfUEFUSCwgSU5DX1NVQl9QQVRIX0RFUFRIXSwKICAnXSc6IFtJTl9QQVRILCBQVVNIX1NVQl9QQVRIXSwKICAnZW9mJzogRVJST1IsCiAgJ2Vsc2UnOiBbSU5fU1VCX1BBVEgsIEFQUEVORF0KfTsKcGF0aFN0YXRlTWFjaGluZVtJTl9TSU5HTEVfUVVPVEVdID0gewogICInIjogW0lOX1NVQl9QQVRILCBBUFBFTkRdLAogICdlb2YnOiBFUlJPUiwKICAnZWxzZSc6IFtJTl9TSU5HTEVfUVVPVEUsIEFQUEVORF0KfTsKcGF0aFN0YXRlTWFjaGluZVtJTl9ET1VCTEVfUVVPVEVdID0gewogICciJzogW0lOX1NVQl9QQVRILCBBUFBFTkRdLAogICdlb2YnOiBFUlJPUiwKICAnZWxzZSc6IFtJTl9ET1VCTEVfUVVPVEUsIEFQUEVORF0KfTsKLyoqCiAqIENoZWNrIGlmIGFuIGV4cHJlc3Npb24gaXMgYSBsaXRlcmFsIHZhbHVlLgogKi8KCnZhciBsaXRlcmFsVmFsdWVSRSA9IC9eXHM/KD86dHJ1ZXxmYWxzZXwtP1tcZC5dK3wnW14nXSonfCJbXiJdKiIpXHM/JC87CgpmdW5jdGlvbiBpc0xpdGVyYWwoZXhwKSB7CiAgcmV0dXJuIGxpdGVyYWxWYWx1ZVJFLnRlc3QoZXhwKTsKfQovKioKICogU3RyaXAgcXVvdGVzIGZyb20gYSBzdHJpbmcKICovCgoKZnVuY3Rpb24gc3RyaXBRdW90ZXMoc3RyKSB7CiAgdmFyIGEgPSBzdHIuY2hhckNvZGVBdCgwKTsKICB2YXIgYiA9IHN0ci5jaGFyQ29kZUF0KHN0ci5sZW5ndGggLSAxKTsKICByZXR1cm4gYSA9PT0gYiAmJiAoYSA9PT0gMHgyMiB8fCBhID09PSAweDI3KSA/IHN0ci5zbGljZSgxLCAtMSkgOiBzdHI7Cn0KLyoqCiAqIERldGVybWluZSB0aGUgdHlwZSBvZiBhIGNoYXJhY3RlciBpbiBhIGtleXBhdGguCiAqLwoKCmZ1bmN0aW9uIGdldFBhdGhDaGFyVHlwZShjaCkgewogIGlmIChjaCA9PT0gdW5kZWZpbmVkIHx8IGNoID09PSBudWxsKSB7CiAgICByZXR1cm4gJ2VvZic7CiAgfQoKICB2YXIgY29kZSA9IGNoLmNoYXJDb2RlQXQoMCk7CgogIHN3aXRjaCAoY29kZSkgewogICAgY2FzZSAweDVCOiAvLyBbCgogICAgY2FzZSAweDVEOiAvLyBdCgogICAgY2FzZSAweDJFOiAvLyAuCgogICAgY2FzZSAweDIyOiAvLyAiCgogICAgY2FzZSAweDI3OgogICAgICAvLyAnCiAgICAgIHJldHVybiBjaDsKCiAgICBjYXNlIDB4NUY6IC8vIF8KCiAgICBjYXNlIDB4MjQ6IC8vICQKCiAgICBjYXNlIDB4MkQ6CiAgICAgIC8vIC0KICAgICAgcmV0dXJuICdpZGVudCc7CgogICAgY2FzZSAweDA5OiAvLyBUYWIKCiAgICBjYXNlIDB4MEE6IC8vIE5ld2xpbmUKCiAgICBjYXNlIDB4MEQ6IC8vIFJldHVybgoKICAgIGNhc2UgMHhBMDogLy8gTm8tYnJlYWsgc3BhY2UKCiAgICBjYXNlIDB4RkVGRjogLy8gQnl0ZSBPcmRlciBNYXJrCgogICAgY2FzZSAweDIwMjg6IC8vIExpbmUgU2VwYXJhdG9yCgogICAgY2FzZSAweDIwMjk6CiAgICAgIC8vIFBhcmFncmFwaCBTZXBhcmF0b3IKICAgICAgcmV0dXJuICd3cyc7CiAgfQoKICByZXR1cm4gJ2lkZW50JzsKfQovKioKICogRm9ybWF0IGEgc3ViUGF0aCwgcmV0dXJuIGl0cyBwbGFpbiBmb3JtIGlmIGl0IGlzCiAqIGEgbGl0ZXJhbCBzdHJpbmcgb3IgbnVtYmVyLiBPdGhlcndpc2UgcHJlcGVuZCB0aGUKICogZHluYW1pYyBpbmRpY2F0b3IgKCopLgogKi8KCgpmdW5jdGlvbiBmb3JtYXRTdWJQYXRoKHBhdGgpIHsKICB2YXIgdHJpbW1lZCA9IHBhdGgudHJpbSgpOyAvLyBpbnZhbGlkIGxlYWRpbmcgMAoKICBpZiAocGF0aC5jaGFyQXQoMCkgPT09ICcwJyAmJiBpc05hTihwYXRoKSkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgcmV0dXJuIGlzTGl0ZXJhbCh0cmltbWVkKSA/IHN0cmlwUXVvdGVzKHRyaW1tZWQpIDogJyonICsgdHJpbW1lZDsKfQovKioKICogUGFyc2UgYSBzdHJpbmcgcGF0aCBpbnRvIGFuIGFycmF5IG9mIHNlZ21lbnRzCiAqLwoKCmZ1bmN0aW9uIHBhcnNlJDEocGF0aCkgewogIHZhciBrZXlzID0gW107CiAgdmFyIGluZGV4ID0gLTE7CiAgdmFyIG1vZGUgPSBCRUZPUkVfUEFUSDsKICB2YXIgc3ViUGF0aERlcHRoID0gMDsKICB2YXIgYzsKICB2YXIga2V5OwogIHZhciBuZXdDaGFyOwogIHZhciB0eXBlOwogIHZhciB0cmFuc2l0aW9uOwogIHZhciBhY3Rpb247CiAgdmFyIHR5cGVNYXA7CiAgdmFyIGFjdGlvbnMgPSBbXTsKCiAgYWN0aW9uc1tQVVNIXSA9IGZ1bmN0aW9uICgpIHsKICAgIGlmIChrZXkgIT09IHVuZGVmaW5lZCkgewogICAgICBrZXlzLnB1c2goa2V5KTsKICAgICAga2V5ID0gdW5kZWZpbmVkOwogICAgfQogIH07CgogIGFjdGlvbnNbQVBQRU5EXSA9IGZ1bmN0aW9uICgpIHsKICAgIGlmIChrZXkgPT09IHVuZGVmaW5lZCkgewogICAgICBrZXkgPSBuZXdDaGFyOwogICAgfSBlbHNlIHsKICAgICAga2V5ICs9IG5ld0NoYXI7CiAgICB9CiAgfTsKCiAgYWN0aW9uc1tJTkNfU1VCX1BBVEhfREVQVEhdID0gZnVuY3Rpb24gKCkgewogICAgYWN0aW9uc1tBUFBFTkRdKCk7CiAgICBzdWJQYXRoRGVwdGgrKzsKICB9OwoKICBhY3Rpb25zW1BVU0hfU1VCX1BBVEhdID0gZnVuY3Rpb24gKCkgewogICAgaWYgKHN1YlBhdGhEZXB0aCA+IDApIHsKICAgICAgc3ViUGF0aERlcHRoLS07CiAgICAgIG1vZGUgPSBJTl9TVUJfUEFUSDsKICAgICAgYWN0aW9uc1tBUFBFTkRdKCk7CiAgICB9IGVsc2UgewogICAgICBzdWJQYXRoRGVwdGggPSAwOwoKICAgICAgaWYgKGtleSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICBrZXkgPSBmb3JtYXRTdWJQYXRoKGtleSk7CgogICAgICBpZiAoa2V5ID09PSBmYWxzZSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBhY3Rpb25zW1BVU0hdKCk7CiAgICAgIH0KICAgIH0KICB9OwoKICBmdW5jdGlvbiBtYXliZVVuZXNjYXBlUXVvdGUoKSB7CiAgICB2YXIgbmV4dENoYXIgPSBwYXRoW2luZGV4ICsgMV07CgogICAgaWYgKG1vZGUgPT09IElOX1NJTkdMRV9RVU9URSAmJiBuZXh0Q2hhciA9PT0gIiciIHx8IG1vZGUgPT09IElOX0RPVUJMRV9RVU9URSAmJiBuZXh0Q2hhciA9PT0gJyInKSB7CiAgICAgIGluZGV4Kys7CiAgICAgIG5ld0NoYXIgPSAnXFwnICsgbmV4dENoYXI7CiAgICAgIGFjdGlvbnNbQVBQRU5EXSgpOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICB9CgogIHdoaWxlIChtb2RlICE9PSBudWxsKSB7CiAgICBpbmRleCsrOwogICAgYyA9IHBhdGhbaW5kZXhdOwoKICAgIGlmIChjID09PSAnXFwnICYmIG1heWJlVW5lc2NhcGVRdW90ZSgpKSB7CiAgICAgIGNvbnRpbnVlOwogICAgfQoKICAgIHR5cGUgPSBnZXRQYXRoQ2hhclR5cGUoYyk7CiAgICB0eXBlTWFwID0gcGF0aFN0YXRlTWFjaGluZVttb2RlXTsKICAgIHRyYW5zaXRpb24gPSB0eXBlTWFwW3R5cGVdIHx8IHR5cGVNYXBbJ2Vsc2UnXSB8fCBFUlJPUjsKCiAgICBpZiAodHJhbnNpdGlvbiA9PT0gRVJST1IpIHsKICAgICAgcmV0dXJuOyAvLyBwYXJzZSBlcnJvcgogICAgfQoKICAgIG1vZGUgPSB0cmFuc2l0aW9uWzBdOwogICAgYWN0aW9uID0gYWN0aW9uc1t0cmFuc2l0aW9uWzFdXTsKCiAgICBpZiAoYWN0aW9uKSB7CiAgICAgIG5ld0NoYXIgPSB0cmFuc2l0aW9uWzJdOwogICAgICBuZXdDaGFyID0gbmV3Q2hhciA9PT0gdW5kZWZpbmVkID8gYyA6IG5ld0NoYXI7CgogICAgICBpZiAoYWN0aW9uKCkgPT09IGZhbHNlKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICB9CgogICAgaWYgKG1vZGUgPT09IEFGVEVSX1BBVEgpIHsKICAgICAgcmV0dXJuIGtleXM7CiAgICB9CiAgfQp9Cgp2YXIgSTE4blBhdGggPSBmdW5jdGlvbiBJMThuUGF0aCgpIHsKICB0aGlzLl9jYWNoZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7Cn07Ci8qKgogKiBFeHRlcm5hbCBwYXJzZSB0aGF0IGNoZWNrIGZvciBhIGNhY2hlIGhpdCBmaXJzdAogKi8KCgpJMThuUGF0aC5wcm90b3R5cGUucGFyc2VQYXRoID0gZnVuY3Rpb24gcGFyc2VQYXRoKHBhdGgpIHsKICB2YXIgaGl0ID0gdGhpcy5fY2FjaGVbcGF0aF07CgogIGlmICghaGl0KSB7CiAgICBoaXQgPSBwYXJzZSQxKHBhdGgpOwoKICAgIGlmIChoaXQpIHsKICAgICAgdGhpcy5fY2FjaGVbcGF0aF0gPSBoaXQ7CiAgICB9CiAgfQoKICByZXR1cm4gaGl0IHx8IFtdOwp9OwovKioKICogR2V0IHBhdGggdmFsdWUgZnJvbSBwYXRoIHN0cmluZwogKi8KCgpJMThuUGF0aC5wcm90b3R5cGUuZ2V0UGF0aFZhbHVlID0gZnVuY3Rpb24gZ2V0UGF0aFZhbHVlKG9iaiwgcGF0aCkgewogIGlmICghaXNPYmplY3Qob2JqKSkgewogICAgcmV0dXJuIG51bGw7CiAgfQoKICB2YXIgcGF0aHMgPSB0aGlzLnBhcnNlUGF0aChwYXRoKTsKCiAgaWYgKHBhdGhzLmxlbmd0aCA9PT0gMCkgewogICAgcmV0dXJuIG51bGw7CiAgfSBlbHNlIHsKICAgIHZhciBsZW5ndGggPSBwYXRocy5sZW5ndGg7CiAgICB2YXIgbGFzdCA9IG9iajsKICAgIHZhciBpID0gMDsKCiAgICB3aGlsZSAoaSA8IGxlbmd0aCkgewogICAgICB2YXIgdmFsdWUgPSBsYXN0W3BhdGhzW2ldXTsKCiAgICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSBudWxsKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KCiAgICAgIGxhc3QgPSB2YWx1ZTsKICAgICAgaSsrOwogICAgfQoKICAgIHJldHVybiBsYXN0OwogIH0KfTsKLyogICovCgoKdmFyIGh0bWxUYWdNYXRjaGVyID0gLzxcLz9bXHdccz0iLy4nOjsjLVwvXSs+LzsKdmFyIGxpbmtLZXlNYXRjaGVyID0gLyg/OkAoPzpcLlthLXpdKyk/Oig/Oltcd1wtX3wuXSt8XChbXHdcLV98Ll0rXCkpKS9nOwp2YXIgbGlua0tleVByZWZpeE1hdGNoZXIgPSAvXkAoPzpcLihbYS16XSspKT86LzsKdmFyIGJyYWNrZXRzTWF0Y2hlciA9IC9bKCldL2c7CnZhciBkZWZhdWx0TW9kaWZpZXJzID0gewogICd1cHBlcic6IGZ1bmN0aW9uIHVwcGVyKHN0cikgewogICAgcmV0dXJuIHN0ci50b0xvY2FsZVVwcGVyQ2FzZSgpOwogIH0sCiAgJ2xvd2VyJzogZnVuY3Rpb24gbG93ZXIoc3RyKSB7CiAgICByZXR1cm4gc3RyLnRvTG9jYWxlTG93ZXJDYXNlKCk7CiAgfSwKICAnY2FwaXRhbGl6ZSc6IGZ1bmN0aW9uIGNhcGl0YWxpemUoc3RyKSB7CiAgICByZXR1cm4gIiIgKyBzdHIuY2hhckF0KDApLnRvTG9jYWxlVXBwZXJDYXNlKCkgKyBzdHIuc3Vic3RyKDEpOwogIH0KfTsKdmFyIGRlZmF1bHRGb3JtYXR0ZXIgPSBuZXcgQmFzZUZvcm1hdHRlcigpOwoKdmFyIFZ1ZUkxOG4gPSBmdW5jdGlvbiBWdWVJMThuKG9wdGlvbnMpIHsKICB2YXIgdGhpcyQxID0gdGhpczsKICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSBvcHRpb25zID0ge307IC8vIEF1dG8gaW5zdGFsbCBpZiBpdCBpcyBub3QgZG9uZSB5ZXQgYW5kIGB3aW5kb3dgIGhhcyBgVnVlYC4KICAvLyBUbyBhbGxvdyB1c2VycyB0byBhdm9pZCBhdXRvLWluc3RhbGxhdGlvbiBpbiBzb21lIGNhc2VzLAogIC8vIHRoaXMgY29kZSBzaG91bGQgYmUgcGxhY2VkIGhlcmUuIFNlZSAjMjkwCgogIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwoKICBpZiAoIVZ1ZSAmJiB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB3aW5kb3cuVnVlKSB7CiAgICBpbnN0YWxsKHdpbmRvdy5WdWUpOwogIH0KCiAgdmFyIGxvY2FsZSA9IG9wdGlvbnMubG9jYWxlIHx8ICdlbi1VUyc7CiAgdmFyIGZhbGxiYWNrTG9jYWxlID0gb3B0aW9ucy5mYWxsYmFja0xvY2FsZSA9PT0gZmFsc2UgPyBmYWxzZSA6IG9wdGlvbnMuZmFsbGJhY2tMb2NhbGUgfHwgJ2VuLVVTJzsKICB2YXIgbWVzc2FnZXMgPSBvcHRpb25zLm1lc3NhZ2VzIHx8IHt9OwogIHZhciBkYXRlVGltZUZvcm1hdHMgPSBvcHRpb25zLmRhdGVUaW1lRm9ybWF0cyB8fCB7fTsKICB2YXIgbnVtYmVyRm9ybWF0cyA9IG9wdGlvbnMubnVtYmVyRm9ybWF0cyB8fCB7fTsKICB0aGlzLl92bSA9IG51bGw7CiAgdGhpcy5fZm9ybWF0dGVyID0gb3B0aW9ucy5mb3JtYXR0ZXIgfHwgZGVmYXVsdEZvcm1hdHRlcjsKICB0aGlzLl9tb2RpZmllcnMgPSBvcHRpb25zLm1vZGlmaWVycyB8fCB7fTsKICB0aGlzLl9taXNzaW5nID0gb3B0aW9ucy5taXNzaW5nIHx8IG51bGw7CiAgdGhpcy5fcm9vdCA9IG9wdGlvbnMucm9vdCB8fCBudWxsOwogIHRoaXMuX3N5bmMgPSBvcHRpb25zLnN5bmMgPT09IHVuZGVmaW5lZCA/IHRydWUgOiAhIW9wdGlvbnMuc3luYzsKICB0aGlzLl9mYWxsYmFja1Jvb3QgPSBvcHRpb25zLmZhbGxiYWNrUm9vdCA9PT0gdW5kZWZpbmVkID8gdHJ1ZSA6ICEhb3B0aW9ucy5mYWxsYmFja1Jvb3Q7CiAgdGhpcy5fZm9ybWF0RmFsbGJhY2tNZXNzYWdlcyA9IG9wdGlvbnMuZm9ybWF0RmFsbGJhY2tNZXNzYWdlcyA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiAhIW9wdGlvbnMuZm9ybWF0RmFsbGJhY2tNZXNzYWdlczsKICB0aGlzLl9zaWxlbnRUcmFuc2xhdGlvbldhcm4gPSBvcHRpb25zLnNpbGVudFRyYW5zbGF0aW9uV2FybiA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiBvcHRpb25zLnNpbGVudFRyYW5zbGF0aW9uV2FybjsKICB0aGlzLl9zaWxlbnRGYWxsYmFja1dhcm4gPSBvcHRpb25zLnNpbGVudEZhbGxiYWNrV2FybiA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiAhIW9wdGlvbnMuc2lsZW50RmFsbGJhY2tXYXJuOwogIHRoaXMuX2RhdGVUaW1lRm9ybWF0dGVycyA9IHt9OwogIHRoaXMuX251bWJlckZvcm1hdHRlcnMgPSB7fTsKICB0aGlzLl9wYXRoID0gbmV3IEkxOG5QYXRoKCk7CiAgdGhpcy5fZGF0YUxpc3RlbmVycyA9IG5ldyBTZXQoKTsKICB0aGlzLl9jb21wb25lbnRJbnN0YW5jZUNyZWF0ZWRMaXN0ZW5lciA9IG9wdGlvbnMuY29tcG9uZW50SW5zdGFuY2VDcmVhdGVkTGlzdGVuZXIgfHwgbnVsbDsKICB0aGlzLl9wcmVzZXJ2ZURpcmVjdGl2ZUNvbnRlbnQgPSBvcHRpb25zLnByZXNlcnZlRGlyZWN0aXZlQ29udGVudCA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiAhIW9wdGlvbnMucHJlc2VydmVEaXJlY3RpdmVDb250ZW50OwogIHRoaXMucGx1cmFsaXphdGlvblJ1bGVzID0gb3B0aW9ucy5wbHVyYWxpemF0aW9uUnVsZXMgfHwge307CiAgdGhpcy5fd2Fybkh0bWxJbk1lc3NhZ2UgPSBvcHRpb25zLndhcm5IdG1sSW5NZXNzYWdlIHx8ICdvZmYnOwogIHRoaXMuX3Bvc3RUcmFuc2xhdGlvbiA9IG9wdGlvbnMucG9zdFRyYW5zbGF0aW9uIHx8IG51bGw7CiAgdGhpcy5fZXNjYXBlUGFyYW1ldGVySHRtbCA9IG9wdGlvbnMuZXNjYXBlUGFyYW1ldGVySHRtbCB8fCBmYWxzZTsKICAvKioKICAgKiBAcGFyYW0gY2hvaWNlIHtudW1iZXJ9IGEgY2hvaWNlIGluZGV4IGdpdmVuIGJ5IHRoZSBpbnB1dCB0byAkdGM6IGAkdGMoJ3BhdGgudG8ucnVsZScsIGNob2ljZUluZGV4KWAKICAgKiBAcGFyYW0gY2hvaWNlc0xlbmd0aCB7bnVtYmVyfSBhbiBvdmVyYWxsIGFtb3VudCBvZiBhdmFpbGFibGUgY2hvaWNlcwogICAqIEByZXR1cm5zIGEgZmluYWwgY2hvaWNlIGluZGV4CiAgKi8KCiAgdGhpcy5nZXRDaG9pY2VJbmRleCA9IGZ1bmN0aW9uIChjaG9pY2UsIGNob2ljZXNMZW5ndGgpIHsKICAgIHZhciB0aGlzUHJvdG90eXBlID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKHRoaXMkMSk7CgogICAgaWYgKHRoaXNQcm90b3R5cGUgJiYgdGhpc1Byb3RvdHlwZS5nZXRDaG9pY2VJbmRleCkgewogICAgICB2YXIgcHJvdG90eXBlR2V0Q2hvaWNlSW5kZXggPSB0aGlzUHJvdG90eXBlLmdldENob2ljZUluZGV4OwogICAgICByZXR1cm4gcHJvdG90eXBlR2V0Q2hvaWNlSW5kZXguY2FsbCh0aGlzJDEsIGNob2ljZSwgY2hvaWNlc0xlbmd0aCk7CiAgICB9IC8vIERlZmF1bHQgKG9sZCkgZ2V0Q2hvaWNlSW5kZXggaW1wbGVtZW50YXRpb24gLSBlbmdsaXNoLWNvbXBhdGlibGUKCgogICAgdmFyIGRlZmF1bHRJbXBsID0gZnVuY3Rpb24gZGVmYXVsdEltcGwoX2Nob2ljZSwgX2Nob2ljZXNMZW5ndGgpIHsKICAgICAgX2Nob2ljZSA9IE1hdGguYWJzKF9jaG9pY2UpOwoKICAgICAgaWYgKF9jaG9pY2VzTGVuZ3RoID09PSAyKSB7CiAgICAgICAgcmV0dXJuIF9jaG9pY2UgPyBfY2hvaWNlID4gMSA/IDEgOiAwIDogMTsKICAgICAgfQoKICAgICAgcmV0dXJuIF9jaG9pY2UgPyBNYXRoLm1pbihfY2hvaWNlLCAyKSA6IDA7CiAgICB9OwoKICAgIGlmICh0aGlzJDEubG9jYWxlIGluIHRoaXMkMS5wbHVyYWxpemF0aW9uUnVsZXMpIHsKICAgICAgcmV0dXJuIHRoaXMkMS5wbHVyYWxpemF0aW9uUnVsZXNbdGhpcyQxLmxvY2FsZV0uYXBwbHkodGhpcyQxLCBbY2hvaWNlLCBjaG9pY2VzTGVuZ3RoXSk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gZGVmYXVsdEltcGwoY2hvaWNlLCBjaG9pY2VzTGVuZ3RoKTsKICAgIH0KICB9OwoKICB0aGlzLl9leGlzdCA9IGZ1bmN0aW9uIChtZXNzYWdlLCBrZXkpIHsKICAgIGlmICghbWVzc2FnZSB8fCAha2V5KSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBpZiAoIWlzTnVsbCh0aGlzJDEuX3BhdGguZ2V0UGF0aFZhbHVlKG1lc3NhZ2UsIGtleSkpKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfSAvLyBmYWxsYmFjayBmb3IgZmxhdCBrZXkKCgogICAgaWYgKG1lc3NhZ2Vba2V5XSkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICByZXR1cm4gZmFsc2U7CiAgfTsKCiAgaWYgKHRoaXMuX3dhcm5IdG1sSW5NZXNzYWdlID09PSAnd2FybicgfHwgdGhpcy5fd2Fybkh0bWxJbk1lc3NhZ2UgPT09ICdlcnJvcicpIHsKICAgIE9iamVjdC5rZXlzKG1lc3NhZ2VzKS5mb3JFYWNoKGZ1bmN0aW9uIChsb2NhbGUpIHsKICAgICAgdGhpcyQxLl9jaGVja0xvY2FsZU1lc3NhZ2UobG9jYWxlLCB0aGlzJDEuX3dhcm5IdG1sSW5NZXNzYWdlLCBtZXNzYWdlc1tsb2NhbGVdKTsKICAgIH0pOwogIH0KCiAgdGhpcy5faW5pdFZNKHsKICAgIGxvY2FsZTogbG9jYWxlLAogICAgZmFsbGJhY2tMb2NhbGU6IGZhbGxiYWNrTG9jYWxlLAogICAgbWVzc2FnZXM6IG1lc3NhZ2VzLAogICAgZGF0ZVRpbWVGb3JtYXRzOiBkYXRlVGltZUZvcm1hdHMsCiAgICBudW1iZXJGb3JtYXRzOiBudW1iZXJGb3JtYXRzCiAgfSk7Cn07Cgp2YXIgcHJvdG90eXBlQWNjZXNzb3JzID0gewogIHZtOiB7CiAgICBjb25maWd1cmFibGU6IHRydWUKICB9LAogIG1lc3NhZ2VzOiB7CiAgICBjb25maWd1cmFibGU6IHRydWUKICB9LAogIGRhdGVUaW1lRm9ybWF0czogewogICAgY29uZmlndXJhYmxlOiB0cnVlCiAgfSwKICBudW1iZXJGb3JtYXRzOiB7CiAgICBjb25maWd1cmFibGU6IHRydWUKICB9LAogIGF2YWlsYWJsZUxvY2FsZXM6IHsKICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogIH0sCiAgbG9jYWxlOiB7CiAgICBjb25maWd1cmFibGU6IHRydWUKICB9LAogIGZhbGxiYWNrTG9jYWxlOiB7CiAgICBjb25maWd1cmFibGU6IHRydWUKICB9LAogIGZvcm1hdEZhbGxiYWNrTWVzc2FnZXM6IHsKICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogIH0sCiAgbWlzc2luZzogewogICAgY29uZmlndXJhYmxlOiB0cnVlCiAgfSwKICBmb3JtYXR0ZXI6IHsKICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogIH0sCiAgc2lsZW50VHJhbnNsYXRpb25XYXJuOiB7CiAgICBjb25maWd1cmFibGU6IHRydWUKICB9LAogIHNpbGVudEZhbGxiYWNrV2FybjogewogICAgY29uZmlndXJhYmxlOiB0cnVlCiAgfSwKICBwcmVzZXJ2ZURpcmVjdGl2ZUNvbnRlbnQ6IHsKICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogIH0sCiAgd2Fybkh0bWxJbk1lc3NhZ2U6IHsKICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogIH0sCiAgcG9zdFRyYW5zbGF0aW9uOiB7CiAgICBjb25maWd1cmFibGU6IHRydWUKICB9Cn07CgpWdWVJMThuLnByb3RvdHlwZS5fY2hlY2tMb2NhbGVNZXNzYWdlID0gZnVuY3Rpb24gX2NoZWNrTG9jYWxlTWVzc2FnZShsb2NhbGUsIGxldmVsLCBtZXNzYWdlKSB7CiAgdmFyIHBhdGhzID0gW107CgogIHZhciBmbiA9IGZ1bmN0aW9uIGZuKGxldmVsLCBsb2NhbGUsIG1lc3NhZ2UsIHBhdGhzKSB7CiAgICBpZiAoaXNQbGFpbk9iamVjdChtZXNzYWdlKSkgewogICAgICBPYmplY3Qua2V5cyhtZXNzYWdlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICB2YXIgdmFsID0gbWVzc2FnZVtrZXldOwoKICAgICAgICBpZiAoaXNQbGFpbk9iamVjdCh2YWwpKSB7CiAgICAgICAgICBwYXRocy5wdXNoKGtleSk7CiAgICAgICAgICBwYXRocy5wdXNoKCcuJyk7CiAgICAgICAgICBmbihsZXZlbCwgbG9jYWxlLCB2YWwsIHBhdGhzKTsKICAgICAgICAgIHBhdGhzLnBvcCgpOwogICAgICAgICAgcGF0aHMucG9wKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHBhdGhzLnB1c2goa2V5KTsKICAgICAgICAgIGZuKGxldmVsLCBsb2NhbGUsIHZhbCwgcGF0aHMpOwogICAgICAgICAgcGF0aHMucG9wKCk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0gZWxzZSBpZiAoaXNBcnJheShtZXNzYWdlKSkgewogICAgICBtZXNzYWdlLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7CiAgICAgICAgaWYgKGlzUGxhaW5PYmplY3QoaXRlbSkpIHsKICAgICAgICAgIHBhdGhzLnB1c2goIlsiICsgaW5kZXggKyAiXSIpOwogICAgICAgICAgcGF0aHMucHVzaCgnLicpOwogICAgICAgICAgZm4obGV2ZWwsIGxvY2FsZSwgaXRlbSwgcGF0aHMpOwogICAgICAgICAgcGF0aHMucG9wKCk7CiAgICAgICAgICBwYXRocy5wb3AoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcGF0aHMucHVzaCgiWyIgKyBpbmRleCArICJdIik7CiAgICAgICAgICBmbihsZXZlbCwgbG9jYWxlLCBpdGVtLCBwYXRocyk7CiAgICAgICAgICBwYXRocy5wb3AoKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSBlbHNlIGlmIChpc1N0cmluZyhtZXNzYWdlKSkgewogICAgICB2YXIgcmV0ID0gaHRtbFRhZ01hdGNoZXIudGVzdChtZXNzYWdlKTsKCiAgICAgIGlmIChyZXQpIHsKICAgICAgICB2YXIgbXNnID0gIkRldGVjdGVkIEhUTUwgaW4gbWVzc2FnZSAnIiArIG1lc3NhZ2UgKyAiJyBvZiBrZXlwYXRoICciICsgcGF0aHMuam9pbignJykgKyAiJyBhdCAnIiArIGxvY2FsZSArICInLiBDb25zaWRlciBjb21wb25lbnQgaW50ZXJwb2xhdGlvbiB3aXRoICc8aTE4bj4nIHRvIGF2b2lkIFhTUy4gU2VlIGh0dHBzOi8vYml0Lmx5LzJacUp6a3AiOwoKICAgICAgICBpZiAobGV2ZWwgPT09ICd3YXJuJykgewogICAgICAgICAgd2Fybihtc2cpOwogICAgICAgIH0gZWxzZSBpZiAobGV2ZWwgPT09ICdlcnJvcicpIHsKICAgICAgICAgIGVycm9yKG1zZyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfTsKCiAgZm4obGV2ZWwsIGxvY2FsZSwgbWVzc2FnZSwgcGF0aHMpOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUuX2luaXRWTSA9IGZ1bmN0aW9uIF9pbml0Vk0oZGF0YSkgewogIHZhciBzaWxlbnQgPSBWdWUuY29uZmlnLnNpbGVudDsKICBWdWUuY29uZmlnLnNpbGVudCA9IHRydWU7CiAgdGhpcy5fdm0gPSBuZXcgVnVlKHsKICAgIGRhdGE6IGRhdGEKICB9KTsKICBWdWUuY29uZmlnLnNpbGVudCA9IHNpbGVudDsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLmRlc3Ryb3lWTSA9IGZ1bmN0aW9uIGRlc3Ryb3lWTSgpIHsKICB0aGlzLl92bS4kZGVzdHJveSgpOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUuc3Vic2NyaWJlRGF0YUNoYW5naW5nID0gZnVuY3Rpb24gc3Vic2NyaWJlRGF0YUNoYW5naW5nKHZtKSB7CiAgdGhpcy5fZGF0YUxpc3RlbmVycy5hZGQodm0pOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUudW5zdWJzY3JpYmVEYXRhQ2hhbmdpbmcgPSBmdW5jdGlvbiB1bnN1YnNjcmliZURhdGFDaGFuZ2luZyh2bSkgewogIHJlbW92ZSh0aGlzLl9kYXRhTGlzdGVuZXJzLCB2bSk7Cn07CgpWdWVJMThuLnByb3RvdHlwZS53YXRjaEkxOG5EYXRhID0gZnVuY3Rpb24gd2F0Y2hJMThuRGF0YSgpIHsKICB2YXIgc2VsZiA9IHRoaXM7CiAgcmV0dXJuIHRoaXMuX3ZtLiR3YXRjaCgnJGRhdGEnLCBmdW5jdGlvbiAoKSB7CiAgICBzZWxmLl9kYXRhTGlzdGVuZXJzLmZvckVhY2goZnVuY3Rpb24gKGUpIHsKICAgICAgVnVlLm5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICBlICYmIGUuJGZvcmNlVXBkYXRlKCk7CiAgICAgIH0pOwogICAgfSk7CiAgfSwgewogICAgZGVlcDogdHJ1ZQogIH0pOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUud2F0Y2hMb2NhbGUgPSBmdW5jdGlvbiB3YXRjaExvY2FsZSgpIHsKICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICBpZiAoIXRoaXMuX3N5bmMgfHwgIXRoaXMuX3Jvb3QpIHsKICAgIHJldHVybiBudWxsOwogIH0KCiAgdmFyIHRhcmdldCA9IHRoaXMuX3ZtOwogIHJldHVybiB0aGlzLl9yb290LiRpMThuLnZtLiR3YXRjaCgnbG9jYWxlJywgZnVuY3Rpb24gKHZhbCkgewogICAgdGFyZ2V0LiRzZXQodGFyZ2V0LCAnbG9jYWxlJywgdmFsKTsKICAgIHRhcmdldC4kZm9yY2VVcGRhdGUoKTsKICB9LCB7CiAgICBpbW1lZGlhdGU6IHRydWUKICB9KTsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLm9uQ29tcG9uZW50SW5zdGFuY2VDcmVhdGVkID0gZnVuY3Rpb24gb25Db21wb25lbnRJbnN0YW5jZUNyZWF0ZWQobmV3STE4bikgewogIGlmICh0aGlzLl9jb21wb25lbnRJbnN0YW5jZUNyZWF0ZWRMaXN0ZW5lcikgewogICAgdGhpcy5fY29tcG9uZW50SW5zdGFuY2VDcmVhdGVkTGlzdGVuZXIobmV3STE4biwgdGhpcyk7CiAgfQp9OwoKcHJvdG90eXBlQWNjZXNzb3JzLnZtLmdldCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4gdGhpcy5fdm07Cn07Cgpwcm90b3R5cGVBY2Nlc3NvcnMubWVzc2FnZXMuZ2V0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBsb29zZUNsb25lKHRoaXMuX2dldE1lc3NhZ2VzKCkpOwp9OwoKcHJvdG90eXBlQWNjZXNzb3JzLmRhdGVUaW1lRm9ybWF0cy5nZXQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGxvb3NlQ2xvbmUodGhpcy5fZ2V0RGF0ZVRpbWVGb3JtYXRzKCkpOwp9OwoKcHJvdG90eXBlQWNjZXNzb3JzLm51bWJlckZvcm1hdHMuZ2V0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBsb29zZUNsb25lKHRoaXMuX2dldE51bWJlckZvcm1hdHMoKSk7Cn07Cgpwcm90b3R5cGVBY2Nlc3NvcnMuYXZhaWxhYmxlTG9jYWxlcy5nZXQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIE9iamVjdC5rZXlzKHRoaXMubWVzc2FnZXMpLnNvcnQoKTsKfTsKCnByb3RvdHlwZUFjY2Vzc29ycy5sb2NhbGUuZ2V0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiB0aGlzLl92bS5sb2NhbGU7Cn07Cgpwcm90b3R5cGVBY2Nlc3NvcnMubG9jYWxlLnNldCA9IGZ1bmN0aW9uIChsb2NhbGUpIHsKICB0aGlzLl92bS4kc2V0KHRoaXMuX3ZtLCAnbG9jYWxlJywgbG9jYWxlKTsKfTsKCnByb3RvdHlwZUFjY2Vzc29ycy5mYWxsYmFja0xvY2FsZS5nZXQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIHRoaXMuX3ZtLmZhbGxiYWNrTG9jYWxlOwp9OwoKcHJvdG90eXBlQWNjZXNzb3JzLmZhbGxiYWNrTG9jYWxlLnNldCA9IGZ1bmN0aW9uIChsb2NhbGUpIHsKICB0aGlzLl9sb2NhbGVDaGFpbkNhY2hlID0ge307CgogIHRoaXMuX3ZtLiRzZXQodGhpcy5fdm0sICdmYWxsYmFja0xvY2FsZScsIGxvY2FsZSk7Cn07Cgpwcm90b3R5cGVBY2Nlc3NvcnMuZm9ybWF0RmFsbGJhY2tNZXNzYWdlcy5nZXQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIHRoaXMuX2Zvcm1hdEZhbGxiYWNrTWVzc2FnZXM7Cn07Cgpwcm90b3R5cGVBY2Nlc3NvcnMuZm9ybWF0RmFsbGJhY2tNZXNzYWdlcy5zZXQgPSBmdW5jdGlvbiAoZmFsbGJhY2spIHsKICB0aGlzLl9mb3JtYXRGYWxsYmFja01lc3NhZ2VzID0gZmFsbGJhY2s7Cn07Cgpwcm90b3R5cGVBY2Nlc3NvcnMubWlzc2luZy5nZXQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIHRoaXMuX21pc3Npbmc7Cn07Cgpwcm90b3R5cGVBY2Nlc3NvcnMubWlzc2luZy5zZXQgPSBmdW5jdGlvbiAoaGFuZGxlcikgewogIHRoaXMuX21pc3NpbmcgPSBoYW5kbGVyOwp9OwoKcHJvdG90eXBlQWNjZXNzb3JzLmZvcm1hdHRlci5nZXQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIHRoaXMuX2Zvcm1hdHRlcjsKfTsKCnByb3RvdHlwZUFjY2Vzc29ycy5mb3JtYXR0ZXIuc2V0ID0gZnVuY3Rpb24gKGZvcm1hdHRlcikgewogIHRoaXMuX2Zvcm1hdHRlciA9IGZvcm1hdHRlcjsKfTsKCnByb3RvdHlwZUFjY2Vzc29ycy5zaWxlbnRUcmFuc2xhdGlvbldhcm4uZ2V0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiB0aGlzLl9zaWxlbnRUcmFuc2xhdGlvbldhcm47Cn07Cgpwcm90b3R5cGVBY2Nlc3NvcnMuc2lsZW50VHJhbnNsYXRpb25XYXJuLnNldCA9IGZ1bmN0aW9uIChzaWxlbnQpIHsKICB0aGlzLl9zaWxlbnRUcmFuc2xhdGlvbldhcm4gPSBzaWxlbnQ7Cn07Cgpwcm90b3R5cGVBY2Nlc3NvcnMuc2lsZW50RmFsbGJhY2tXYXJuLmdldCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4gdGhpcy5fc2lsZW50RmFsbGJhY2tXYXJuOwp9OwoKcHJvdG90eXBlQWNjZXNzb3JzLnNpbGVudEZhbGxiYWNrV2Fybi5zZXQgPSBmdW5jdGlvbiAoc2lsZW50KSB7CiAgdGhpcy5fc2lsZW50RmFsbGJhY2tXYXJuID0gc2lsZW50Owp9OwoKcHJvdG90eXBlQWNjZXNzb3JzLnByZXNlcnZlRGlyZWN0aXZlQ29udGVudC5nZXQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIHRoaXMuX3ByZXNlcnZlRGlyZWN0aXZlQ29udGVudDsKfTsKCnByb3RvdHlwZUFjY2Vzc29ycy5wcmVzZXJ2ZURpcmVjdGl2ZUNvbnRlbnQuc2V0ID0gZnVuY3Rpb24gKHByZXNlcnZlKSB7CiAgdGhpcy5fcHJlc2VydmVEaXJlY3RpdmVDb250ZW50ID0gcHJlc2VydmU7Cn07Cgpwcm90b3R5cGVBY2Nlc3NvcnMud2Fybkh0bWxJbk1lc3NhZ2UuZ2V0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiB0aGlzLl93YXJuSHRtbEluTWVzc2FnZTsKfTsKCnByb3RvdHlwZUFjY2Vzc29ycy53YXJuSHRtbEluTWVzc2FnZS5zZXQgPSBmdW5jdGlvbiAobGV2ZWwpIHsKICB2YXIgdGhpcyQxID0gdGhpczsKICB2YXIgb3JnTGV2ZWwgPSB0aGlzLl93YXJuSHRtbEluTWVzc2FnZTsKICB0aGlzLl93YXJuSHRtbEluTWVzc2FnZSA9IGxldmVsOwoKICBpZiAob3JnTGV2ZWwgIT09IGxldmVsICYmIChsZXZlbCA9PT0gJ3dhcm4nIHx8IGxldmVsID09PSAnZXJyb3InKSkgewogICAgdmFyIG1lc3NhZ2VzID0gdGhpcy5fZ2V0TWVzc2FnZXMoKTsKCiAgICBPYmplY3Qua2V5cyhtZXNzYWdlcykuZm9yRWFjaChmdW5jdGlvbiAobG9jYWxlKSB7CiAgICAgIHRoaXMkMS5fY2hlY2tMb2NhbGVNZXNzYWdlKGxvY2FsZSwgdGhpcyQxLl93YXJuSHRtbEluTWVzc2FnZSwgbWVzc2FnZXNbbG9jYWxlXSk7CiAgICB9KTsKICB9Cn07Cgpwcm90b3R5cGVBY2Nlc3NvcnMucG9zdFRyYW5zbGF0aW9uLmdldCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4gdGhpcy5fcG9zdFRyYW5zbGF0aW9uOwp9OwoKcHJvdG90eXBlQWNjZXNzb3JzLnBvc3RUcmFuc2xhdGlvbi5zZXQgPSBmdW5jdGlvbiAoaGFuZGxlcikgewogIHRoaXMuX3Bvc3RUcmFuc2xhdGlvbiA9IGhhbmRsZXI7Cn07CgpWdWVJMThuLnByb3RvdHlwZS5fZ2V0TWVzc2FnZXMgPSBmdW5jdGlvbiBfZ2V0TWVzc2FnZXMoKSB7CiAgcmV0dXJuIHRoaXMuX3ZtLm1lc3NhZ2VzOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUuX2dldERhdGVUaW1lRm9ybWF0cyA9IGZ1bmN0aW9uIF9nZXREYXRlVGltZUZvcm1hdHMoKSB7CiAgcmV0dXJuIHRoaXMuX3ZtLmRhdGVUaW1lRm9ybWF0czsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLl9nZXROdW1iZXJGb3JtYXRzID0gZnVuY3Rpb24gX2dldE51bWJlckZvcm1hdHMoKSB7CiAgcmV0dXJuIHRoaXMuX3ZtLm51bWJlckZvcm1hdHM7Cn07CgpWdWVJMThuLnByb3RvdHlwZS5fd2FybkRlZmF1bHQgPSBmdW5jdGlvbiBfd2FybkRlZmF1bHQobG9jYWxlLCBrZXksIHJlc3VsdCwgdm0sIHZhbHVlcywgaW50ZXJwb2xhdGVNb2RlKSB7CiAgaWYgKCFpc051bGwocmVzdWx0KSkgewogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIGlmICh0aGlzLl9taXNzaW5nKSB7CiAgICB2YXIgbWlzc2luZ1JldCA9IHRoaXMuX21pc3NpbmcuYXBwbHkobnVsbCwgW2xvY2FsZSwga2V5LCB2bSwgdmFsdWVzXSk7CgogICAgaWYgKGlzU3RyaW5nKG1pc3NpbmdSZXQpKSB7CiAgICAgIHJldHVybiBtaXNzaW5nUmV0OwogICAgfQogIH0gZWxzZSB7CiAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJyAmJiAhdGhpcy5faXNTaWxlbnRUcmFuc2xhdGlvbldhcm4oa2V5KSkgewogICAgICB3YXJuKCJDYW5ub3QgdHJhbnNsYXRlIHRoZSB2YWx1ZSBvZiBrZXlwYXRoICciICsga2V5ICsgIicuICIgKyAnVXNlIHRoZSB2YWx1ZSBvZiBrZXlwYXRoIGFzIGRlZmF1bHQuJyk7CiAgICB9CiAgfQoKICBpZiAodGhpcy5fZm9ybWF0RmFsbGJhY2tNZXNzYWdlcykgewogICAgdmFyIHBhcnNlZEFyZ3MgPSBwYXJzZUFyZ3MuYXBwbHkodm9pZCAwLCB2YWx1ZXMpOwogICAgcmV0dXJuIHRoaXMuX3JlbmRlcihrZXksIGludGVycG9sYXRlTW9kZSwgcGFyc2VkQXJncy5wYXJhbXMsIGtleSk7CiAgfSBlbHNlIHsKICAgIHJldHVybiBrZXk7CiAgfQp9OwoKVnVlSTE4bi5wcm90b3R5cGUuX2lzRmFsbGJhY2tSb290ID0gZnVuY3Rpb24gX2lzRmFsbGJhY2tSb290KHZhbCkgewogIHJldHVybiAhdmFsICYmICFpc051bGwodGhpcy5fcm9vdCkgJiYgdGhpcy5fZmFsbGJhY2tSb290Owp9OwoKVnVlSTE4bi5wcm90b3R5cGUuX2lzU2lsZW50RmFsbGJhY2tXYXJuID0gZnVuY3Rpb24gX2lzU2lsZW50RmFsbGJhY2tXYXJuKGtleSkgewogIHJldHVybiB0aGlzLl9zaWxlbnRGYWxsYmFja1dhcm4gaW5zdGFuY2VvZiBSZWdFeHAgPyB0aGlzLl9zaWxlbnRGYWxsYmFja1dhcm4udGVzdChrZXkpIDogdGhpcy5fc2lsZW50RmFsbGJhY2tXYXJuOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUuX2lzU2lsZW50RmFsbGJhY2sgPSBmdW5jdGlvbiBfaXNTaWxlbnRGYWxsYmFjayhsb2NhbGUsIGtleSkgewogIHJldHVybiB0aGlzLl9pc1NpbGVudEZhbGxiYWNrV2FybihrZXkpICYmICh0aGlzLl9pc0ZhbGxiYWNrUm9vdCgpIHx8IGxvY2FsZSAhPT0gdGhpcy5mYWxsYmFja0xvY2FsZSk7Cn07CgpWdWVJMThuLnByb3RvdHlwZS5faXNTaWxlbnRUcmFuc2xhdGlvbldhcm4gPSBmdW5jdGlvbiBfaXNTaWxlbnRUcmFuc2xhdGlvbldhcm4oa2V5KSB7CiAgcmV0dXJuIHRoaXMuX3NpbGVudFRyYW5zbGF0aW9uV2FybiBpbnN0YW5jZW9mIFJlZ0V4cCA/IHRoaXMuX3NpbGVudFRyYW5zbGF0aW9uV2Fybi50ZXN0KGtleSkgOiB0aGlzLl9zaWxlbnRUcmFuc2xhdGlvbldhcm47Cn07CgpWdWVJMThuLnByb3RvdHlwZS5faW50ZXJwb2xhdGUgPSBmdW5jdGlvbiBfaW50ZXJwb2xhdGUobG9jYWxlLCBtZXNzYWdlLCBrZXksIGhvc3QsIGludGVycG9sYXRlTW9kZSwgdmFsdWVzLCB2aXNpdGVkTGlua1N0YWNrKSB7CiAgaWYgKCFtZXNzYWdlKSB7CiAgICByZXR1cm4gbnVsbDsKICB9CgogIHZhciBwYXRoUmV0ID0gdGhpcy5fcGF0aC5nZXRQYXRoVmFsdWUobWVzc2FnZSwga2V5KTsKCiAgaWYgKGlzQXJyYXkocGF0aFJldCkgfHwgaXNQbGFpbk9iamVjdChwYXRoUmV0KSkgewogICAgcmV0dXJuIHBhdGhSZXQ7CiAgfQoKICB2YXIgcmV0OwoKICBpZiAoaXNOdWxsKHBhdGhSZXQpKSB7CiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgZWxzZSAqLwogICAgaWYgKGlzUGxhaW5PYmplY3QobWVzc2FnZSkpIHsKICAgICAgcmV0ID0gbWVzc2FnZVtrZXldOwoKICAgICAgaWYgKCEoaXNTdHJpbmcocmV0KSB8fCBpc0Z1bmN0aW9uKHJldCkpKSB7CiAgICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicgJiYgIXRoaXMuX2lzU2lsZW50VHJhbnNsYXRpb25XYXJuKGtleSkgJiYgIXRoaXMuX2lzU2lsZW50RmFsbGJhY2sobG9jYWxlLCBrZXkpKSB7CiAgICAgICAgICB3YXJuKCJWYWx1ZSBvZiBrZXkgJyIgKyBrZXkgKyAiJyBpcyBub3QgYSBzdHJpbmcgb3IgZnVuY3Rpb24gISIpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogIH0gZWxzZSB7CiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgZWxzZSAqLwogICAgaWYgKGlzU3RyaW5nKHBhdGhSZXQpIHx8IGlzRnVuY3Rpb24ocGF0aFJldCkpIHsKICAgICAgcmV0ID0gcGF0aFJldDsKICAgIH0gZWxzZSB7CiAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nICYmICF0aGlzLl9pc1NpbGVudFRyYW5zbGF0aW9uV2FybihrZXkpICYmICF0aGlzLl9pc1NpbGVudEZhbGxiYWNrKGxvY2FsZSwga2V5KSkgewogICAgICAgIHdhcm4oIlZhbHVlIG9mIGtleSAnIiArIGtleSArICInIGlzIG5vdCBhIHN0cmluZyBvciBmdW5jdGlvbiEiKTsKICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgfSAvLyBDaGVjayBmb3IgdGhlIGV4aXN0ZW5jZSBvZiBsaW5rcyB3aXRoaW4gdGhlIHRyYW5zbGF0ZWQgc3RyaW5nCgoKICBpZiAoaXNTdHJpbmcocmV0KSAmJiAocmV0LmluZGV4T2YoJ0A6JykgPj0gMCB8fCByZXQuaW5kZXhPZignQC4nKSA+PSAwKSkgewogICAgcmV0ID0gdGhpcy5fbGluayhsb2NhbGUsIG1lc3NhZ2UsIHJldCwgaG9zdCwgJ3JhdycsIHZhbHVlcywgdmlzaXRlZExpbmtTdGFjayk7CiAgfQoKICByZXR1cm4gdGhpcy5fcmVuZGVyKHJldCwgaW50ZXJwb2xhdGVNb2RlLCB2YWx1ZXMsIGtleSk7Cn07CgpWdWVJMThuLnByb3RvdHlwZS5fbGluayA9IGZ1bmN0aW9uIF9saW5rKGxvY2FsZSwgbWVzc2FnZSwgc3RyLCBob3N0LCBpbnRlcnBvbGF0ZU1vZGUsIHZhbHVlcywgdmlzaXRlZExpbmtTdGFjaykgewogIHZhciByZXQgPSBzdHI7IC8vIE1hdGNoIGFsbCB0aGUgbGlua3Mgd2l0aGluIHRoZSBsb2NhbAogIC8vIFdlIGFyZSBnb2luZyB0byByZXBsYWNlIGVhY2ggb2YKICAvLyB0aGVtIHdpdGggaXRzIHRyYW5zbGF0aW9uCgogIHZhciBtYXRjaGVzID0gcmV0Lm1hdGNoKGxpbmtLZXlNYXRjaGVyKTsKCiAgZm9yICh2YXIgaWR4IGluIG1hdGNoZXMpIHsKICAgIC8vIGllIGNvbXBhdGlibGU6IGZpbHRlciBjdXN0b20gYXJyYXkKICAgIC8vIHByb3RvdHlwZSBtZXRob2QKICAgIGlmICghbWF0Y2hlcy5oYXNPd25Qcm9wZXJ0eShpZHgpKSB7CiAgICAgIGNvbnRpbnVlOwogICAgfQoKICAgIHZhciBsaW5rID0gbWF0Y2hlc1tpZHhdOwogICAgdmFyIGxpbmtLZXlQcmVmaXhNYXRjaGVzID0gbGluay5tYXRjaChsaW5rS2V5UHJlZml4TWF0Y2hlcik7CiAgICB2YXIgbGlua1ByZWZpeCA9IGxpbmtLZXlQcmVmaXhNYXRjaGVzWzBdOwogICAgdmFyIGZvcm1hdHRlck5hbWUgPSBsaW5rS2V5UHJlZml4TWF0Y2hlc1sxXTsgLy8gUmVtb3ZlIHRoZSBsZWFkaW5nIEA6LCBALmNhc2U6IGFuZCB0aGUgYnJhY2tldHMKCiAgICB2YXIgbGlua1BsYWNlaG9sZGVyID0gbGluay5yZXBsYWNlKGxpbmtQcmVmaXgsICcnKS5yZXBsYWNlKGJyYWNrZXRzTWF0Y2hlciwgJycpOwoKICAgIGlmIChpbmNsdWRlcyh2aXNpdGVkTGlua1N0YWNrLCBsaW5rUGxhY2Vob2xkZXIpKSB7CiAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICAgICAgd2FybigiQ2lyY3VsYXIgcmVmZXJlbmNlIGZvdW5kLiBcIiIgKyBsaW5rICsgIlwiIGlzIGFscmVhZHkgdmlzaXRlZCBpbiB0aGUgY2hhaW4gb2YgIiArIHZpc2l0ZWRMaW5rU3RhY2sucmV2ZXJzZSgpLmpvaW4oJyA8LSAnKSk7CiAgICAgIH0KCiAgICAgIHJldHVybiByZXQ7CiAgICB9CgogICAgdmlzaXRlZExpbmtTdGFjay5wdXNoKGxpbmtQbGFjZWhvbGRlcik7IC8vIFRyYW5zbGF0ZSB0aGUgbGluawoKICAgIHZhciB0cmFuc2xhdGVkID0gdGhpcy5faW50ZXJwb2xhdGUobG9jYWxlLCBtZXNzYWdlLCBsaW5rUGxhY2Vob2xkZXIsIGhvc3QsIGludGVycG9sYXRlTW9kZSA9PT0gJ3JhdycgPyAnc3RyaW5nJyA6IGludGVycG9sYXRlTW9kZSwgaW50ZXJwb2xhdGVNb2RlID09PSAncmF3JyA/IHVuZGVmaW5lZCA6IHZhbHVlcywgdmlzaXRlZExpbmtTdGFjayk7CgogICAgaWYgKHRoaXMuX2lzRmFsbGJhY2tSb290KHRyYW5zbGF0ZWQpKSB7CiAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nICYmICF0aGlzLl9pc1NpbGVudFRyYW5zbGF0aW9uV2FybihsaW5rUGxhY2Vob2xkZXIpKSB7CiAgICAgICAgd2FybigiRmFsbCBiYWNrIHRvIHRyYW5zbGF0ZSB0aGUgbGluayBwbGFjZWhvbGRlciAnIiArIGxpbmtQbGFjZWhvbGRlciArICInIHdpdGggcm9vdCBsb2NhbGUuIik7CiAgICAgIH0KICAgICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCgoKICAgICAgaWYgKCF0aGlzLl9yb290KSB7CiAgICAgICAgdGhyb3cgRXJyb3IoJ3VuZXhwZWN0ZWQgZXJyb3InKTsKICAgICAgfQoKICAgICAgdmFyIHJvb3QgPSB0aGlzLl9yb290LiRpMThuOwogICAgICB0cmFuc2xhdGVkID0gcm9vdC5fdHJhbnNsYXRlKHJvb3QuX2dldE1lc3NhZ2VzKCksIHJvb3QubG9jYWxlLCByb290LmZhbGxiYWNrTG9jYWxlLCBsaW5rUGxhY2Vob2xkZXIsIGhvc3QsIGludGVycG9sYXRlTW9kZSwgdmFsdWVzKTsKICAgIH0KCiAgICB0cmFuc2xhdGVkID0gdGhpcy5fd2FybkRlZmF1bHQobG9jYWxlLCBsaW5rUGxhY2Vob2xkZXIsIHRyYW5zbGF0ZWQsIGhvc3QsIGlzQXJyYXkodmFsdWVzKSA/IHZhbHVlcyA6IFt2YWx1ZXNdLCBpbnRlcnBvbGF0ZU1vZGUpOwoKICAgIGlmICh0aGlzLl9tb2RpZmllcnMuaGFzT3duUHJvcGVydHkoZm9ybWF0dGVyTmFtZSkpIHsKICAgICAgdHJhbnNsYXRlZCA9IHRoaXMuX21vZGlmaWVyc1tmb3JtYXR0ZXJOYW1lXSh0cmFuc2xhdGVkKTsKICAgIH0gZWxzZSBpZiAoZGVmYXVsdE1vZGlmaWVycy5oYXNPd25Qcm9wZXJ0eShmb3JtYXR0ZXJOYW1lKSkgewogICAgICB0cmFuc2xhdGVkID0gZGVmYXVsdE1vZGlmaWVyc1tmb3JtYXR0ZXJOYW1lXSh0cmFuc2xhdGVkKTsKICAgIH0KCiAgICB2aXNpdGVkTGlua1N0YWNrLnBvcCgpOyAvLyBSZXBsYWNlIHRoZSBsaW5rIHdpdGggdGhlIHRyYW5zbGF0ZWQKCiAgICByZXQgPSAhdHJhbnNsYXRlZCA/IHJldCA6IHJldC5yZXBsYWNlKGxpbmssIHRyYW5zbGF0ZWQpOwogIH0KCiAgcmV0dXJuIHJldDsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLl9jcmVhdGVNZXNzYWdlQ29udGV4dCA9IGZ1bmN0aW9uIF9jcmVhdGVNZXNzYWdlQ29udGV4dCh2YWx1ZXMpIHsKICB2YXIgX2xpc3QgPSBpc0FycmF5KHZhbHVlcykgPyB2YWx1ZXMgOiBbXTsKCiAgdmFyIF9uYW1lZCA9IGlzT2JqZWN0KHZhbHVlcykgPyB2YWx1ZXMgOiB7fTsKCiAgdmFyIGxpc3QgPSBmdW5jdGlvbiBsaXN0KGluZGV4KSB7CiAgICByZXR1cm4gX2xpc3RbaW5kZXhdOwogIH07CgogIHZhciBuYW1lZCA9IGZ1bmN0aW9uIG5hbWVkKGtleSkgewogICAgcmV0dXJuIF9uYW1lZFtrZXldOwogIH07CgogIHJldHVybiB7CiAgICBsaXN0OiBsaXN0LAogICAgbmFtZWQ6IG5hbWVkCiAgfTsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLl9yZW5kZXIgPSBmdW5jdGlvbiBfcmVuZGVyKG1lc3NhZ2UsIGludGVycG9sYXRlTW9kZSwgdmFsdWVzLCBwYXRoKSB7CiAgaWYgKGlzRnVuY3Rpb24obWVzc2FnZSkpIHsKICAgIHJldHVybiBtZXNzYWdlKHRoaXMuX2NyZWF0ZU1lc3NhZ2VDb250ZXh0KHZhbHVlcykpOwogIH0KCiAgdmFyIHJldCA9IHRoaXMuX2Zvcm1hdHRlci5pbnRlcnBvbGF0ZShtZXNzYWdlLCB2YWx1ZXMsIHBhdGgpOyAvLyBJZiB0aGUgY3VzdG9tIGZvcm1hdHRlciByZWZ1c2VzIHRvIHdvcmsgLSBhcHBseSB0aGUgZGVmYXVsdCBvbmUKCgogIGlmICghcmV0KSB7CiAgICByZXQgPSBkZWZhdWx0Rm9ybWF0dGVyLmludGVycG9sYXRlKG1lc3NhZ2UsIHZhbHVlcywgcGF0aCk7CiAgfSAvLyBpZiBpbnRlcnBvbGF0ZU1vZGUgaXMgKipub3QqKiAnc3RyaW5nJyAoJ3JvdycpLAogIC8vIHJldHVybiB0aGUgY29tcGlsZWQgZGF0YSAoZS5nLiBbJ2ZvbycsIFZOb2RlLCAnYmFyJ10pIHdpdGggZm9ybWF0dGVyCgoKICByZXR1cm4gaW50ZXJwb2xhdGVNb2RlID09PSAnc3RyaW5nJyAmJiAhaXNTdHJpbmcocmV0KSA/IHJldC5qb2luKCcnKSA6IHJldDsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLl9hcHBlbmRJdGVtVG9DaGFpbiA9IGZ1bmN0aW9uIF9hcHBlbmRJdGVtVG9DaGFpbihjaGFpbiwgaXRlbSwgYmxvY2tzKSB7CiAgdmFyIGZvbGxvdyA9IGZhbHNlOwoKICBpZiAoIWluY2x1ZGVzKGNoYWluLCBpdGVtKSkgewogICAgZm9sbG93ID0gdHJ1ZTsKCiAgICBpZiAoaXRlbSkgewogICAgICBmb2xsb3cgPSBpdGVtW2l0ZW0ubGVuZ3RoIC0gMV0gIT09ICchJzsKICAgICAgaXRlbSA9IGl0ZW0ucmVwbGFjZSgvIS9nLCAnJyk7CiAgICAgIGNoYWluLnB1c2goaXRlbSk7CgogICAgICBpZiAoYmxvY2tzICYmIGJsb2Nrc1tpdGVtXSkgewogICAgICAgIGZvbGxvdyA9IGJsb2Nrc1tpdGVtXTsKICAgICAgfQogICAgfQogIH0KCiAgcmV0dXJuIGZvbGxvdzsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLl9hcHBlbmRMb2NhbGVUb0NoYWluID0gZnVuY3Rpb24gX2FwcGVuZExvY2FsZVRvQ2hhaW4oY2hhaW4sIGxvY2FsZSwgYmxvY2tzKSB7CiAgdmFyIGZvbGxvdzsKICB2YXIgdG9rZW5zID0gbG9jYWxlLnNwbGl0KCctJyk7CgogIGRvIHsKICAgIHZhciBpdGVtID0gdG9rZW5zLmpvaW4oJy0nKTsKICAgIGZvbGxvdyA9IHRoaXMuX2FwcGVuZEl0ZW1Ub0NoYWluKGNoYWluLCBpdGVtLCBibG9ja3MpOwogICAgdG9rZW5zLnNwbGljZSgtMSwgMSk7CiAgfSB3aGlsZSAodG9rZW5zLmxlbmd0aCAmJiBmb2xsb3cgPT09IHRydWUpOwoKICByZXR1cm4gZm9sbG93Owp9OwoKVnVlSTE4bi5wcm90b3R5cGUuX2FwcGVuZEJsb2NrVG9DaGFpbiA9IGZ1bmN0aW9uIF9hcHBlbmRCbG9ja1RvQ2hhaW4oY2hhaW4sIGJsb2NrLCBibG9ja3MpIHsKICB2YXIgZm9sbG93ID0gdHJ1ZTsKCiAgZm9yICh2YXIgaSA9IDA7IGkgPCBibG9jay5sZW5ndGggJiYgaXNCb29sZWFuKGZvbGxvdyk7IGkrKykgewogICAgdmFyIGxvY2FsZSA9IGJsb2NrW2ldOwoKICAgIGlmIChpc1N0cmluZyhsb2NhbGUpKSB7CiAgICAgIGZvbGxvdyA9IHRoaXMuX2FwcGVuZExvY2FsZVRvQ2hhaW4oY2hhaW4sIGxvY2FsZSwgYmxvY2tzKTsKICAgIH0KICB9CgogIHJldHVybiBmb2xsb3c7Cn07CgpWdWVJMThuLnByb3RvdHlwZS5fZ2V0TG9jYWxlQ2hhaW4gPSBmdW5jdGlvbiBfZ2V0TG9jYWxlQ2hhaW4oc3RhcnQsIGZhbGxiYWNrTG9jYWxlKSB7CiAgaWYgKHN0YXJ0ID09PSAnJykgewogICAgcmV0dXJuIFtdOwogIH0KCiAgaWYgKCF0aGlzLl9sb2NhbGVDaGFpbkNhY2hlKSB7CiAgICB0aGlzLl9sb2NhbGVDaGFpbkNhY2hlID0ge307CiAgfQoKICB2YXIgY2hhaW4gPSB0aGlzLl9sb2NhbGVDaGFpbkNhY2hlW3N0YXJ0XTsKCiAgaWYgKCFjaGFpbikgewogICAgaWYgKCFmYWxsYmFja0xvY2FsZSkgewogICAgICBmYWxsYmFja0xvY2FsZSA9IHRoaXMuZmFsbGJhY2tMb2NhbGU7CiAgICB9CgogICAgY2hhaW4gPSBbXTsgLy8gZmlyc3QgYmxvY2sgZGVmaW5lZCBieSBzdGFydAoKICAgIHZhciBibG9jayA9IFtzdGFydF07IC8vIHdoaWxlIGFueSBpbnRlcnZlbmluZyBibG9jayBmb3VuZAoKICAgIHdoaWxlIChpc0FycmF5KGJsb2NrKSkgewogICAgICBibG9jayA9IHRoaXMuX2FwcGVuZEJsb2NrVG9DaGFpbihjaGFpbiwgYmxvY2ssIGZhbGxiYWNrTG9jYWxlKTsKICAgIH0gLy8gbGFzdCBibG9jayBkZWZpbmVkIGJ5IGRlZmF1bHQKCgogICAgdmFyIGRlZmF1bHRzOwoKICAgIGlmIChpc0FycmF5KGZhbGxiYWNrTG9jYWxlKSkgewogICAgICBkZWZhdWx0cyA9IGZhbGxiYWNrTG9jYWxlOwogICAgfSBlbHNlIGlmIChpc09iamVjdChmYWxsYmFja0xvY2FsZSkpIHsKICAgICAgLyogJEZsb3dGaXhNZSAqLwogICAgICBpZiAoZmFsbGJhY2tMb2NhbGVbJ2RlZmF1bHQnXSkgewogICAgICAgIGRlZmF1bHRzID0gZmFsbGJhY2tMb2NhbGVbJ2RlZmF1bHQnXTsKICAgICAgfSBlbHNlIHsKICAgICAgICBkZWZhdWx0cyA9IG51bGw7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGRlZmF1bHRzID0gZmFsbGJhY2tMb2NhbGU7CiAgICB9IC8vIGNvbnZlcnQgZGVmYXVsdHMgdG8gYXJyYXkKCgogICAgaWYgKGlzU3RyaW5nKGRlZmF1bHRzKSkgewogICAgICBibG9jayA9IFtkZWZhdWx0c107CiAgICB9IGVsc2UgewogICAgICBibG9jayA9IGRlZmF1bHRzOwogICAgfQoKICAgIGlmIChibG9jaykgewogICAgICB0aGlzLl9hcHBlbmRCbG9ja1RvQ2hhaW4oY2hhaW4sIGJsb2NrLCBudWxsKTsKICAgIH0KCiAgICB0aGlzLl9sb2NhbGVDaGFpbkNhY2hlW3N0YXJ0XSA9IGNoYWluOwogIH0KCiAgcmV0dXJuIGNoYWluOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUuX3RyYW5zbGF0ZSA9IGZ1bmN0aW9uIF90cmFuc2xhdGUobWVzc2FnZXMsIGxvY2FsZSwgZmFsbGJhY2ssIGtleSwgaG9zdCwgaW50ZXJwb2xhdGVNb2RlLCBhcmdzKSB7CiAgdmFyIGNoYWluID0gdGhpcy5fZ2V0TG9jYWxlQ2hhaW4obG9jYWxlLCBmYWxsYmFjayk7CgogIHZhciByZXM7CgogIGZvciAodmFyIGkgPSAwOyBpIDwgY2hhaW4ubGVuZ3RoOyBpKyspIHsKICAgIHZhciBzdGVwID0gY2hhaW5baV07CiAgICByZXMgPSB0aGlzLl9pbnRlcnBvbGF0ZShzdGVwLCBtZXNzYWdlc1tzdGVwXSwga2V5LCBob3N0LCBpbnRlcnBvbGF0ZU1vZGUsIGFyZ3MsIFtrZXldKTsKCiAgICBpZiAoIWlzTnVsbChyZXMpKSB7CiAgICAgIGlmIChzdGVwICE9PSBsb2NhbGUgJiYgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJyAmJiAhdGhpcy5faXNTaWxlbnRUcmFuc2xhdGlvbldhcm4oa2V5KSAmJiAhdGhpcy5faXNTaWxlbnRGYWxsYmFja1dhcm4oa2V5KSkgewogICAgICAgIHdhcm4oIkZhbGwgYmFjayB0byB0cmFuc2xhdGUgdGhlIGtleXBhdGggJyIgKyBrZXkgKyAiJyB3aXRoICciICsgc3RlcCArICInIGxvY2FsZS4iKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHJlczsKICAgIH0KICB9CgogIHJldHVybiBudWxsOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUuX3QgPSBmdW5jdGlvbiBfdChrZXksIF9sb2NhbGUsIG1lc3NhZ2VzLCBob3N0KSB7CiAgdmFyIHJlZjsKICB2YXIgdmFsdWVzID0gW10sCiAgICAgIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGggLSA0OwoKICB3aGlsZSAobGVuLS0gPiAwKSB7CiAgICB2YWx1ZXNbbGVuXSA9IGFyZ3VtZW50c1tsZW4gKyA0XTsKICB9CgogIGlmICgha2V5KSB7CiAgICByZXR1cm4gJyc7CiAgfQoKICB2YXIgcGFyc2VkQXJncyA9IHBhcnNlQXJncy5hcHBseSh2b2lkIDAsIHZhbHVlcyk7CgogIGlmICh0aGlzLl9lc2NhcGVQYXJhbWV0ZXJIdG1sKSB7CiAgICBwYXJzZWRBcmdzLnBhcmFtcyA9IGVzY2FwZVBhcmFtcyhwYXJzZWRBcmdzLnBhcmFtcyk7CiAgfQoKICB2YXIgbG9jYWxlID0gcGFyc2VkQXJncy5sb2NhbGUgfHwgX2xvY2FsZTsKCiAgdmFyIHJldCA9IHRoaXMuX3RyYW5zbGF0ZShtZXNzYWdlcywgbG9jYWxlLCB0aGlzLmZhbGxiYWNrTG9jYWxlLCBrZXksIGhvc3QsICdzdHJpbmcnLCBwYXJzZWRBcmdzLnBhcmFtcyk7CgogIGlmICh0aGlzLl9pc0ZhbGxiYWNrUm9vdChyZXQpKSB7CiAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJyAmJiAhdGhpcy5faXNTaWxlbnRUcmFuc2xhdGlvbldhcm4oa2V5KSAmJiAhdGhpcy5faXNTaWxlbnRGYWxsYmFja1dhcm4oa2V5KSkgewogICAgICB3YXJuKCJGYWxsIGJhY2sgdG8gdHJhbnNsYXRlIHRoZSBrZXlwYXRoICciICsga2V5ICsgIicgd2l0aCByb290IGxvY2FsZS4iKTsKICAgIH0KICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwoKCiAgICBpZiAoIXRoaXMuX3Jvb3QpIHsKICAgICAgdGhyb3cgRXJyb3IoJ3VuZXhwZWN0ZWQgZXJyb3InKTsKICAgIH0KCiAgICByZXR1cm4gKHJlZiA9IHRoaXMuX3Jvb3QpLiR0LmFwcGx5KHJlZiwgW2tleV0uY29uY2F0KHZhbHVlcykpOwogIH0gZWxzZSB7CiAgICByZXQgPSB0aGlzLl93YXJuRGVmYXVsdChsb2NhbGUsIGtleSwgcmV0LCBob3N0LCB2YWx1ZXMsICdzdHJpbmcnKTsKCiAgICBpZiAodGhpcy5fcG9zdFRyYW5zbGF0aW9uICYmIHJldCAhPT0gbnVsbCAmJiByZXQgIT09IHVuZGVmaW5lZCkgewogICAgICByZXQgPSB0aGlzLl9wb3N0VHJhbnNsYXRpb24ocmV0LCBrZXkpOwogICAgfQoKICAgIHJldHVybiByZXQ7CiAgfQp9OwoKVnVlSTE4bi5wcm90b3R5cGUudCA9IGZ1bmN0aW9uIHQoa2V5KSB7CiAgdmFyIHJlZjsKICB2YXIgdmFsdWVzID0gW10sCiAgICAgIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGggLSAxOwoKICB3aGlsZSAobGVuLS0gPiAwKSB7CiAgICB2YWx1ZXNbbGVuXSA9IGFyZ3VtZW50c1tsZW4gKyAxXTsKICB9CgogIHJldHVybiAocmVmID0gdGhpcykuX3QuYXBwbHkocmVmLCBba2V5LCB0aGlzLmxvY2FsZSwgdGhpcy5fZ2V0TWVzc2FnZXMoKSwgbnVsbF0uY29uY2F0KHZhbHVlcykpOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUuX2kgPSBmdW5jdGlvbiBfaShrZXksIGxvY2FsZSwgbWVzc2FnZXMsIGhvc3QsIHZhbHVlcykgewogIHZhciByZXQgPSB0aGlzLl90cmFuc2xhdGUobWVzc2FnZXMsIGxvY2FsZSwgdGhpcy5mYWxsYmFja0xvY2FsZSwga2V5LCBob3N0LCAncmF3JywgdmFsdWVzKTsKCiAgaWYgKHRoaXMuX2lzRmFsbGJhY2tSb290KHJldCkpIHsKICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nICYmICF0aGlzLl9pc1NpbGVudFRyYW5zbGF0aW9uV2FybihrZXkpKSB7CiAgICAgIHdhcm4oIkZhbGwgYmFjayB0byBpbnRlcnBvbGF0ZSB0aGUga2V5cGF0aCAnIiArIGtleSArICInIHdpdGggcm9vdCBsb2NhbGUuIik7CiAgICB9CgogICAgaWYgKCF0aGlzLl9yb290KSB7CiAgICAgIHRocm93IEVycm9yKCd1bmV4cGVjdGVkIGVycm9yJyk7CiAgICB9CgogICAgcmV0dXJuIHRoaXMuX3Jvb3QuJGkxOG4uaShrZXksIGxvY2FsZSwgdmFsdWVzKTsKICB9IGVsc2UgewogICAgcmV0dXJuIHRoaXMuX3dhcm5EZWZhdWx0KGxvY2FsZSwga2V5LCByZXQsIGhvc3QsIFt2YWx1ZXNdLCAncmF3Jyk7CiAgfQp9OwoKVnVlSTE4bi5wcm90b3R5cGUuaSA9IGZ1bmN0aW9uIGkoa2V5LCBsb2NhbGUsIHZhbHVlcykgewogIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogIGlmICgha2V5KSB7CiAgICByZXR1cm4gJyc7CiAgfQoKICBpZiAoIWlzU3RyaW5nKGxvY2FsZSkpIHsKICAgIGxvY2FsZSA9IHRoaXMubG9jYWxlOwogIH0KCiAgcmV0dXJuIHRoaXMuX2koa2V5LCBsb2NhbGUsIHRoaXMuX2dldE1lc3NhZ2VzKCksIG51bGwsIHZhbHVlcyk7Cn07CgpWdWVJMThuLnByb3RvdHlwZS5fdGMgPSBmdW5jdGlvbiBfdGMoa2V5LCBfbG9jYWxlLCBtZXNzYWdlcywgaG9zdCwgY2hvaWNlKSB7CiAgdmFyIHJlZjsKICB2YXIgdmFsdWVzID0gW10sCiAgICAgIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGggLSA1OwoKICB3aGlsZSAobGVuLS0gPiAwKSB7CiAgICB2YWx1ZXNbbGVuXSA9IGFyZ3VtZW50c1tsZW4gKyA1XTsKICB9CgogIGlmICgha2V5KSB7CiAgICByZXR1cm4gJyc7CiAgfQoKICBpZiAoY2hvaWNlID09PSB1bmRlZmluZWQpIHsKICAgIGNob2ljZSA9IDE7CiAgfQoKICB2YXIgcHJlZGVmaW5lZCA9IHsKICAgICdjb3VudCc6IGNob2ljZSwKICAgICduJzogY2hvaWNlCiAgfTsKICB2YXIgcGFyc2VkQXJncyA9IHBhcnNlQXJncy5hcHBseSh2b2lkIDAsIHZhbHVlcyk7CiAgcGFyc2VkQXJncy5wYXJhbXMgPSBPYmplY3QuYXNzaWduKHByZWRlZmluZWQsIHBhcnNlZEFyZ3MucGFyYW1zKTsKICB2YWx1ZXMgPSBwYXJzZWRBcmdzLmxvY2FsZSA9PT0gbnVsbCA/IFtwYXJzZWRBcmdzLnBhcmFtc10gOiBbcGFyc2VkQXJncy5sb2NhbGUsIHBhcnNlZEFyZ3MucGFyYW1zXTsKICByZXR1cm4gdGhpcy5mZXRjaENob2ljZSgocmVmID0gdGhpcykuX3QuYXBwbHkocmVmLCBba2V5LCBfbG9jYWxlLCBtZXNzYWdlcywgaG9zdF0uY29uY2F0KHZhbHVlcykpLCBjaG9pY2UpOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUuZmV0Y2hDaG9pY2UgPSBmdW5jdGlvbiBmZXRjaENob2ljZShtZXNzYWdlLCBjaG9pY2UpIHsKICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICBpZiAoIW1lc3NhZ2UgfHwgIWlzU3RyaW5nKG1lc3NhZ2UpKSB7CiAgICByZXR1cm4gbnVsbDsKICB9CgogIHZhciBjaG9pY2VzID0gbWVzc2FnZS5zcGxpdCgnfCcpOwogIGNob2ljZSA9IHRoaXMuZ2V0Q2hvaWNlSW5kZXgoY2hvaWNlLCBjaG9pY2VzLmxlbmd0aCk7CgogIGlmICghY2hvaWNlc1tjaG9pY2VdKSB7CiAgICByZXR1cm4gbWVzc2FnZTsKICB9CgogIHJldHVybiBjaG9pY2VzW2Nob2ljZV0udHJpbSgpOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUudGMgPSBmdW5jdGlvbiB0YyhrZXksIGNob2ljZSkgewogIHZhciByZWY7CiAgdmFyIHZhbHVlcyA9IFtdLAogICAgICBsZW4gPSBhcmd1bWVudHMubGVuZ3RoIC0gMjsKCiAgd2hpbGUgKGxlbi0tID4gMCkgewogICAgdmFsdWVzW2xlbl0gPSBhcmd1bWVudHNbbGVuICsgMl07CiAgfQoKICByZXR1cm4gKHJlZiA9IHRoaXMpLl90Yy5hcHBseShyZWYsIFtrZXksIHRoaXMubG9jYWxlLCB0aGlzLl9nZXRNZXNzYWdlcygpLCBudWxsLCBjaG9pY2VdLmNvbmNhdCh2YWx1ZXMpKTsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLl90ZSA9IGZ1bmN0aW9uIF90ZShrZXksIGxvY2FsZSwgbWVzc2FnZXMpIHsKICB2YXIgYXJncyA9IFtdLAogICAgICBsZW4gPSBhcmd1bWVudHMubGVuZ3RoIC0gMzsKCiAgd2hpbGUgKGxlbi0tID4gMCkgewogICAgYXJnc1tsZW5dID0gYXJndW1lbnRzW2xlbiArIDNdOwogIH0KCiAgdmFyIF9sb2NhbGUgPSBwYXJzZUFyZ3MuYXBwbHkodm9pZCAwLCBhcmdzKS5sb2NhbGUgfHwgbG9jYWxlOwoKICByZXR1cm4gdGhpcy5fZXhpc3QobWVzc2FnZXNbX2xvY2FsZV0sIGtleSk7Cn07CgpWdWVJMThuLnByb3RvdHlwZS50ZSA9IGZ1bmN0aW9uIHRlKGtleSwgbG9jYWxlKSB7CiAgcmV0dXJuIHRoaXMuX3RlKGtleSwgdGhpcy5sb2NhbGUsIHRoaXMuX2dldE1lc3NhZ2VzKCksIGxvY2FsZSk7Cn07CgpWdWVJMThuLnByb3RvdHlwZS5nZXRMb2NhbGVNZXNzYWdlID0gZnVuY3Rpb24gZ2V0TG9jYWxlTWVzc2FnZShsb2NhbGUpIHsKICByZXR1cm4gbG9vc2VDbG9uZSh0aGlzLl92bS5tZXNzYWdlc1tsb2NhbGVdIHx8IHt9KTsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLnNldExvY2FsZU1lc3NhZ2UgPSBmdW5jdGlvbiBzZXRMb2NhbGVNZXNzYWdlKGxvY2FsZSwgbWVzc2FnZSkgewogIGlmICh0aGlzLl93YXJuSHRtbEluTWVzc2FnZSA9PT0gJ3dhcm4nIHx8IHRoaXMuX3dhcm5IdG1sSW5NZXNzYWdlID09PSAnZXJyb3InKSB7CiAgICB0aGlzLl9jaGVja0xvY2FsZU1lc3NhZ2UobG9jYWxlLCB0aGlzLl93YXJuSHRtbEluTWVzc2FnZSwgbWVzc2FnZSk7CiAgfQoKICB0aGlzLl92bS4kc2V0KHRoaXMuX3ZtLm1lc3NhZ2VzLCBsb2NhbGUsIG1lc3NhZ2UpOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUubWVyZ2VMb2NhbGVNZXNzYWdlID0gZnVuY3Rpb24gbWVyZ2VMb2NhbGVNZXNzYWdlKGxvY2FsZSwgbWVzc2FnZSkgewogIGlmICh0aGlzLl93YXJuSHRtbEluTWVzc2FnZSA9PT0gJ3dhcm4nIHx8IHRoaXMuX3dhcm5IdG1sSW5NZXNzYWdlID09PSAnZXJyb3InKSB7CiAgICB0aGlzLl9jaGVja0xvY2FsZU1lc3NhZ2UobG9jYWxlLCB0aGlzLl93YXJuSHRtbEluTWVzc2FnZSwgbWVzc2FnZSk7CiAgfQoKICB0aGlzLl92bS4kc2V0KHRoaXMuX3ZtLm1lc3NhZ2VzLCBsb2NhbGUsIG1lcmdlKHR5cGVvZiB0aGlzLl92bS5tZXNzYWdlc1tsb2NhbGVdICE9PSAndW5kZWZpbmVkJyAmJiBPYmplY3Qua2V5cyh0aGlzLl92bS5tZXNzYWdlc1tsb2NhbGVdKS5sZW5ndGggPyB0aGlzLl92bS5tZXNzYWdlc1tsb2NhbGVdIDoge30sIG1lc3NhZ2UpKTsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLmdldERhdGVUaW1lRm9ybWF0ID0gZnVuY3Rpb24gZ2V0RGF0ZVRpbWVGb3JtYXQobG9jYWxlKSB7CiAgcmV0dXJuIGxvb3NlQ2xvbmUodGhpcy5fdm0uZGF0ZVRpbWVGb3JtYXRzW2xvY2FsZV0gfHwge30pOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUuc2V0RGF0ZVRpbWVGb3JtYXQgPSBmdW5jdGlvbiBzZXREYXRlVGltZUZvcm1hdChsb2NhbGUsIGZvcm1hdCkgewogIHRoaXMuX3ZtLiRzZXQodGhpcy5fdm0uZGF0ZVRpbWVGb3JtYXRzLCBsb2NhbGUsIGZvcm1hdCk7CgogIHRoaXMuX2NsZWFyRGF0ZVRpbWVGb3JtYXQobG9jYWxlLCBmb3JtYXQpOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUubWVyZ2VEYXRlVGltZUZvcm1hdCA9IGZ1bmN0aW9uIG1lcmdlRGF0ZVRpbWVGb3JtYXQobG9jYWxlLCBmb3JtYXQpIHsKICB0aGlzLl92bS4kc2V0KHRoaXMuX3ZtLmRhdGVUaW1lRm9ybWF0cywgbG9jYWxlLCBtZXJnZSh0aGlzLl92bS5kYXRlVGltZUZvcm1hdHNbbG9jYWxlXSB8fCB7fSwgZm9ybWF0KSk7CgogIHRoaXMuX2NsZWFyRGF0ZVRpbWVGb3JtYXQobG9jYWxlLCBmb3JtYXQpOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUuX2NsZWFyRGF0ZVRpbWVGb3JtYXQgPSBmdW5jdGlvbiBfY2xlYXJEYXRlVGltZUZvcm1hdChsb2NhbGUsIGZvcm1hdCkgewogIGZvciAodmFyIGtleSBpbiBmb3JtYXQpIHsKICAgIHZhciBpZCA9IGxvY2FsZSArICJfXyIgKyBrZXk7CgogICAgaWYgKCF0aGlzLl9kYXRlVGltZUZvcm1hdHRlcnMuaGFzT3duUHJvcGVydHkoaWQpKSB7CiAgICAgIGNvbnRpbnVlOwogICAgfQoKICAgIGRlbGV0ZSB0aGlzLl9kYXRlVGltZUZvcm1hdHRlcnNbaWRdOwogIH0KfTsKClZ1ZUkxOG4ucHJvdG90eXBlLl9sb2NhbGl6ZURhdGVUaW1lID0gZnVuY3Rpb24gX2xvY2FsaXplRGF0ZVRpbWUodmFsdWUsIGxvY2FsZSwgZmFsbGJhY2ssIGRhdGVUaW1lRm9ybWF0cywga2V5KSB7CiAgdmFyIF9sb2NhbGUgPSBsb2NhbGU7CiAgdmFyIGZvcm1hdHMgPSBkYXRlVGltZUZvcm1hdHNbX2xvY2FsZV07CgogIHZhciBjaGFpbiA9IHRoaXMuX2dldExvY2FsZUNoYWluKGxvY2FsZSwgZmFsbGJhY2spOwoKICBmb3IgKHZhciBpID0gMDsgaSA8IGNoYWluLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgY3VycmVudCA9IF9sb2NhbGU7CiAgICB2YXIgc3RlcCA9IGNoYWluW2ldOwogICAgZm9ybWF0cyA9IGRhdGVUaW1lRm9ybWF0c1tzdGVwXTsKICAgIF9sb2NhbGUgPSBzdGVwOyAvLyBmYWxsYmFjayBsb2NhbGUKCiAgICBpZiAoaXNOdWxsKGZvcm1hdHMpIHx8IGlzTnVsbChmb3JtYXRzW2tleV0pKSB7CiAgICAgIGlmIChzdGVwICE9PSBsb2NhbGUgJiYgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJyAmJiAhdGhpcy5faXNTaWxlbnRUcmFuc2xhdGlvbldhcm4oa2V5KSAmJiAhdGhpcy5faXNTaWxlbnRGYWxsYmFja1dhcm4oa2V5KSkgewogICAgICAgIHdhcm4oIkZhbGwgYmFjayB0byAnIiArIHN0ZXAgKyAiJyBkYXRldGltZSBmb3JtYXRzIGZyb20gJyIgKyBjdXJyZW50ICsgIicgZGF0ZXRpbWUgZm9ybWF0cy4iKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgYnJlYWs7CiAgICB9CiAgfQoKICBpZiAoaXNOdWxsKGZvcm1hdHMpIHx8IGlzTnVsbChmb3JtYXRzW2tleV0pKSB7CiAgICByZXR1cm4gbnVsbDsKICB9IGVsc2UgewogICAgdmFyIGZvcm1hdCA9IGZvcm1hdHNba2V5XTsKICAgIHZhciBpZCA9IF9sb2NhbGUgKyAiX18iICsga2V5OwogICAgdmFyIGZvcm1hdHRlciA9IHRoaXMuX2RhdGVUaW1lRm9ybWF0dGVyc1tpZF07CgogICAgaWYgKCFmb3JtYXR0ZXIpIHsKICAgICAgZm9ybWF0dGVyID0gdGhpcy5fZGF0ZVRpbWVGb3JtYXR0ZXJzW2lkXSA9IG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KF9sb2NhbGUsIGZvcm1hdCk7CiAgICB9CgogICAgcmV0dXJuIGZvcm1hdHRlci5mb3JtYXQodmFsdWUpOwogIH0KfTsKClZ1ZUkxOG4ucHJvdG90eXBlLl9kID0gZnVuY3Rpb24gX2QodmFsdWUsIGxvY2FsZSwga2V5KSB7CiAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicgJiYgIVZ1ZUkxOG4uYXZhaWxhYmlsaXRpZXMuZGF0ZVRpbWVGb3JtYXQpIHsKICAgIHdhcm4oJ0Nhbm5vdCBmb3JtYXQgYSBEYXRlIHZhbHVlIGR1ZSB0byBub3Qgc3VwcG9ydGVkIEludGwuRGF0ZVRpbWVGb3JtYXQuJyk7CiAgICByZXR1cm4gJyc7CiAgfQoKICBpZiAoIWtleSkgewogICAgcmV0dXJuIG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KGxvY2FsZSkuZm9ybWF0KHZhbHVlKTsKICB9CgogIHZhciByZXQgPSB0aGlzLl9sb2NhbGl6ZURhdGVUaW1lKHZhbHVlLCBsb2NhbGUsIHRoaXMuZmFsbGJhY2tMb2NhbGUsIHRoaXMuX2dldERhdGVUaW1lRm9ybWF0cygpLCBrZXkpOwoKICBpZiAodGhpcy5faXNGYWxsYmFja1Jvb3QocmV0KSkgewogICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicgJiYgIXRoaXMuX2lzU2lsZW50VHJhbnNsYXRpb25XYXJuKGtleSkgJiYgIXRoaXMuX2lzU2lsZW50RmFsbGJhY2tXYXJuKGtleSkpIHsKICAgICAgd2FybigiRmFsbCBiYWNrIHRvIGRhdGV0aW1lIGxvY2FsaXphdGlvbiBvZiByb290OiBrZXkgJyIgKyBrZXkgKyAiJy4iKTsKICAgIH0KICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwoKCiAgICBpZiAoIXRoaXMuX3Jvb3QpIHsKICAgICAgdGhyb3cgRXJyb3IoJ3VuZXhwZWN0ZWQgZXJyb3InKTsKICAgIH0KCiAgICByZXR1cm4gdGhpcy5fcm9vdC4kaTE4bi5kKHZhbHVlLCBrZXksIGxvY2FsZSk7CiAgfSBlbHNlIHsKICAgIHJldHVybiByZXQgfHwgJyc7CiAgfQp9OwoKVnVlSTE4bi5wcm90b3R5cGUuZCA9IGZ1bmN0aW9uIGQodmFsdWUpIHsKICB2YXIgYXJncyA9IFtdLAogICAgICBsZW4gPSBhcmd1bWVudHMubGVuZ3RoIC0gMTsKCiAgd2hpbGUgKGxlbi0tID4gMCkgewogICAgYXJnc1tsZW5dID0gYXJndW1lbnRzW2xlbiArIDFdOwogIH0KCiAgdmFyIGxvY2FsZSA9IHRoaXMubG9jYWxlOwogIHZhciBrZXkgPSBudWxsOwoKICBpZiAoYXJncy5sZW5ndGggPT09IDEpIHsKICAgIGlmIChpc1N0cmluZyhhcmdzWzBdKSkgewogICAgICBrZXkgPSBhcmdzWzBdOwogICAgfSBlbHNlIGlmIChpc09iamVjdChhcmdzWzBdKSkgewogICAgICBpZiAoYXJnc1swXS5sb2NhbGUpIHsKICAgICAgICBsb2NhbGUgPSBhcmdzWzBdLmxvY2FsZTsKICAgICAgfQoKICAgICAgaWYgKGFyZ3NbMF0ua2V5KSB7CiAgICAgICAga2V5ID0gYXJnc1swXS5rZXk7CiAgICAgIH0KICAgIH0KICB9IGVsc2UgaWYgKGFyZ3MubGVuZ3RoID09PSAyKSB7CiAgICBpZiAoaXNTdHJpbmcoYXJnc1swXSkpIHsKICAgICAga2V5ID0gYXJnc1swXTsKICAgIH0KCiAgICBpZiAoaXNTdHJpbmcoYXJnc1sxXSkpIHsKICAgICAgbG9jYWxlID0gYXJnc1sxXTsKICAgIH0KICB9CgogIHJldHVybiB0aGlzLl9kKHZhbHVlLCBsb2NhbGUsIGtleSk7Cn07CgpWdWVJMThuLnByb3RvdHlwZS5nZXROdW1iZXJGb3JtYXQgPSBmdW5jdGlvbiBnZXROdW1iZXJGb3JtYXQobG9jYWxlKSB7CiAgcmV0dXJuIGxvb3NlQ2xvbmUodGhpcy5fdm0ubnVtYmVyRm9ybWF0c1tsb2NhbGVdIHx8IHt9KTsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLnNldE51bWJlckZvcm1hdCA9IGZ1bmN0aW9uIHNldE51bWJlckZvcm1hdChsb2NhbGUsIGZvcm1hdCkgewogIHRoaXMuX3ZtLiRzZXQodGhpcy5fdm0ubnVtYmVyRm9ybWF0cywgbG9jYWxlLCBmb3JtYXQpOwoKICB0aGlzLl9jbGVhck51bWJlckZvcm1hdChsb2NhbGUsIGZvcm1hdCk7Cn07CgpWdWVJMThuLnByb3RvdHlwZS5tZXJnZU51bWJlckZvcm1hdCA9IGZ1bmN0aW9uIG1lcmdlTnVtYmVyRm9ybWF0KGxvY2FsZSwgZm9ybWF0KSB7CiAgdGhpcy5fdm0uJHNldCh0aGlzLl92bS5udW1iZXJGb3JtYXRzLCBsb2NhbGUsIG1lcmdlKHRoaXMuX3ZtLm51bWJlckZvcm1hdHNbbG9jYWxlXSB8fCB7fSwgZm9ybWF0KSk7CgogIHRoaXMuX2NsZWFyTnVtYmVyRm9ybWF0KGxvY2FsZSwgZm9ybWF0KTsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLl9jbGVhck51bWJlckZvcm1hdCA9IGZ1bmN0aW9uIF9jbGVhck51bWJlckZvcm1hdChsb2NhbGUsIGZvcm1hdCkgewogIGZvciAodmFyIGtleSBpbiBmb3JtYXQpIHsKICAgIHZhciBpZCA9IGxvY2FsZSArICJfXyIgKyBrZXk7CgogICAgaWYgKCF0aGlzLl9udW1iZXJGb3JtYXR0ZXJzLmhhc093blByb3BlcnR5KGlkKSkgewogICAgICBjb250aW51ZTsKICAgIH0KCiAgICBkZWxldGUgdGhpcy5fbnVtYmVyRm9ybWF0dGVyc1tpZF07CiAgfQp9OwoKVnVlSTE4bi5wcm90b3R5cGUuX2dldE51bWJlckZvcm1hdHRlciA9IGZ1bmN0aW9uIF9nZXROdW1iZXJGb3JtYXR0ZXIodmFsdWUsIGxvY2FsZSwgZmFsbGJhY2ssIG51bWJlckZvcm1hdHMsIGtleSwgb3B0aW9ucykgewogIHZhciBfbG9jYWxlID0gbG9jYWxlOwogIHZhciBmb3JtYXRzID0gbnVtYmVyRm9ybWF0c1tfbG9jYWxlXTsKCiAgdmFyIGNoYWluID0gdGhpcy5fZ2V0TG9jYWxlQ2hhaW4obG9jYWxlLCBmYWxsYmFjayk7CgogIGZvciAodmFyIGkgPSAwOyBpIDwgY2hhaW4ubGVuZ3RoOyBpKyspIHsKICAgIHZhciBjdXJyZW50ID0gX2xvY2FsZTsKICAgIHZhciBzdGVwID0gY2hhaW5baV07CiAgICBmb3JtYXRzID0gbnVtYmVyRm9ybWF0c1tzdGVwXTsKICAgIF9sb2NhbGUgPSBzdGVwOyAvLyBmYWxsYmFjayBsb2NhbGUKCiAgICBpZiAoaXNOdWxsKGZvcm1hdHMpIHx8IGlzTnVsbChmb3JtYXRzW2tleV0pKSB7CiAgICAgIGlmIChzdGVwICE9PSBsb2NhbGUgJiYgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJyAmJiAhdGhpcy5faXNTaWxlbnRUcmFuc2xhdGlvbldhcm4oa2V5KSAmJiAhdGhpcy5faXNTaWxlbnRGYWxsYmFja1dhcm4oa2V5KSkgewogICAgICAgIHdhcm4oIkZhbGwgYmFjayB0byAnIiArIHN0ZXAgKyAiJyBudW1iZXIgZm9ybWF0cyBmcm9tICciICsgY3VycmVudCArICInIG51bWJlciBmb3JtYXRzLiIpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBicmVhazsKICAgIH0KICB9CgogIGlmIChpc051bGwoZm9ybWF0cykgfHwgaXNOdWxsKGZvcm1hdHNba2V5XSkpIHsKICAgIHJldHVybiBudWxsOwogIH0gZWxzZSB7CiAgICB2YXIgZm9ybWF0ID0gZm9ybWF0c1trZXldOwogICAgdmFyIGZvcm1hdHRlcjsKCiAgICBpZiAob3B0aW9ucykgewogICAgICAvLyBJZiBvcHRpb25zIHNwZWNpZmllZCAtIGNyZWF0ZSBvbmUgdGltZSBudW1iZXIgZm9ybWF0dGVyCiAgICAgIGZvcm1hdHRlciA9IG5ldyBJbnRsLk51bWJlckZvcm1hdChfbG9jYWxlLCBPYmplY3QuYXNzaWduKHt9LCBmb3JtYXQsIG9wdGlvbnMpKTsKICAgIH0gZWxzZSB7CiAgICAgIHZhciBpZCA9IF9sb2NhbGUgKyAiX18iICsga2V5OwogICAgICBmb3JtYXR0ZXIgPSB0aGlzLl9udW1iZXJGb3JtYXR0ZXJzW2lkXTsKCiAgICAgIGlmICghZm9ybWF0dGVyKSB7CiAgICAgICAgZm9ybWF0dGVyID0gdGhpcy5fbnVtYmVyRm9ybWF0dGVyc1tpZF0gPSBuZXcgSW50bC5OdW1iZXJGb3JtYXQoX2xvY2FsZSwgZm9ybWF0KTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBmb3JtYXR0ZXI7CiAgfQp9OwoKVnVlSTE4bi5wcm90b3R5cGUuX24gPSBmdW5jdGlvbiBfbih2YWx1ZSwgbG9jYWxlLCBrZXksIG9wdGlvbnMpIHsKICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICBpZiAoIVZ1ZUkxOG4uYXZhaWxhYmlsaXRpZXMubnVtYmVyRm9ybWF0KSB7CiAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgewogICAgICB3YXJuKCdDYW5ub3QgZm9ybWF0IGEgTnVtYmVyIHZhbHVlIGR1ZSB0byBub3Qgc3VwcG9ydGVkIEludGwuTnVtYmVyRm9ybWF0LicpOwogICAgfQoKICAgIHJldHVybiAnJzsKICB9CgogIGlmICgha2V5KSB7CiAgICB2YXIgbmYgPSAhb3B0aW9ucyA/IG5ldyBJbnRsLk51bWJlckZvcm1hdChsb2NhbGUpIDogbmV3IEludGwuTnVtYmVyRm9ybWF0KGxvY2FsZSwgb3B0aW9ucyk7CiAgICByZXR1cm4gbmYuZm9ybWF0KHZhbHVlKTsKICB9CgogIHZhciBmb3JtYXR0ZXIgPSB0aGlzLl9nZXROdW1iZXJGb3JtYXR0ZXIodmFsdWUsIGxvY2FsZSwgdGhpcy5mYWxsYmFja0xvY2FsZSwgdGhpcy5fZ2V0TnVtYmVyRm9ybWF0cygpLCBrZXksIG9wdGlvbnMpOwoKICB2YXIgcmV0ID0gZm9ybWF0dGVyICYmIGZvcm1hdHRlci5mb3JtYXQodmFsdWUpOwoKICBpZiAodGhpcy5faXNGYWxsYmFja1Jvb3QocmV0KSkgewogICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicgJiYgIXRoaXMuX2lzU2lsZW50VHJhbnNsYXRpb25XYXJuKGtleSkgJiYgIXRoaXMuX2lzU2lsZW50RmFsbGJhY2tXYXJuKGtleSkpIHsKICAgICAgd2FybigiRmFsbCBiYWNrIHRvIG51bWJlciBsb2NhbGl6YXRpb24gb2Ygcm9vdDoga2V5ICciICsga2V5ICsgIicuIik7CiAgICB9CiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KCgogICAgaWYgKCF0aGlzLl9yb290KSB7CiAgICAgIHRocm93IEVycm9yKCd1bmV4cGVjdGVkIGVycm9yJyk7CiAgICB9CgogICAgcmV0dXJuIHRoaXMuX3Jvb3QuJGkxOG4ubih2YWx1ZSwgT2JqZWN0LmFzc2lnbih7fSwgewogICAgICBrZXk6IGtleSwKICAgICAgbG9jYWxlOiBsb2NhbGUKICAgIH0sIG9wdGlvbnMpKTsKICB9IGVsc2UgewogICAgcmV0dXJuIHJldCB8fCAnJzsKICB9Cn07CgpWdWVJMThuLnByb3RvdHlwZS5uID0gZnVuY3Rpb24gbih2YWx1ZSkgewogIHZhciBhcmdzID0gW10sCiAgICAgIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGggLSAxOwoKICB3aGlsZSAobGVuLS0gPiAwKSB7CiAgICBhcmdzW2xlbl0gPSBhcmd1bWVudHNbbGVuICsgMV07CiAgfQoKICB2YXIgbG9jYWxlID0gdGhpcy5sb2NhbGU7CiAgdmFyIGtleSA9IG51bGw7CiAgdmFyIG9wdGlvbnMgPSBudWxsOwoKICBpZiAoYXJncy5sZW5ndGggPT09IDEpIHsKICAgIGlmIChpc1N0cmluZyhhcmdzWzBdKSkgewogICAgICBrZXkgPSBhcmdzWzBdOwogICAgfSBlbHNlIGlmIChpc09iamVjdChhcmdzWzBdKSkgewogICAgICBpZiAoYXJnc1swXS5sb2NhbGUpIHsKICAgICAgICBsb2NhbGUgPSBhcmdzWzBdLmxvY2FsZTsKICAgICAgfQoKICAgICAgaWYgKGFyZ3NbMF0ua2V5KSB7CiAgICAgICAga2V5ID0gYXJnc1swXS5rZXk7CiAgICAgIH0gLy8gRmlsdGVyIG91dCBudW1iZXIgZm9ybWF0IG9wdGlvbnMgb25seQoKCiAgICAgIG9wdGlvbnMgPSBPYmplY3Qua2V5cyhhcmdzWzBdKS5yZWR1Y2UoZnVuY3Rpb24gKGFjYywga2V5KSB7CiAgICAgICAgdmFyIG9iajsKCiAgICAgICAgaWYgKGluY2x1ZGVzKG51bWJlckZvcm1hdEtleXMsIGtleSkpIHsKICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKHt9LCBhY2MsIChvYmogPSB7fSwgb2JqW2tleV0gPSBhcmdzWzBdW2tleV0sIG9iaikpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGFjYzsKICAgICAgfSwgbnVsbCk7CiAgICB9CiAgfSBlbHNlIGlmIChhcmdzLmxlbmd0aCA9PT0gMikgewogICAgaWYgKGlzU3RyaW5nKGFyZ3NbMF0pKSB7CiAgICAgIGtleSA9IGFyZ3NbMF07CiAgICB9CgogICAgaWYgKGlzU3RyaW5nKGFyZ3NbMV0pKSB7CiAgICAgIGxvY2FsZSA9IGFyZ3NbMV07CiAgICB9CiAgfQoKICByZXR1cm4gdGhpcy5fbih2YWx1ZSwgbG9jYWxlLCBrZXksIG9wdGlvbnMpOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUuX250cCA9IGZ1bmN0aW9uIF9udHAodmFsdWUsIGxvY2FsZSwga2V5LCBvcHRpb25zKSB7CiAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgaWYgKCFWdWVJMThuLmF2YWlsYWJpbGl0aWVzLm51bWJlckZvcm1hdCkgewogICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHsKICAgICAgd2FybignQ2Fubm90IGZvcm1hdCB0byBwYXJ0cyBhIE51bWJlciB2YWx1ZSBkdWUgdG8gbm90IHN1cHBvcnRlZCBJbnRsLk51bWJlckZvcm1hdC4nKTsKICAgIH0KCiAgICByZXR1cm4gW107CiAgfQoKICBpZiAoIWtleSkgewogICAgdmFyIG5mID0gIW9wdGlvbnMgPyBuZXcgSW50bC5OdW1iZXJGb3JtYXQobG9jYWxlKSA6IG5ldyBJbnRsLk51bWJlckZvcm1hdChsb2NhbGUsIG9wdGlvbnMpOwogICAgcmV0dXJuIG5mLmZvcm1hdFRvUGFydHModmFsdWUpOwogIH0KCiAgdmFyIGZvcm1hdHRlciA9IHRoaXMuX2dldE51bWJlckZvcm1hdHRlcih2YWx1ZSwgbG9jYWxlLCB0aGlzLmZhbGxiYWNrTG9jYWxlLCB0aGlzLl9nZXROdW1iZXJGb3JtYXRzKCksIGtleSwgb3B0aW9ucyk7CgogIHZhciByZXQgPSBmb3JtYXR0ZXIgJiYgZm9ybWF0dGVyLmZvcm1hdFRvUGFydHModmFsdWUpOwoKICBpZiAodGhpcy5faXNGYWxsYmFja1Jvb3QocmV0KSkgewogICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicgJiYgIXRoaXMuX2lzU2lsZW50VHJhbnNsYXRpb25XYXJuKGtleSkpIHsKICAgICAgd2FybigiRmFsbCBiYWNrIHRvIGZvcm1hdCBudW1iZXIgdG8gcGFydHMgb2Ygcm9vdDoga2V5ICciICsga2V5ICsgIicgLiIpOwogICAgfQogICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCgoKICAgIGlmICghdGhpcy5fcm9vdCkgewogICAgICB0aHJvdyBFcnJvcigndW5leHBlY3RlZCBlcnJvcicpOwogICAgfQoKICAgIHJldHVybiB0aGlzLl9yb290LiRpMThuLl9udHAodmFsdWUsIGxvY2FsZSwga2V5LCBvcHRpb25zKTsKICB9IGVsc2UgewogICAgcmV0dXJuIHJldCB8fCBbXTsKICB9Cn07CgpPYmplY3QuZGVmaW5lUHJvcGVydGllcyhWdWVJMThuLnByb3RvdHlwZSwgcHJvdG90eXBlQWNjZXNzb3JzKTsKdmFyIGF2YWlsYWJpbGl0aWVzOyAvLyAkRmxvd0ZpeE1lCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoVnVlSTE4biwgJ2F2YWlsYWJpbGl0aWVzJywgewogIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgaWYgKCFhdmFpbGFiaWxpdGllcykgewogICAgICB2YXIgaW50bERlZmluZWQgPSB0eXBlb2YgSW50bCAhPT0gJ3VuZGVmaW5lZCc7CiAgICAgIGF2YWlsYWJpbGl0aWVzID0gewogICAgICAgIGRhdGVUaW1lRm9ybWF0OiBpbnRsRGVmaW5lZCAmJiB0eXBlb2YgSW50bC5EYXRlVGltZUZvcm1hdCAhPT0gJ3VuZGVmaW5lZCcsCiAgICAgICAgbnVtYmVyRm9ybWF0OiBpbnRsRGVmaW5lZCAmJiB0eXBlb2YgSW50bC5OdW1iZXJGb3JtYXQgIT09ICd1bmRlZmluZWQnCiAgICAgIH07CiAgICB9CgogICAgcmV0dXJuIGF2YWlsYWJpbGl0aWVzOwogIH0KfSk7ClZ1ZUkxOG4uaW5zdGFsbCA9IGluc3RhbGw7ClZ1ZUkxOG4udmVyc2lvbiA9ICc4LjI0LjQnOwpleHBvcnQgZGVmYXVsdCBWdWVJMThuOw=="},null]}