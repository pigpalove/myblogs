{"remainingRequest":"D:\\vscodeprojects\\vuepress-theme-reco\\myblogs\\node_modules\\babel-loader\\lib\\index.js??ref--3-1!D:\\vscodeprojects\\vuepress-theme-reco\\myblogs\\node_modules\\@vssue\\api-github-v3\\lib\\index.js","dependencies":[{"path":"D:\\vscodeprojects\\vuepress-theme-reco\\myblogs\\node_modules\\@vssue\\api-github-v3\\lib\\index.js","mtime":499162500000},{"path":"D:\\vscodeprojects\\vuepress-theme-reco\\myblogs\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\vscodeprojects\\vuepress-theme-reco\\myblogs\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9zbGljZWRUb0FycmF5IGZyb20gIkQ6L3ZzY29kZXByb2plY3RzL3Z1ZXByZXNzLXRoZW1lLXJlY28vbXlibG9ncy9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vc2xpY2VkVG9BcnJheSI7CmltcG9ydCBfdG9Db25zdW1hYmxlQXJyYXkgZnJvbSAiRDovdnNjb2RlcHJvamVjdHMvdnVlcHJlc3MtdGhlbWUtcmVjby9teWJsb2dzL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS90b0NvbnN1bWFibGVBcnJheSI7CmltcG9ydCBfYXN5bmNUb0dlbmVyYXRvciBmcm9tICJEOi92c2NvZGVwcm9qZWN0cy92dWVwcmVzcy10aGVtZS1yZWNvL215YmxvZ3Mvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2FzeW5jVG9HZW5lcmF0b3IiOwppbXBvcnQgX2NsYXNzQ2FsbENoZWNrIGZyb20gIkQ6L3ZzY29kZXByb2plY3RzL3Z1ZXByZXNzLXRoZW1lLXJlY28vbXlibG9ncy9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY2xhc3NDYWxsQ2hlY2siOwppbXBvcnQgX2NyZWF0ZUNsYXNzIGZyb20gIkQ6L3ZzY29kZXByb2plY3RzL3Z1ZXByZXNzLXRoZW1lLXJlY28vbXlibG9ncy9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlQ2xhc3MiOwppbXBvcnQgInJlZ2VuZXJhdG9yLXJ1bnRpbWUvcnVudGltZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmcuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zZWFyY2guanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5kYXRlLm5vdy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmRhdGUudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuam9pbi5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5Lm1hcC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbmQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuaXRlcmF0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLml0ZXJhdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLmxpbmsuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5udW1iZXIuY29uc3RydWN0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcucmVwbGFjZS5qcyI7CmltcG9ydCBheGlvcyBmcm9tICdheGlvcyc7CmltcG9ydCB7IGJ1aWxkVVJMLCBjb25jYXRVUkwsIGdldENsZWFuVVJMLCBwYXJzZVF1ZXJ5IH0gZnJvbSAnQHZzc3VlL3V0aWxzJzsKaW1wb3J0IHsgbm9ybWFsaXplVXNlciwgbm9ybWFsaXplSXNzdWUsIG5vcm1hbGl6ZUNvbW1lbnQsIG5vcm1hbGl6ZVJlYWN0aW9ucywgbWFwUmVhY3Rpb25OYW1lIH0gZnJvbSAnLi91dGlscyc7Ci8qKgogKiBHaXRodWIgUkVTVCBBUEkgdjMKICoKICogQHNlZSBodHRwczovL2RldmVsb3Blci5naXRodWIuY29tL3YzLwogKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmdpdGh1Yi5jb20vYXBwcy9idWlsZGluZy1vYXV0aC1hcHBzLwogKi8KCnZhciBHaXRodWJWMyA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgZnVuY3Rpb24gR2l0aHViVjMoX3JlZikgewogICAgdmFyIF9yZWYkYmFzZVVSTCA9IF9yZWYuYmFzZVVSTCwKICAgICAgICBiYXNlVVJMID0gX3JlZiRiYXNlVVJMID09PSB2b2lkIDAgPyAnaHR0cHM6Ly9naXRodWIuY29tJyA6IF9yZWYkYmFzZVVSTCwKICAgICAgICBvd25lciA9IF9yZWYub3duZXIsCiAgICAgICAgcmVwbyA9IF9yZWYucmVwbywKICAgICAgICBsYWJlbHMgPSBfcmVmLmxhYmVscywKICAgICAgICBjbGllbnRJZCA9IF9yZWYuY2xpZW50SWQsCiAgICAgICAgY2xpZW50U2VjcmV0ID0gX3JlZi5jbGllbnRTZWNyZXQsCiAgICAgICAgc3RhdGUgPSBfcmVmLnN0YXRlLAogICAgICAgIHByb3h5ID0gX3JlZi5wcm94eTsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgR2l0aHViVjMpOwoKICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgaWYgKHR5cGVvZiBjbGllbnRTZWNyZXQgPT09ICd1bmRlZmluZWQnIHx8IHR5cGVvZiBwcm94eSA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdjbGllbnRTZWNyZXQgYW5kIHByb3h5IGlzIHJlcXVpcmVkIGZvciBHaXRIdWIgVjMnKTsKICAgIH0KCiAgICB0aGlzLmJhc2VVUkwgPSBiYXNlVVJMOwogICAgdGhpcy5vd25lciA9IG93bmVyOwogICAgdGhpcy5yZXBvID0gcmVwbzsKICAgIHRoaXMubGFiZWxzID0gbGFiZWxzOwogICAgdGhpcy5jbGllbnRJZCA9IGNsaWVudElkOwogICAgdGhpcy5jbGllbnRTZWNyZXQgPSBjbGllbnRTZWNyZXQ7CiAgICB0aGlzLnN0YXRlID0gc3RhdGU7CiAgICB0aGlzLnByb3h5ID0gcHJveHk7CiAgICB0aGlzLiRodHRwID0gYXhpb3MuY3JlYXRlKHsKICAgICAgYmFzZVVSTDogYmFzZVVSTCA9PT0gJ2h0dHBzOi8vZ2l0aHViLmNvbScgPyAnaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbScgOiBjb25jYXRVUkwoYmFzZVVSTCwgJ2FwaS92MycpLAogICAgICBoZWFkZXJzOiB7CiAgICAgICAgQWNjZXB0OiAnYXBwbGljYXRpb24vdm5kLmdpdGh1Yi52Mytqc29uJwogICAgICB9CiAgICB9KTsKICAgIHRoaXMuJGh0dHAuaW50ZXJjZXB0b3JzLnJlc3BvbnNlLnVzZShmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgJiYgcmVzcG9uc2UuZGF0YS5lcnJvcikgewogICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IocmVzcG9uc2UuZGF0YS5lcnJvcl9kZXNjcmlwdGlvbikpOwogICAgICB9CgogICAgICByZXR1cm4gcmVzcG9uc2U7CiAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgLy8gNDAzIHJhdGUgbGltaXQgZXhjZWVkZWQgaW4gT1BUSU9OUyByZXF1ZXN0IHdpbGwgY2F1c2UgYSBOZXR3b3JrIEVycm9yCiAgICAgIC8vIGhlcmUgd2UgYWx3YXlzIHRyZWF0IE5ldHdvcmsgRXJyb3IgYXMgNDAzIHJhdGUgbGltaXQgZXhjZWVkZWQKICAgICAgLy8gQHNlZSBodHRwczovL2dpdGh1Yi5jb20vYXhpb3MvYXhpb3MvaXNzdWVzLzgzOAoKICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KICAgICAgaWYgKHR5cGVvZiBlcnJvci5yZXNwb25zZSA9PT0gJ3VuZGVmaW5lZCcgJiYgZXJyb3IubWVzc2FnZSA9PT0gJ05ldHdvcmsgRXJyb3InKSB7CiAgICAgICAgZXJyb3IucmVzcG9uc2UgPSB7CiAgICAgICAgICBzdGF0dXM6IDQwMwogICAgICAgIH07CiAgICAgIH0KCiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7CiAgICB9KTsKICB9CiAgLyoqCiAgICogVGhlIHBsYXRmb3JtIGFwaSBpbmZvCiAgICovCgoKICBfY3JlYXRlQ2xhc3MoR2l0aHViVjMsIFt7CiAgICBrZXk6ICJwbGF0Zm9ybSIsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBuYW1lOiAnR2l0SHViJywKICAgICAgICBsaW5rOiB0aGlzLmJhc2VVUkwsCiAgICAgICAgdmVyc2lvbjogJ3YzJywKICAgICAgICBtZXRhOiB7CiAgICAgICAgICByZWFjdGFibGU6IHRydWUsCiAgICAgICAgICBzb3J0YWJsZTogZmFsc2UKICAgICAgICB9CiAgICAgIH07CiAgICB9CiAgICAvKioKICAgICAqIFJlZGlyZWN0IHRvIHRoZSBhdXRob3JpemF0aW9uIHBhZ2Ugb2YgcGxhdGZvcm0uCiAgICAgKgogICAgICogQHNlZSBodHRwczovL2RldmVsb3Blci5naXRodWIuY29tL2FwcHMvYnVpbGRpbmctb2F1dGgtYXBwcy9hdXRob3JpemluZy1vYXV0aC1hcHBzLyMxLXJlcXVlc3QtYS11c2Vycy1naXRodWItaWRlbnRpdHkKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJyZWRpcmVjdEF1dGgiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlZGlyZWN0QXV0aCgpIHsKICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBidWlsZFVSTChjb25jYXRVUkwodGhpcy5iYXNlVVJMLCAnbG9naW4vb2F1dGgvYXV0aG9yaXplJyksIHsKICAgICAgICBjbGllbnRfaWQ6IHRoaXMuY2xpZW50SWQsCiAgICAgICAgcmVkaXJlY3RfdXJpOiB3aW5kb3cubG9jYXRpb24uaHJlZiwKICAgICAgICBzY29wZTogJ3B1YmxpY19yZXBvJywKICAgICAgICBzdGF0ZTogdGhpcy5zdGF0ZQogICAgICB9KTsKICAgIH0KICAgIC8qKgogICAgICogSGFuZGxlIGF1dGhvcml6YXRpb24uCiAgICAgKgogICAgICogQHNlZSBodHRwczovL2RldmVsb3Blci5naXRodWIuY29tL2FwcHMvYnVpbGRpbmctb2F1dGgtYXBwcy9hdXRob3JpemluZy1vYXV0aC1hcHBzLwogICAgICoKICAgICAqIEByZW1hcmtzCiAgICAgKiBJZiB0aGUgYGNvZGVgIGFuZCBgc3RhdGVgIGV4aXN0IGluIHRoZSBxdWVyeSwgYW5kIHRoZSBgc3RhdGVgIG1hdGNoZXMsIHJlbW92ZSB0aGVtIGZyb20gcXVlcnksIGFuZCB0cnkgdG8gZ2V0IHRoZSBhY2Nlc3MgdG9rZW4uCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiaGFuZGxlQXV0aCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2hhbmRsZUF1dGggPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICAgICAgdmFyIHF1ZXJ5LCBjb2RlLCByZXBsYWNlVVJMLCBhY2Nlc3NUb2tlbjsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBxdWVyeSA9IHBhcnNlUXVlcnkod2luZG93LmxvY2F0aW9uLnNlYXJjaCk7CgogICAgICAgICAgICAgICAgaWYgKCFxdWVyeS5jb2RlKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxMzsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCEocXVlcnkuc3RhdGUgIT09IHRoaXMuc3RhdGUpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA0OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBudWxsKTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgY29kZSA9IHF1ZXJ5LmNvZGU7CiAgICAgICAgICAgICAgICBkZWxldGUgcXVlcnkuY29kZTsKICAgICAgICAgICAgICAgIGRlbGV0ZSBxdWVyeS5zdGF0ZTsKICAgICAgICAgICAgICAgIHJlcGxhY2VVUkwgPSBidWlsZFVSTChnZXRDbGVhblVSTCh3aW5kb3cubG9jYXRpb24uaHJlZiksIHF1ZXJ5KSArIHdpbmRvdy5sb2NhdGlvbi5oYXNoOwogICAgICAgICAgICAgICAgd2luZG93Lmhpc3RvcnkucmVwbGFjZVN0YXRlKG51bGwsICcnLCByZXBsYWNlVVJMKTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxMTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEFjY2Vzc1Rva2VuKHsKICAgICAgICAgICAgICAgICAgY29kZTogY29kZQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgICBhY2Nlc3NUb2tlbiA9IF9jb250ZXh0LnNlbnQ7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBhY2Nlc3NUb2tlbik7CgogICAgICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBudWxsKTsKCiAgICAgICAgICAgICAgY2FzZSAxNDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBoYW5kbGVBdXRoKCkgewogICAgICAgIHJldHVybiBfaGFuZGxlQXV0aC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gaGFuZGxlQXV0aDsKICAgIH0oKQogICAgLyoqCiAgICAgKiBHZXQgdXNlciBhY2Nlc3MgdG9rZW4gdmlhIGBjb2RlYAogICAgICoKICAgICAqIEBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIuZ2l0aHViLmNvbS9hcHBzL2J1aWxkaW5nLW9hdXRoLWFwcHMvYXV0aG9yaXppbmctb2F1dGgtYXBwcy8jMi11c2Vycy1hcmUtcmVkaXJlY3RlZC1iYWNrLXRvLXlvdXItc2l0ZS1ieS1naXRodWIKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRBY2Nlc3NUb2tlbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2dldEFjY2Vzc1Rva2VuID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMihfcmVmMikgewogICAgICAgIHZhciBjb2RlLCBvcmlnaW5hbFVSTCwgcHJveHlVUkwsIF95aWVsZCR0aGlzJCRodHRwJHBvcywgZGF0YTsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvZGUgPSBfcmVmMi5jb2RlOwoKICAgICAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgICAgICogYWNjZXNzX3Rva2VuIGFwaSBkb2VzIG5vdCBzdXBwb3J0IGNvcnMKICAgICAgICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2lzYWFjcy9naXRodWIvaXNzdWVzLzMzMAogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICBvcmlnaW5hbFVSTCA9IGNvbmNhdFVSTCh0aGlzLmJhc2VVUkwsICdsb2dpbi9vYXV0aC9hY2Nlc3NfdG9rZW4nKTsKICAgICAgICAgICAgICAgIHByb3h5VVJMID0gdHlwZW9mIHRoaXMucHJveHkgPT09ICdmdW5jdGlvbicgPyB0aGlzLnByb3h5KG9yaWdpbmFsVVJMKSA6IHRoaXMucHJveHk7CiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDU7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kaHR0cC5wb3N0KHByb3h5VVJMLCB7CiAgICAgICAgICAgICAgICAgIGNsaWVudF9pZDogdGhpcy5jbGllbnRJZCwKICAgICAgICAgICAgICAgICAgY2xpZW50X3NlY3JldDogdGhpcy5jbGllbnRTZWNyZXQsCiAgICAgICAgICAgICAgICAgIGNvZGU6IGNvZGUKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICAgIEFjY2VwdDogJ2FwcGxpY2F0aW9uL2pzb24nCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICBfeWllbGQkdGhpcyQkaHR0cCRwb3MgPSBfY29udGV4dDIuc2VudDsKICAgICAgICAgICAgICAgIGRhdGEgPSBfeWllbGQkdGhpcyQkaHR0cCRwb3MuZGF0YTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCBkYXRhLmFjY2Vzc190b2tlbik7CgogICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMiwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGdldEFjY2Vzc1Rva2VuKF94KSB7CiAgICAgICAgcmV0dXJuIF9nZXRBY2Nlc3NUb2tlbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gZ2V0QWNjZXNzVG9rZW47CiAgICB9KCkKICAgIC8qKgogICAgICogR2V0IHRoZSBsb2dnZWQtaW4gdXNlciB3aXRoIGFjY2VzcyB0b2tlbi4KICAgICAqCiAgICAgKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmdpdGh1Yi5jb20vdjMvdXNlcnMvI2dldC10aGUtYXV0aGVudGljYXRlZC11c2VyCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0VXNlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2dldFVzZXIgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKF9yZWYzKSB7CiAgICAgICAgdmFyIGFjY2Vzc1Rva2VuLCBfeWllbGQkdGhpcyQkaHR0cCRnZXQsIGRhdGE7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0My5wcmV2ID0gX2NvbnRleHQzLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBhY2Nlc3NUb2tlbiA9IF9yZWYzLmFjY2Vzc1Rva2VuOwogICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAzOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGh0dHAuZ2V0KCd1c2VyJywgewogICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogInRva2VuICIuY29uY2F0KGFjY2Vzc1Rva2VuKQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgX3lpZWxkJHRoaXMkJGh0dHAkZ2V0ID0gX2NvbnRleHQzLnNlbnQ7CiAgICAgICAgICAgICAgICBkYXRhID0gX3lpZWxkJHRoaXMkJGh0dHAkZ2V0LmRhdGE7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLmFicnVwdCgicmV0dXJuIiwgbm9ybWFsaXplVXNlcihkYXRhKSk7CgogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMywgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGdldFVzZXIoX3gyKSB7CiAgICAgICAgcmV0dXJuIF9nZXRVc2VyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBnZXRVc2VyOwogICAgfSgpCiAgICAvKioKICAgICAqIEdldCBpc3N1ZSBvZiB0aGlzIHBhZ2UgYWNjb3JkaW5nIHRvIHRoZSBpc3N1ZSBpZCBvciB0aGUgaXNzdWUgdGl0bGUKICAgICAqCiAgICAgKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmdpdGh1Yi5jb20vdjMvaXNzdWVzLyNsaXN0LWlzc3Vlcy1mb3ItYS1yZXBvc2l0b3J5CiAgICAgKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmdpdGh1Yi5jb20vdjMvaXNzdWVzLyNnZXQtYS1zaW5nbGUtaXNzdWUKICAgICAqIEBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIuZ2l0aHViLmNvbS92My8jcGFnaW5hdGlvbgogICAgICogQHNlZSBodHRwczovL2RldmVsb3Blci5naXRodWIuY29tL3YzL3NlYXJjaC8jc2VhcmNoLWlzc3Vlcy1hbmQtcHVsbC1yZXF1ZXN0cwogICAgICovCgogIH0sIHsKICAgIGtleTogImdldElzc3VlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfZ2V0SXNzdWUgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0KF9yZWY0KSB7CiAgICAgICAgdmFyIGFjY2Vzc1Rva2VuLCBpc3N1ZUlkLCBpc3N1ZVRpdGxlLCBvcHRpb25zLCBfeWllbGQkdGhpcyQkaHR0cCRnZXQyLCBkYXRhLCBfeWllbGQkdGhpcyQkaHR0cCRnZXQzLCBfZGF0YSwgaXNzdWU7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNCQoX2NvbnRleHQ0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NC5wcmV2ID0gX2NvbnRleHQ0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBhY2Nlc3NUb2tlbiA9IF9yZWY0LmFjY2Vzc1Rva2VuLCBpc3N1ZUlkID0gX3JlZjQuaXNzdWVJZCwgaXNzdWVUaXRsZSA9IF9yZWY0Lmlzc3VlVGl0bGU7CiAgICAgICAgICAgICAgICBvcHRpb25zID0ge307CgogICAgICAgICAgICAgICAgaWYgKGFjY2Vzc1Rva2VuKSB7CiAgICAgICAgICAgICAgICAgIG9wdGlvbnMuaGVhZGVycyA9IHsKICAgICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAidG9rZW4gIi5jb25jYXQoYWNjZXNzVG9rZW4pCiAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCFpc3N1ZUlkKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMjI7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF9jb250ZXh0NC5wcmV2ID0gNDsKICAgICAgICAgICAgICAgIG9wdGlvbnMucGFyYW1zID0gewogICAgICAgICAgICAgICAgICAvLyB0byBhdm9pZCBjYWNoaW5nCiAgICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gODsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRodHRwLmdldCgicmVwb3MvIi5jb25jYXQodGhpcy5vd25lciwgIi8iKS5jb25jYXQodGhpcy5yZXBvLCAiL2lzc3Vlcy8iKS5jb25jYXQoaXNzdWVJZCksIG9wdGlvbnMpOwoKICAgICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgICBfeWllbGQkdGhpcyQkaHR0cCRnZXQyID0gX2NvbnRleHQ0LnNlbnQ7CiAgICAgICAgICAgICAgICBkYXRhID0gX3lpZWxkJHRoaXMkJGh0dHAkZ2V0Mi5kYXRhOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIsIG5vcm1hbGl6ZUlzc3VlKGRhdGEpKTsKCiAgICAgICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgICAgIF9jb250ZXh0NC5wcmV2ID0gMTM7CiAgICAgICAgICAgICAgICBfY29udGV4dDQudDAgPSBfY29udGV4dDRbImNhdGNoIl0oNCk7CgogICAgICAgICAgICAgICAgaWYgKCEoX2NvbnRleHQ0LnQwLnJlc3BvbnNlICYmIF9jb250ZXh0NC50MC5yZXNwb25zZS5zdGF0dXMgPT09IDQwNCkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAxOTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIsIG51bGwpOwoKICAgICAgICAgICAgICBjYXNlIDE5OgogICAgICAgICAgICAgICAgdGhyb3cgX2NvbnRleHQ0LnQwOwoKICAgICAgICAgICAgICBjYXNlIDIwOgogICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAyOTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDIyOgogICAgICAgICAgICAgICAgb3B0aW9ucy5wYXJhbXMgPSB7CiAgICAgICAgICAgICAgICAgIHE6IFsiXCIiLmNvbmNhdChpc3N1ZVRpdGxlLCAiXCIiKSwgImlzOmlzc3VlIiwgImluOnRpdGxlIiwgInJlcG86Ii5jb25jYXQodGhpcy5vd25lciwgIi8iKS5jb25jYXQodGhpcy5yZXBvKSwgImlzOnB1YmxpYyJdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkodGhpcy5sYWJlbHMubWFwKGZ1bmN0aW9uIChsYWJlbCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAibGFiZWw6Ii5jb25jYXQobGFiZWwpOwogICAgICAgICAgICAgICAgICB9KSkpLmpvaW4oJyAnKSwKICAgICAgICAgICAgICAgICAgLy8gdG8gYXZvaWQgY2FjaGluZwogICAgICAgICAgICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCkKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDI1OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGh0dHAuZ2V0KCJzZWFyY2gvaXNzdWVzIiwgb3B0aW9ucyk7CgogICAgICAgICAgICAgIGNhc2UgMjU6CiAgICAgICAgICAgICAgICBfeWllbGQkdGhpcyQkaHR0cCRnZXQzID0gX2NvbnRleHQ0LnNlbnQ7CiAgICAgICAgICAgICAgICBfZGF0YSA9IF95aWVsZCR0aGlzJCRodHRwJGdldDMuZGF0YTsKICAgICAgICAgICAgICAgIGlzc3VlID0gX2RhdGEuaXRlbXMubWFwKG5vcm1hbGl6ZUlzc3VlKS5maW5kKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLnRpdGxlID09PSBpc3N1ZVRpdGxlOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIiwgaXNzdWUgfHwgbnVsbCk7CgogICAgICAgICAgICAgIGNhc2UgMjk6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTQsIHRoaXMsIFtbNCwgMTNdXSk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGdldElzc3VlKF94MykgewogICAgICAgIHJldHVybiBfZ2V0SXNzdWUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGdldElzc3VlOwogICAgfSgpCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBpc3N1ZQogICAgICoKICAgICAqIEBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIuZ2l0aHViLmNvbS92My9pc3N1ZXMvI2NyZWF0ZS1hbi1pc3N1ZQogICAgICovCgogIH0sIHsKICAgIGtleTogInBvc3RJc3N1ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3Bvc3RJc3N1ZSA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTUoX3JlZjUpIHsKICAgICAgICB2YXIgYWNjZXNzVG9rZW4sIHRpdGxlLCBjb250ZW50LCBfeWllbGQkdGhpcyQkaHR0cCRwb3MyLCBkYXRhOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTUkKF9jb250ZXh0NSkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDUucHJldiA9IF9jb250ZXh0NS5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgYWNjZXNzVG9rZW4gPSBfcmVmNS5hY2Nlc3NUb2tlbiwgdGl0bGUgPSBfcmVmNS50aXRsZSwgY29udGVudCA9IF9yZWY1LmNvbnRlbnQ7CiAgICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDM7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kaHR0cC5wb3N0KCJyZXBvcy8iLmNvbmNhdCh0aGlzLm93bmVyLCAiLyIpLmNvbmNhdCh0aGlzLnJlcG8sICIvaXNzdWVzIiksIHsKICAgICAgICAgICAgICAgICAgdGl0bGU6IHRpdGxlLAogICAgICAgICAgICAgICAgICBib2R5OiBjb250ZW50LAogICAgICAgICAgICAgICAgICBsYWJlbHM6IHRoaXMubGFiZWxzCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAidG9rZW4gIi5jb25jYXQoYWNjZXNzVG9rZW4pCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBfeWllbGQkdGhpcyQkaHR0cCRwb3MyID0gX2NvbnRleHQ1LnNlbnQ7CiAgICAgICAgICAgICAgICBkYXRhID0gX3lpZWxkJHRoaXMkJGh0dHAkcG9zMi5kYXRhOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5hYnJ1cHQoInJldHVybiIsIG5vcm1hbGl6ZUlzc3VlKGRhdGEpKTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU1LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gcG9zdElzc3VlKF94NCkgewogICAgICAgIHJldHVybiBfcG9zdElzc3VlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBwb3N0SXNzdWU7CiAgICB9KCkKICAgIC8qKgogICAgICogR2V0IGNvbW1lbnRzIG9mIHRoaXMgcGFnZSBhY2NvcmRpbmcgdG8gdGhlIGlzc3VlIGlkCiAgICAgKgogICAgICogQHNlZSBodHRwczovL2RldmVsb3Blci5naXRodWIuY29tL3YzL2lzc3Vlcy9jb21tZW50cy8jbGlzdC1jb21tZW50cy1vbi1hbi1pc3N1ZQogICAgICogQHNlZSBodHRwczovL2RldmVsb3Blci5naXRodWIuY29tL3YzLyNwYWdpbmF0aW9uCiAgICAgKgogICAgICogQHJlbWFya3MKICAgICAqIEdpdGh1YiBWMyBkb2VzIG5vdCBzdXBwb3J0IHNvcnQgZm9yIGlzc3VlIGNvbW1lbnRzIG5vdy4KICAgICAqIEdpdGh1YiBWMyBoYXZlIHRvIHJlcXVlc3QgdGhlIHBhcmVudCBpc3N1ZSB0byBnZXQgdGhlIGNvdW50IG9mIGNvbW1lbnRzLgogICAgICovCgogIH0sIHsKICAgIGtleTogImdldENvbW1lbnRzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfZ2V0Q29tbWVudHMgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU2KF9yZWY2KSB7CiAgICAgICAgdmFyIGFjY2Vzc1Rva2VuLCBpc3N1ZUlkLCBfcmVmNiRxdWVyeSwgX3JlZjYkcXVlcnkkcGFnZSwgcGFnZSwgX3JlZjYkcXVlcnkkcGVyUGFnZSwgcGVyUGFnZSwgaXNzdWVPcHRpb25zLCBjb21tZW50c09wdGlvbnMsIF95aWVsZCRQcm9taXNlJGFsbCwgX3lpZWxkJFByb21pc2UkYWxsMiwgaXNzdWVSZXMsIGNvbW1lbnRzUmVzLCBsaW5rSGVhZGVyLCB0aGlzUGFnZSwgdGhpc1BlclBhZ2U7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNiQoX2NvbnRleHQ2KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Ni5wcmV2ID0gX2NvbnRleHQ2Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBhY2Nlc3NUb2tlbiA9IF9yZWY2LmFjY2Vzc1Rva2VuLCBpc3N1ZUlkID0gX3JlZjYuaXNzdWVJZCwgX3JlZjYkcXVlcnkgPSBfcmVmNi5xdWVyeTsKICAgICAgICAgICAgICAgIF9yZWY2JHF1ZXJ5ID0gX3JlZjYkcXVlcnkgPT09IHZvaWQgMCA/IHt9IDogX3JlZjYkcXVlcnk7CiAgICAgICAgICAgICAgICBfcmVmNiRxdWVyeSRwYWdlID0gX3JlZjYkcXVlcnkucGFnZSwgcGFnZSA9IF9yZWY2JHF1ZXJ5JHBhZ2UgPT09IHZvaWQgMCA/IDEgOiBfcmVmNiRxdWVyeSRwYWdlLCBfcmVmNiRxdWVyeSRwZXJQYWdlID0gX3JlZjYkcXVlcnkucGVyUGFnZSwgcGVyUGFnZSA9IF9yZWY2JHF1ZXJ5JHBlclBhZ2UgPT09IHZvaWQgMCA/IDEwIDogX3JlZjYkcXVlcnkkcGVyUGFnZTsKICAgICAgICAgICAgICAgIGlzc3VlT3B0aW9ucyA9IHsKICAgICAgICAgICAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICAgICAgICAgICAgLy8gdG8gYXZvaWQgY2FjaGluZwogICAgICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgY29tbWVudHNPcHRpb25zID0gewogICAgICAgICAgICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgICAgICAgICAvLyBwYWdpbmF0aW9uCiAgICAgICAgICAgICAgICAgICAgcGFnZTogcGFnZSwKICAgICAgICAgICAgICAgICAgICBwZXJfcGFnZTogcGVyUGFnZSwKCiAgICAgICAgICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAgICAgICAgICogZ2l0aHViIHYzIGFwaSBkb2VzIG5vdCBzdXBwb3J0IHNvcnQgZm9yIGlzc3VlIGNvbW1lbnRzCiAgICAgICAgICAgICAgICAgICAgICogaGF2ZSBzZW50IGZlZWRiYWNrIHRvIGdpdGh1YiBzdXBwb3J0CiAgICAgICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICAgICAgLy8gJ3NvcnQnOiAnY3JlYXRlZCcsCiAgICAgICAgICAgICAgICAgICAgLy8gJ2RpcmVjdGlvbic6IHNvcnQsCiAgICAgICAgICAgICAgICAgICAgLy8gdG8gYXZvaWQgY2FjaGluZwogICAgICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKQogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgQWNjZXB0OiBbJ2FwcGxpY2F0aW9uL3ZuZC5naXRodWIudjMucmF3K2pzb24nLCAnYXBwbGljYXRpb24vdm5kLmdpdGh1Yi52My5odG1sK2pzb24nLCAnYXBwbGljYXRpb24vdm5kLmdpdGh1Yi5zcXVpcnJlbC1naXJsLXByZXZpZXcnXQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgIGlmIChhY2Nlc3NUb2tlbikgewogICAgICAgICAgICAgICAgICBpc3N1ZU9wdGlvbnMuaGVhZGVycyA9IHsKICAgICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAidG9rZW4gIi5jb25jYXQoYWNjZXNzVG9rZW4pCiAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgIGNvbW1lbnRzT3B0aW9ucy5oZWFkZXJzLkF1dGhvcml6YXRpb24gPSAidG9rZW4gIi5jb25jYXQoYWNjZXNzVG9rZW4pOwogICAgICAgICAgICAgICAgfSAvLyBnaXRodWIgdjMgaGF2ZSB0byBnZXQgdGhlIHRvdGFsIGNvdW50IG9mIGNvbW1lbnRzIGJ5IHJlcXVlc3RpbmcgdGhlIGlzc3VlCgoKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gODsKICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLmFsbChbdGhpcy4kaHR0cC5nZXQoInJlcG9zLyIuY29uY2F0KHRoaXMub3duZXIsICIvIikuY29uY2F0KHRoaXMucmVwbywgIi9pc3N1ZXMvIikuY29uY2F0KGlzc3VlSWQpLCBpc3N1ZU9wdGlvbnMpLCB0aGlzLiRodHRwLmdldCgicmVwb3MvIi5jb25jYXQodGhpcy5vd25lciwgIi8iKS5jb25jYXQodGhpcy5yZXBvLCAiL2lzc3Vlcy8iKS5jb25jYXQoaXNzdWVJZCwgIi9jb21tZW50cyIpLCBjb21tZW50c09wdGlvbnMpXSk7CgogICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICAgIF95aWVsZCRQcm9taXNlJGFsbCA9IF9jb250ZXh0Ni5zZW50OwogICAgICAgICAgICAgICAgX3lpZWxkJFByb21pc2UkYWxsMiA9IF9zbGljZWRUb0FycmF5KF95aWVsZCRQcm9taXNlJGFsbCwgMik7CiAgICAgICAgICAgICAgICBpc3N1ZVJlcyA9IF95aWVsZCRQcm9taXNlJGFsbDJbMF07CiAgICAgICAgICAgICAgICBjb21tZW50c1JlcyA9IF95aWVsZCRQcm9taXNlJGFsbDJbMV07CiAgICAgICAgICAgICAgICAvLyBpdCdzIGFubm95aW5nIHRoYXQgaGF2ZSB0byBnZXQgdGhlIHBhZ2UgYW5kIHBlcl9wYWdlIGZyb20gdGhlIGBMaW5rYCBoZWFkZXIKICAgICAgICAgICAgICAgIGxpbmtIZWFkZXIgPSBjb21tZW50c1Jlcy5oZWFkZXJzLmxpbmsgfHwgbnVsbDsKICAgICAgICAgICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCgogICAgICAgICAgICAgICAgdGhpc1BhZ2UgPSAvcmVsPSJuZXh0Ii8udGVzdChsaW5rSGVhZGVyKSA/IE51bWJlcihsaW5rSGVhZGVyLnJlcGxhY2UoL14uKlteX11wYWdlPShcZCopLipyZWw9Im5leHQiLiokLywgJyQxJykpIC0gMSA6IC9yZWw9InByZXYiLy50ZXN0KGxpbmtIZWFkZXIpID8gTnVtYmVyKGxpbmtIZWFkZXIucmVwbGFjZSgvXi4qW15fXXBhZ2U9KFxkKikuKnJlbD0icHJldiIuKiQvLCAnJDEnKSkgKyAxIDogMTsKICAgICAgICAgICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCgogICAgICAgICAgICAgICAgdGhpc1BlclBhZ2UgPSBsaW5rSGVhZGVyID8gTnVtYmVyKGxpbmtIZWFkZXIucmVwbGFjZSgvXi4qcGVyX3BhZ2U9KFxkKikuKiQvLCAnJDEnKSkgOiBwZXJQYWdlOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoInJldHVybiIsIHsKICAgICAgICAgICAgICAgICAgY291bnQ6IE51bWJlcihpc3N1ZVJlcy5kYXRhLmNvbW1lbnRzKSwKICAgICAgICAgICAgICAgICAgcGFnZTogdGhpc1BhZ2UsCiAgICAgICAgICAgICAgICAgIHBlclBhZ2U6IHRoaXNQZXJQYWdlLAogICAgICAgICAgICAgICAgICBkYXRhOiBjb21tZW50c1Jlcy5kYXRhLm1hcChub3JtYWxpemVDb21tZW50KQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMTY6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTYsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBnZXRDb21tZW50cyhfeDUpIHsKICAgICAgICByZXR1cm4gX2dldENvbW1lbnRzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBnZXRDb21tZW50czsKICAgIH0oKQogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgY29tbWVudAogICAgICoKICAgICAqIEBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIuZ2l0aHViLmNvbS92My9pc3N1ZXMvY29tbWVudHMvI2NyZWF0ZS1hLWNvbW1lbnQKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJwb3N0Q29tbWVudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3Bvc3RDb21tZW50ID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNyhfcmVmNykgewogICAgICAgIHZhciBhY2Nlc3NUb2tlbiwgaXNzdWVJZCwgY29udGVudCwgX3lpZWxkJHRoaXMkJGh0dHAkcG9zMywgZGF0YTsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU3JChfY29udGV4dDcpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ3LnByZXYgPSBfY29udGV4dDcubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGFjY2Vzc1Rva2VuID0gX3JlZjcuYWNjZXNzVG9rZW4sIGlzc3VlSWQgPSBfcmVmNy5pc3N1ZUlkLCBjb250ZW50ID0gX3JlZjcuY29udGVudDsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ny5uZXh0ID0gMzsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRodHRwLnBvc3QoInJlcG9zLyIuY29uY2F0KHRoaXMub3duZXIsICIvIikuY29uY2F0KHRoaXMucmVwbywgIi9pc3N1ZXMvIikuY29uY2F0KGlzc3VlSWQsICIvY29tbWVudHMiKSwgewogICAgICAgICAgICAgICAgICBib2R5OiBjb250ZW50CiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAidG9rZW4gIi5jb25jYXQoYWNjZXNzVG9rZW4pLAogICAgICAgICAgICAgICAgICAgIEFjY2VwdDogWydhcHBsaWNhdGlvbi92bmQuZ2l0aHViLnYzLnJhdytqc29uJywgJ2FwcGxpY2F0aW9uL3ZuZC5naXRodWIudjMuaHRtbCtqc29uJywgJ2FwcGxpY2F0aW9uL3ZuZC5naXRodWIuc3F1aXJyZWwtZ2lybC1wcmV2aWV3J10KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIF95aWVsZCR0aGlzJCRodHRwJHBvczMgPSBfY29udGV4dDcuc2VudDsKICAgICAgICAgICAgICAgIGRhdGEgPSBfeWllbGQkdGhpcyQkaHR0cCRwb3MzLmRhdGE7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ3LmFicnVwdCgicmV0dXJuIiwgbm9ybWFsaXplQ29tbWVudChkYXRhKSk7CgogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ny5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNywgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIHBvc3RDb21tZW50KF94NikgewogICAgICAgIHJldHVybiBfcG9zdENvbW1lbnQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHBvc3RDb21tZW50OwogICAgfSgpCiAgICAvKioKICAgICAqIEVkaXQgYSBjb21tZW50CiAgICAgKgogICAgICogQHNlZSBodHRwczovL2RldmVsb3Blci5naXRodWIuY29tL3YzL2lzc3Vlcy9jb21tZW50cy8jZWRpdC1hLWNvbW1lbnQKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJwdXRDb21tZW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfcHV0Q29tbWVudCA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTgoX3JlZjgpIHsKICAgICAgICB2YXIgYWNjZXNzVG9rZW4sIGNvbW1lbnRJZCwgY29udGVudCwgX3lpZWxkJHRoaXMkJGh0dHAkcGF0LCBkYXRhOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTgkKF9jb250ZXh0OCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDgucHJldiA9IF9jb250ZXh0OC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgYWNjZXNzVG9rZW4gPSBfcmVmOC5hY2Nlc3NUb2tlbiwgY29tbWVudElkID0gX3JlZjguY29tbWVudElkLCBjb250ZW50ID0gX3JlZjguY29udGVudDsKICAgICAgICAgICAgICAgIF9jb250ZXh0OC5uZXh0ID0gMzsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRodHRwLnBhdGNoKCJyZXBvcy8iLmNvbmNhdCh0aGlzLm93bmVyLCAiLyIpLmNvbmNhdCh0aGlzLnJlcG8sICIvaXNzdWVzL2NvbW1lbnRzLyIpLmNvbmNhdChjb21tZW50SWQpLCB7CiAgICAgICAgICAgICAgICAgIGJvZHk6IGNvbnRlbnQKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJ0b2tlbiAiLmNvbmNhdChhY2Nlc3NUb2tlbiksCiAgICAgICAgICAgICAgICAgICAgQWNjZXB0OiBbJ2FwcGxpY2F0aW9uL3ZuZC5naXRodWIudjMucmF3K2pzb24nLCAnYXBwbGljYXRpb24vdm5kLmdpdGh1Yi52My5odG1sK2pzb24nLCAnYXBwbGljYXRpb24vdm5kLmdpdGh1Yi5zcXVpcnJlbC1naXJsLXByZXZpZXcnXQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgX3lpZWxkJHRoaXMkJGh0dHAkcGF0ID0gX2NvbnRleHQ4LnNlbnQ7CiAgICAgICAgICAgICAgICBkYXRhID0gX3lpZWxkJHRoaXMkJGh0dHAkcGF0LmRhdGE7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ4LmFicnVwdCgicmV0dXJuIiwgbm9ybWFsaXplQ29tbWVudChkYXRhKSk7CgogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlOCwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIHB1dENvbW1lbnQoX3g3KSB7CiAgICAgICAgcmV0dXJuIF9wdXRDb21tZW50LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBwdXRDb21tZW50OwogICAgfSgpCiAgICAvKioKICAgICAqIERlbGV0ZSBhIGNvbW1lbnQKICAgICAqCiAgICAgKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmdpdGh1Yi5jb20vdjMvaXNzdWVzL2NvbW1lbnRzLyNkZWxldGUtYS1jb21tZW50CiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZGVsZXRlQ29tbWVudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2RlbGV0ZUNvbW1lbnQgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU5KF9yZWY5KSB7CiAgICAgICAgdmFyIGFjY2Vzc1Rva2VuLCBjb21tZW50SWQsIF95aWVsZCR0aGlzJCRodHRwJGRlbCwgc3RhdHVzOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTkkKF9jb250ZXh0OSkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDkucHJldiA9IF9jb250ZXh0OS5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgYWNjZXNzVG9rZW4gPSBfcmVmOS5hY2Nlc3NUb2tlbiwgY29tbWVudElkID0gX3JlZjkuY29tbWVudElkOwogICAgICAgICAgICAgICAgX2NvbnRleHQ5Lm5leHQgPSAzOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGh0dHBbImRlbGV0ZSJdKCJyZXBvcy8iLmNvbmNhdCh0aGlzLm93bmVyLCAiLyIpLmNvbmNhdCh0aGlzLnJlcG8sICIvaXNzdWVzL2NvbW1lbnRzLyIpLmNvbmNhdChjb21tZW50SWQpLCB7CiAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAidG9rZW4gIi5jb25jYXQoYWNjZXNzVG9rZW4pCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBfeWllbGQkdGhpcyQkaHR0cCRkZWwgPSBfY29udGV4dDkuc2VudDsKICAgICAgICAgICAgICAgIHN0YXR1cyA9IF95aWVsZCR0aGlzJCRodHRwJGRlbC5zdGF0dXM7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ5LmFicnVwdCgicmV0dXJuIiwgc3RhdHVzID09PSAyMDQpOwoKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDkuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTksIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBkZWxldGVDb21tZW50KF94OCkgewogICAgICAgIHJldHVybiBfZGVsZXRlQ29tbWVudC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gZGVsZXRlQ29tbWVudDsKICAgIH0oKQogICAgLyoqCiAgICAgKiBHZXQgcmVhY3Rpb25zIG9mIGEgY29tbWVudAogICAgICoKICAgICAqIEBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIuZ2l0aHViLmNvbS92My9pc3N1ZXMvY29tbWVudHMvI2dldC1hLXNpbmdsZS1jb21tZW50CiAgICAgKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmdpdGh1Yi5jb20vdjMvcmVhY3Rpb25zLyNsaXN0LXJlYWN0aW9ucy1mb3ItYW4taXNzdWUtY29tbWVudAogICAgICoKICAgICAqIEByZW1hcmtzCiAgICAgKiBUaGUgYExpc3QgcmVhY3Rpb25zIGZvciBhbiBpc3N1ZSBjb21tZW50YCBBUEkgYWxzbyByZXR1cm5zIGF1dGhvciBvZiBlYWNoIHJlYWN0aW9uLgogICAgICogQXMgd2Ugb25seSBuZWVkIHRoZSBjb3VudCwgdXNlIHRoZSBgR2V0IGEgc2luZ2xlIGNvbW1lbnRgIEFQSSBpcyBtdWNoIHNpbXBsZXIuCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0Q29tbWVudFJlYWN0aW9ucyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2dldENvbW1lbnRSZWFjdGlvbnMgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxMChfcmVmMTApIHsKICAgICAgICB2YXIgYWNjZXNzVG9rZW4sIGNvbW1lbnRJZCwgX3lpZWxkJHRoaXMkJGh0dHAkZ2V0NCwgZGF0YTsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxMCQoX2NvbnRleHQxMCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDEwLnByZXYgPSBfY29udGV4dDEwLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBhY2Nlc3NUb2tlbiA9IF9yZWYxMC5hY2Nlc3NUb2tlbiwgY29tbWVudElkID0gX3JlZjEwLmNvbW1lbnRJZDsKICAgICAgICAgICAgICAgIF9jb250ZXh0MTAubmV4dCA9IDM7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kaHR0cC5nZXQoInJlcG9zLyIuY29uY2F0KHRoaXMub3duZXIsICIvIikuY29uY2F0KHRoaXMucmVwbywgIi9pc3N1ZXMvY29tbWVudHMvIikuY29uY2F0KGNvbW1lbnRJZCksIHsKICAgICAgICAgICAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICAgICAgICAgICAgLy8gdG8gYXZvaWQgY2FjaGluZwogICAgICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKQogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogInRva2VuICIuY29uY2F0KGFjY2Vzc1Rva2VuKSwKICAgICAgICAgICAgICAgICAgICBBY2NlcHQ6ICdhcHBsaWNhdGlvbi92bmQuZ2l0aHViLnNxdWlycmVsLWdpcmwtcHJldmlldycKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIF95aWVsZCR0aGlzJCRodHRwJGdldDQgPSBfY29udGV4dDEwLnNlbnQ7CiAgICAgICAgICAgICAgICBkYXRhID0gX3lpZWxkJHRoaXMkJGh0dHAkZ2V0NC5kYXRhOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTAuYWJydXB0KCJyZXR1cm4iLCBub3JtYWxpemVSZWFjdGlvbnMoZGF0YS5yZWFjdGlvbnMpKTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMTAsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBnZXRDb21tZW50UmVhY3Rpb25zKF94OSkgewogICAgICAgIHJldHVybiBfZ2V0Q29tbWVudFJlYWN0aW9ucy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gZ2V0Q29tbWVudFJlYWN0aW9uczsKICAgIH0oKQogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgcmVhY3Rpb24gb2YgYSBjb21tZW50CiAgICAgKgogICAgICogQHNlZSBodHRwczovL2RldmVsb3Blci5naXRodWIuY29tL3YzL3JlYWN0aW9ucy8jY3JlYXRlLXJlYWN0aW9uLWZvci1hbi1pc3N1ZS1jb21tZW50CiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicG9zdENvbW1lbnRSZWFjdGlvbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3Bvc3RDb21tZW50UmVhY3Rpb24gPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxMShfcmVmMTEpIHsKICAgICAgICB2YXIgYWNjZXNzVG9rZW4sIGNvbW1lbnRJZCwgcmVhY3Rpb24sIHJlc3BvbnNlOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMTEkKF9jb250ZXh0MTEpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxMS5wcmV2ID0gX2NvbnRleHQxMS5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgYWNjZXNzVG9rZW4gPSBfcmVmMTEuYWNjZXNzVG9rZW4sIGNvbW1lbnRJZCA9IF9yZWYxMS5jb21tZW50SWQsIHJlYWN0aW9uID0gX3JlZjExLnJlYWN0aW9uOwogICAgICAgICAgICAgICAgX2NvbnRleHQxMS5uZXh0ID0gMzsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRodHRwLnBvc3QoInJlcG9zLyIuY29uY2F0KHRoaXMub3duZXIsICIvIikuY29uY2F0KHRoaXMucmVwbywgIi9pc3N1ZXMvY29tbWVudHMvIikuY29uY2F0KGNvbW1lbnRJZCwgIi9yZWFjdGlvbnMiKSwgewogICAgICAgICAgICAgICAgICBjb250ZW50OiBtYXBSZWFjdGlvbk5hbWUocmVhY3Rpb24pCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAidG9rZW4gIi5jb25jYXQoYWNjZXNzVG9rZW4pLAogICAgICAgICAgICAgICAgICAgIEFjY2VwdDogJ2FwcGxpY2F0aW9uL3ZuZC5naXRodWIuc3F1aXJyZWwtZ2lybC1wcmV2aWV3JwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBfY29udGV4dDExLnNlbnQ7CgogICAgICAgICAgICAgICAgaWYgKCEocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTEubmV4dCA9IDY7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDExLmFicnVwdCgicmV0dXJuIiwgdGhpcy5kZWxldGVDb21tZW50UmVhY3Rpb24oewogICAgICAgICAgICAgICAgICBhY2Nlc3NUb2tlbjogYWNjZXNzVG9rZW4sCiAgICAgICAgICAgICAgICAgIGNvbW1lbnRJZDogY29tbWVudElkLAogICAgICAgICAgICAgICAgICByZWFjdGlvbklkOiByZXNwb25zZS5kYXRhLmlkCiAgICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDExLmFicnVwdCgicmV0dXJuIiwgcmVzcG9uc2Uuc3RhdHVzID09PSAyMDEpOwoKICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDExLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUxMSwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIHBvc3RDb21tZW50UmVhY3Rpb24oX3gxMCkgewogICAgICAgIHJldHVybiBfcG9zdENvbW1lbnRSZWFjdGlvbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gcG9zdENvbW1lbnRSZWFjdGlvbjsKICAgIH0oKQogICAgLyoqCiAgICAgKiBEZWxldGUgYSByZWFjdGlvbiBvZiBhIGNvbW1lbnQKICAgICAqCiAgICAgKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmdpdGh1Yi5jb20vdjMvcmVhY3Rpb25zLyNkZWxldGUtYS1yZWFjdGlvbgogICAgICovCgogIH0sIHsKICAgIGtleTogImRlbGV0ZUNvbW1lbnRSZWFjdGlvbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2RlbGV0ZUNvbW1lbnRSZWFjdGlvbiA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTEyKF9yZWYxMikgewogICAgICAgIHZhciBhY2Nlc3NUb2tlbiwgY29tbWVudElkLCByZWFjdGlvbklkLCByZXNwb25zZTsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTEyJChfY29udGV4dDEyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTIucHJldiA9IF9jb250ZXh0MTIubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGFjY2Vzc1Rva2VuID0gX3JlZjEyLmFjY2Vzc1Rva2VuLCBjb21tZW50SWQgPSBfcmVmMTIuY29tbWVudElkLCByZWFjdGlvbklkID0gX3JlZjEyLnJlYWN0aW9uSWQ7CiAgICAgICAgICAgICAgICBfY29udGV4dDEyLm5leHQgPSAzOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGh0dHBbImRlbGV0ZSJdKCJyZXBvcy8iLmNvbmNhdCh0aGlzLm93bmVyLCAiLyIpLmNvbmNhdCh0aGlzLnJlcG8sICIvaXNzdWVzL2NvbW1lbnRzLyIpLmNvbmNhdChjb21tZW50SWQsICIvcmVhY3Rpb25zLyIpLmNvbmNhdChyZWFjdGlvbklkKSwgewogICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogInRva2VuICIuY29uY2F0KGFjY2Vzc1Rva2VuKSwKICAgICAgICAgICAgICAgICAgICBBY2NlcHQ6ICdhcHBsaWNhdGlvbi92bmQuZ2l0aHViLnNxdWlycmVsLWdpcmwtcHJldmlldycKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gX2NvbnRleHQxMi5zZW50OwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTIuYWJydXB0KCJyZXR1cm4iLCByZXNwb25zZS5zdGF0dXMgPT09IDIwNCk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTIuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTEyLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gZGVsZXRlQ29tbWVudFJlYWN0aW9uKF94MTEpIHsKICAgICAgICByZXR1cm4gX2RlbGV0ZUNvbW1lbnRSZWFjdGlvbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gZGVsZXRlQ29tbWVudFJlYWN0aW9uOwogICAgfSgpCiAgfV0pOwoKICByZXR1cm4gR2l0aHViVjM7Cn0oKTsKCmV4cG9ydCB7IEdpdGh1YlYzIGFzIGRlZmF1bHQgfTs="},{"version":3,"sources":["../src/index.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import axios from 'axios';\nimport { buildURL, concatURL, getCleanURL, parseQuery } from '@vssue/utils';\nimport { normalizeUser, normalizeIssue, normalizeComment, normalizeReactions, mapReactionName, } from './utils';\n/**\n * Github REST API v3\n *\n * @see https://developer.github.com/v3/\n * @see https://developer.github.com/apps/building-oauth-apps/\n */\nexport default class GithubV3 {\n    constructor({ baseURL = 'https://github.com', owner, repo, labels, clientId, clientSecret, state, proxy, }) {\n        /* istanbul ignore if */\n        if (typeof clientSecret === 'undefined' || typeof proxy === 'undefined') {\n            throw new Error('clientSecret and proxy is required for GitHub V3');\n        }\n        this.baseURL = baseURL;\n        this.owner = owner;\n        this.repo = repo;\n        this.labels = labels;\n        this.clientId = clientId;\n        this.clientSecret = clientSecret;\n        this.state = state;\n        this.proxy = proxy;\n        this.$http = axios.create({\n            baseURL: baseURL === 'https://github.com'\n                ? 'https://api.github.com'\n                : concatURL(baseURL, 'api/v3'),\n            headers: {\n                Accept: 'application/vnd.github.v3+json',\n            },\n        });\n        this.$http.interceptors.response.use(response => {\n            if (response.data && response.data.error) {\n                return Promise.reject(new Error(response.data.error_description));\n            }\n            return response;\n        }, error => {\n            // 403 rate limit exceeded in OPTIONS request will cause a Network Error\n            // here we always treat Network Error as 403 rate limit exceeded\n            // @see https://github.com/axios/axios/issues/838\n            /* istanbul ignore next */\n            if (typeof error.response === 'undefined' &&\n                error.message === 'Network Error') {\n                error.response = {\n                    status: 403,\n                };\n            }\n            return Promise.reject(error);\n        });\n    }\n    /**\n     * The platform api info\n     */\n    get platform() {\n        return {\n            name: 'GitHub',\n            link: this.baseURL,\n            version: 'v3',\n            meta: {\n                reactable: true,\n                sortable: false,\n            },\n        };\n    }\n    /**\n     * Redirect to the authorization page of platform.\n     *\n     * @see https://developer.github.com/apps/building-oauth-apps/authorizing-oauth-apps/#1-request-a-users-github-identity\n     */\n    redirectAuth() {\n        window.location.href = buildURL(concatURL(this.baseURL, 'login/oauth/authorize'), {\n            client_id: this.clientId,\n            redirect_uri: window.location.href,\n            scope: 'public_repo',\n            state: this.state,\n        });\n    }\n    /**\n     * Handle authorization.\n     *\n     * @see https://developer.github.com/apps/building-oauth-apps/authorizing-oauth-apps/\n     *\n     * @remarks\n     * If the `code` and `state` exist in the query, and the `state` matches, remove them from query, and try to get the access token.\n     */\n    async handleAuth() {\n        const query = parseQuery(window.location.search);\n        if (query.code) {\n            if (query.state !== this.state) {\n                return null;\n            }\n            const code = query.code;\n            delete query.code;\n            delete query.state;\n            const replaceURL = buildURL(getCleanURL(window.location.href), query) +\n                window.location.hash;\n            window.history.replaceState(null, '', replaceURL);\n            const accessToken = await this.getAccessToken({ code });\n            return accessToken;\n        }\n        return null;\n    }\n    /**\n     * Get user access token via `code`\n     *\n     * @see https://developer.github.com/apps/building-oauth-apps/authorizing-oauth-apps/#2-users-are-redirected-back-to-your-site-by-github\n     */\n    async getAccessToken({ code }) {\n        /**\n         * access_token api does not support cors\n         * @see https://github.com/isaacs/github/issues/330\n         */\n        const originalURL = concatURL(this.baseURL, 'login/oauth/access_token');\n        const proxyURL = typeof this.proxy === 'function' ? this.proxy(originalURL) : this.proxy;\n        const { data } = await this.$http.post(proxyURL, {\n            client_id: this.clientId,\n            client_secret: this.clientSecret,\n            code,\n        }, {\n            headers: {\n                Accept: 'application/json',\n            },\n        });\n        return data.access_token;\n    }\n    /**\n     * Get the logged-in user with access token.\n     *\n     * @see https://developer.github.com/v3/users/#get-the-authenticated-user\n     */\n    async getUser({ accessToken, }) {\n        const { data } = await this.$http.get('user', {\n            headers: { Authorization: `token ${accessToken}` },\n        });\n        return normalizeUser(data);\n    }\n    /**\n     * Get issue of this page according to the issue id or the issue title\n     *\n     * @see https://developer.github.com/v3/issues/#list-issues-for-a-repository\n     * @see https://developer.github.com/v3/issues/#get-a-single-issue\n     * @see https://developer.github.com/v3/#pagination\n     * @see https://developer.github.com/v3/search/#search-issues-and-pull-requests\n     */\n    async getIssue({ accessToken, issueId, issueTitle, }) {\n        const options = {};\n        if (accessToken) {\n            options.headers = {\n                Authorization: `token ${accessToken}`,\n            };\n        }\n        if (issueId) {\n            try {\n                options.params = {\n                    // to avoid caching\n                    timestamp: Date.now(),\n                };\n                const { data } = await this.$http.get(`repos/${this.owner}/${this.repo}/issues/${issueId}`, options);\n                return normalizeIssue(data);\n            }\n            catch (e) {\n                if (e.response && e.response.status === 404) {\n                    return null;\n                }\n                else {\n                    throw e;\n                }\n            }\n        }\n        else {\n            options.params = {\n                q: [\n                    `\"${issueTitle}\"`,\n                    `is:issue`,\n                    `in:title`,\n                    `repo:${this.owner}/${this.repo}`,\n                    `is:public`,\n                    ...this.labels.map(label => `label:${label}`),\n                ].join(' '),\n                // to avoid caching\n                timestamp: Date.now(),\n            };\n            const { data } = await this.$http.get(`search/issues`, options);\n            const issue = data.items\n                .map(normalizeIssue)\n                .find(item => item.title === issueTitle);\n            return issue || null;\n        }\n    }\n    /**\n     * Create a new issue\n     *\n     * @see https://developer.github.com/v3/issues/#create-an-issue\n     */\n    async postIssue({ accessToken, title, content, }) {\n        const { data } = await this.$http.post(`repos/${this.owner}/${this.repo}/issues`, {\n            title,\n            body: content,\n            labels: this.labels,\n        }, {\n            headers: { Authorization: `token ${accessToken}` },\n        });\n        return normalizeIssue(data);\n    }\n    /**\n     * Get comments of this page according to the issue id\n     *\n     * @see https://developer.github.com/v3/issues/comments/#list-comments-on-an-issue\n     * @see https://developer.github.com/v3/#pagination\n     *\n     * @remarks\n     * Github V3 does not support sort for issue comments now.\n     * Github V3 have to request the parent issue to get the count of comments.\n     */\n    async getComments({ accessToken, issueId, query: { page = 1, perPage = 10 /*, sort = 'desc' */ } = {}, }) {\n        const issueOptions = {\n            params: {\n                // to avoid caching\n                timestamp: Date.now(),\n            },\n        };\n        const commentsOptions = {\n            params: {\n                // pagination\n                page: page,\n                per_page: perPage,\n                /**\n                 * github v3 api does not support sort for issue comments\n                 * have sent feedback to github support\n                 */\n                // 'sort': 'created',\n                // 'direction': sort,\n                // to avoid caching\n                timestamp: Date.now(),\n            },\n            headers: {\n                Accept: [\n                    'application/vnd.github.v3.raw+json',\n                    'application/vnd.github.v3.html+json',\n                    'application/vnd.github.squirrel-girl-preview',\n                ],\n            },\n        };\n        if (accessToken) {\n            issueOptions.headers = {\n                Authorization: `token ${accessToken}`,\n            };\n            commentsOptions.headers.Authorization = `token ${accessToken}`;\n        }\n        // github v3 have to get the total count of comments by requesting the issue\n        const [issueRes, commentsRes] = await Promise.all([\n            this.$http.get(`repos/${this.owner}/${this.repo}/issues/${issueId}`, issueOptions),\n            this.$http.get(`repos/${this.owner}/${this.repo}/issues/${issueId}/comments`, commentsOptions),\n        ]);\n        // it's annoying that have to get the page and per_page from the `Link` header\n        const linkHeader = commentsRes.headers.link || null;\n        /* istanbul ignore next */\n        const thisPage = /rel=\"next\"/.test(linkHeader)\n            ? Number(linkHeader.replace(/^.*[^_]page=(\\d*).*rel=\"next\".*$/, '$1')) - 1\n            : /rel=\"prev\"/.test(linkHeader)\n                ? Number(linkHeader.replace(/^.*[^_]page=(\\d*).*rel=\"prev\".*$/, '$1')) + 1\n                : 1;\n        /* istanbul ignore next */\n        const thisPerPage = linkHeader\n            ? Number(linkHeader.replace(/^.*per_page=(\\d*).*$/, '$1'))\n            : perPage;\n        return {\n            count: Number(issueRes.data.comments),\n            page: thisPage,\n            perPage: thisPerPage,\n            data: commentsRes.data.map(normalizeComment),\n        };\n    }\n    /**\n     * Create a new comment\n     *\n     * @see https://developer.github.com/v3/issues/comments/#create-a-comment\n     */\n    async postComment({ accessToken, issueId, content, }) {\n        const { data } = await this.$http.post(`repos/${this.owner}/${this.repo}/issues/${issueId}/comments`, {\n            body: content,\n        }, {\n            headers: {\n                Authorization: `token ${accessToken}`,\n                Accept: [\n                    'application/vnd.github.v3.raw+json',\n                    'application/vnd.github.v3.html+json',\n                    'application/vnd.github.squirrel-girl-preview',\n                ],\n            },\n        });\n        return normalizeComment(data);\n    }\n    /**\n     * Edit a comment\n     *\n     * @see https://developer.github.com/v3/issues/comments/#edit-a-comment\n     */\n    async putComment({ accessToken, commentId, content, }) {\n        const { data } = await this.$http.patch(`repos/${this.owner}/${this.repo}/issues/comments/${commentId}`, {\n            body: content,\n        }, {\n            headers: {\n                Authorization: `token ${accessToken}`,\n                Accept: [\n                    'application/vnd.github.v3.raw+json',\n                    'application/vnd.github.v3.html+json',\n                    'application/vnd.github.squirrel-girl-preview',\n                ],\n            },\n        });\n        return normalizeComment(data);\n    }\n    /**\n     * Delete a comment\n     *\n     * @see https://developer.github.com/v3/issues/comments/#delete-a-comment\n     */\n    async deleteComment({ accessToken, commentId, }) {\n        const { status } = await this.$http.delete(`repos/${this.owner}/${this.repo}/issues/comments/${commentId}`, {\n            headers: { Authorization: `token ${accessToken}` },\n        });\n        return status === 204;\n    }\n    /**\n     * Get reactions of a comment\n     *\n     * @see https://developer.github.com/v3/issues/comments/#get-a-single-comment\n     * @see https://developer.github.com/v3/reactions/#list-reactions-for-an-issue-comment\n     *\n     * @remarks\n     * The `List reactions for an issue comment` API also returns author of each reaction.\n     * As we only need the count, use the `Get a single comment` API is much simpler.\n     */\n    async getCommentReactions({ accessToken, commentId, }) {\n        const { data } = await this.$http.get(`repos/${this.owner}/${this.repo}/issues/comments/${commentId}`, {\n            params: {\n                // to avoid caching\n                timestamp: Date.now(),\n            },\n            headers: {\n                Authorization: `token ${accessToken}`,\n                Accept: 'application/vnd.github.squirrel-girl-preview',\n            },\n        });\n        return normalizeReactions(data.reactions);\n    }\n    /**\n     * Create a new reaction of a comment\n     *\n     * @see https://developer.github.com/v3/reactions/#create-reaction-for-an-issue-comment\n     */\n    async postCommentReaction({ accessToken, commentId, reaction, }) {\n        const response = await this.$http.post(`repos/${this.owner}/${this.repo}/issues/comments/${commentId}/reactions`, {\n            content: mapReactionName(reaction),\n        }, {\n            headers: {\n                Authorization: `token ${accessToken}`,\n                Accept: 'application/vnd.github.squirrel-girl-preview',\n            },\n        });\n        // 200 OK if the reaction is already token\n        if (response.status === 200) {\n            return this.deleteCommentReaction({\n                accessToken,\n                commentId,\n                reactionId: response.data.id,\n            });\n        }\n        // 201 CREATED\n        return response.status === 201;\n    }\n    /**\n     * Delete a reaction of a comment\n     *\n     * @see https://developer.github.com/v3/reactions/#delete-a-reaction\n     */\n    async deleteCommentReaction({ accessToken, commentId, reactionId, }) {\n        const response = await this.$http.delete(`repos/${this.owner}/${this.repo}/issues/comments/${commentId}/reactions/${reactionId}`, {\n            headers: {\n                Authorization: `token ${accessToken}`,\n                Accept: 'application/vnd.github.squirrel-girl-preview',\n            },\n        });\n        return response.status === 204;\n    }\n}\n//# sourceMappingURL=index.js.map"]}]}